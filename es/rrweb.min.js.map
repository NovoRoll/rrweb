{"version":3,"file":"rrweb.min.js","sources":["../node_modules/tslib/tslib.es6.js","../node_modules/rrweb-snapshot/es/rrweb-snapshot.js","../src/utils.ts","../src/types.ts","../src/record/collection.ts","../src/record/observer.ts","../src/record/index.ts","../node_modules/mitt/dist/mitt.es.js","../node_modules/smoothscroll-polyfill/dist/smoothscroll.js","../src/replay/timer.ts","../src/replay/styles/inject-style.ts","../src/replay/index.ts","../src/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","var NodeType;\n(function (NodeType) {\n    NodeType[NodeType[\"Document\"] = 0] = \"Document\";\n    NodeType[NodeType[\"DocumentType\"] = 1] = \"DocumentType\";\n    NodeType[NodeType[\"Element\"] = 2] = \"Element\";\n    NodeType[NodeType[\"Text\"] = 3] = \"Text\";\n    NodeType[NodeType[\"CDATA\"] = 4] = \"CDATA\";\n    NodeType[NodeType[\"Comment\"] = 5] = \"Comment\";\n})(NodeType || (NodeType = {}));\n\nvar _id = 1;\nvar symbolAndNumberRegex = RegExp('[^a-z]');\nfunction genId() {\n    return _id++;\n}\nfunction getValidTagName(tagName) {\n    var processedTagName = tagName.toLowerCase().trim();\n    if (symbolAndNumberRegex.test(processedTagName)) {\n        return 'div';\n    }\n    return processedTagName;\n}\nfunction getCssRulesString(s) {\n    try {\n        var rules = s.rules || s.cssRules;\n        return rules\n            ? Array.from(rules).reduce(function (prev, cur) { return prev + getCssRuleString(cur); }, '')\n            : null;\n    }\n    catch (error) {\n        return null;\n    }\n}\nfunction getCssRuleString(rule) {\n    return isCSSImportRule(rule)\n        ? getCssRulesString(rule.styleSheet) || ''\n        : rule.cssText;\n}\nfunction isCSSImportRule(rule) {\n    return 'styleSheet' in rule;\n}\nfunction extractOrigin(url) {\n    var origin;\n    if (url.indexOf('//') > -1) {\n        origin = url\n            .split('/')\n            .slice(0, 3)\n            .join('/');\n    }\n    else {\n        origin = url.split('/')[0];\n    }\n    origin = origin.split('?')[0];\n    return origin;\n}\nvar URL_IN_CSS_REF = /url\\((?:'([^']*)'|\"([^\"]*)\"|([^)]*))\\)/gm;\nvar RELATIVE_PATH = /^(?!www\\.|(?:http|ftp)s?:\\/\\/|[A-Za-z]:\\\\|\\/\\/).*/;\nvar DATA_URI = /^(data:)([\\w\\/\\+\\-]+);(charset=[\\w-]+|base64).*,(.*)/i;\nfunction absoluteToStylesheet(cssText, href) {\n    return cssText.replace(URL_IN_CSS_REF, function (origin, path1, path2, path3) {\n        var filePath = path1 || path2 || path3;\n        if (!filePath) {\n            return origin;\n        }\n        if (!RELATIVE_PATH.test(filePath)) {\n            return \"url('\" + filePath + \"')\";\n        }\n        if (DATA_URI.test(filePath)) {\n            return \"url(\" + filePath + \")\";\n        }\n        if (filePath[0] === '/') {\n            return \"url('\" + (extractOrigin(href) + filePath) + \"')\";\n        }\n        var stack = href.split('/');\n        var parts = filePath.split('/');\n        stack.pop();\n        for (var _i = 0, parts_1 = parts; _i < parts_1.length; _i++) {\n            var part = parts_1[_i];\n            if (part === '.') {\n                continue;\n            }\n            else if (part === '..') {\n                stack.pop();\n            }\n            else {\n                stack.push(part);\n            }\n        }\n        return \"url('\" + stack.join('/') + \"')\";\n    });\n}\nfunction getAbsoluteSrcsetString(doc, attributeValue) {\n    if (attributeValue.trim() === '') {\n        return attributeValue;\n    }\n    var srcsetValues = attributeValue.split(',');\n    var resultingSrcsetString = srcsetValues\n        .map(function (srcItem) {\n        var trimmedSrcItem = srcItem.trimLeft().trimRight();\n        var urlAndSize = trimmedSrcItem.split(' ');\n        if (urlAndSize.length === 2) {\n            var absUrl = absoluteToDoc(doc, urlAndSize[0]);\n            return absUrl + \" \" + urlAndSize[1];\n        }\n        else if (urlAndSize.length === 1) {\n            var absUrl = absoluteToDoc(doc, urlAndSize[0]);\n            return \"\" + absUrl;\n        }\n        return '';\n    })\n        .join(',');\n    return resultingSrcsetString;\n}\nfunction absoluteToDoc(doc, attributeValue) {\n    if (attributeValue.trim() === '') {\n        return attributeValue;\n    }\n    var a = doc.createElement('a');\n    a.href = attributeValue;\n    return a.href;\n}\nfunction isSVGElement(el) {\n    return el.tagName === 'svg' || el instanceof SVGElement;\n}\nfunction transformAttribute(doc, name, value) {\n    if (name === 'src' || (name === 'href' && value)) {\n        return absoluteToDoc(doc, value);\n    }\n    else if (name === 'srcset' && value) {\n        return getAbsoluteSrcsetString(doc, value);\n    }\n    else if (name === 'style' && value) {\n        return absoluteToStylesheet(value, location.href);\n    }\n    else {\n        return value;\n    }\n}\nfunction serializeNode(n, doc, blockClass, inlineStylesheet, maskAllInputs) {\n    switch (n.nodeType) {\n        case n.DOCUMENT_NODE:\n            return {\n                type: NodeType.Document,\n                childNodes: []\n            };\n        case n.DOCUMENT_TYPE_NODE:\n            return {\n                type: NodeType.DocumentType,\n                name: n.name,\n                publicId: n.publicId,\n                systemId: n.systemId\n            };\n        case n.ELEMENT_NODE:\n            var needBlock_1 = false;\n            if (typeof blockClass === 'string') {\n                needBlock_1 = n.classList.contains(blockClass);\n            }\n            else {\n                n.classList.forEach(function (className) {\n                    if (blockClass.test(className)) {\n                        needBlock_1 = true;\n                    }\n                });\n            }\n            var tagName = getValidTagName(n.tagName);\n            var attributes_1 = {};\n            for (var _i = 0, _a = Array.from(n.attributes); _i < _a.length; _i++) {\n                var _b = _a[_i], name = _b.name, value = _b.value;\n                attributes_1[name] = transformAttribute(doc, name, value);\n            }\n            if (tagName === 'link' && inlineStylesheet) {\n                var stylesheet = Array.from(doc.styleSheets).find(function (s) {\n                    return s.href === n.href;\n                });\n                var cssText = getCssRulesString(stylesheet);\n                if (cssText) {\n                    delete attributes_1.rel;\n                    delete attributes_1.href;\n                    attributes_1._cssText = absoluteToStylesheet(cssText, stylesheet.href);\n                }\n            }\n            if (tagName === 'style' &&\n                n.sheet &&\n                !(n.innerText ||\n                    n.textContent ||\n                    '').trim().length) {\n                var cssText = getCssRulesString(n.sheet);\n                if (cssText) {\n                    attributes_1._cssText = absoluteToStylesheet(cssText, location.href);\n                }\n            }\n            if (tagName === 'input' ||\n                tagName === 'textarea' ||\n                tagName === 'select') {\n                var value = n.value;\n                if (attributes_1.type !== 'radio' &&\n                    attributes_1.type !== 'checkbox' &&\n                    value) {\n                    attributes_1.value = maskAllInputs ? '*'.repeat(value.length) : value;\n                }\n                else if (n.checked) {\n                    attributes_1.checked = n.checked;\n                }\n            }\n            if (tagName === 'option') {\n                var selectValue = n.parentElement;\n                if (attributes_1.value === selectValue.value) {\n                    attributes_1.selected = n.selected;\n                }\n            }\n            if (tagName === 'canvas') {\n                attributes_1.rr_dataURL = n.toDataURL();\n            }\n            if (tagName === 'audio' || tagName === 'video') {\n                attributes_1.rr_mediaState = n.paused\n                    ? 'paused'\n                    : 'played';\n            }\n            if (needBlock_1) {\n                var _c = n.getBoundingClientRect(), width = _c.width, height = _c.height;\n                attributes_1.rr_width = width + \"px\";\n                attributes_1.rr_height = height + \"px\";\n            }\n            return {\n                type: NodeType.Element,\n                tagName: tagName,\n                attributes: attributes_1,\n                childNodes: [],\n                isSVG: isSVGElement(n) || undefined,\n                needBlock: needBlock_1\n            };\n        case n.TEXT_NODE:\n            var parentTagName = n.parentNode && n.parentNode.tagName;\n            var textContent = n.textContent;\n            var isStyle = parentTagName === 'STYLE' ? true : undefined;\n            if (isStyle && textContent) {\n                textContent = absoluteToStylesheet(textContent, location.href);\n            }\n            if (parentTagName === 'SCRIPT') {\n                textContent = 'SCRIPT_PLACEHOLDER';\n            }\n            return {\n                type: NodeType.Text,\n                textContent: textContent || '',\n                isStyle: isStyle\n            };\n        case n.CDATA_SECTION_NODE:\n            return {\n                type: NodeType.CDATA,\n                textContent: ''\n            };\n        case n.COMMENT_NODE:\n            return {\n                type: NodeType.Comment,\n                textContent: n.textContent || ''\n            };\n        default:\n            return false;\n    }\n}\nfunction serializeNodeWithId(n, doc, map, blockClass, skipChild, inlineStylesheet, maskAllInputs) {\n    if (skipChild === void 0) { skipChild = false; }\n    if (inlineStylesheet === void 0) { inlineStylesheet = true; }\n    if (maskAllInputs === void 0) { maskAllInputs = false; }\n    var _serializedNode = serializeNode(n, doc, blockClass, inlineStylesheet, maskAllInputs);\n    if (!_serializedNode) {\n        console.warn(n, 'not serialized');\n        return null;\n    }\n    var id;\n    if ('__sn' in n) {\n        id = n.__sn.id;\n    }\n    else {\n        id = genId();\n    }\n    var serializedNode = Object.assign(_serializedNode, { id: id });\n    n.__sn = serializedNode;\n    map[id] = n;\n    var recordChild = !skipChild;\n    if (serializedNode.type === NodeType.Element) {\n        recordChild = recordChild && !serializedNode.needBlock;\n        delete serializedNode.needBlock;\n    }\n    if ((serializedNode.type === NodeType.Document ||\n        serializedNode.type === NodeType.Element) &&\n        recordChild) {\n        for (var _i = 0, _a = Array.from(n.childNodes); _i < _a.length; _i++) {\n            var childN = _a[_i];\n            var serializedChildNode = serializeNodeWithId(childN, doc, map, blockClass, skipChild, inlineStylesheet, maskAllInputs);\n            if (serializedChildNode) {\n                serializedNode.childNodes.push(serializedChildNode);\n            }\n        }\n    }\n    return serializedNode;\n}\nfunction snapshot(n, blockClass, inlineStylesheet, maskAllInputs) {\n    if (blockClass === void 0) { blockClass = 'rr-block'; }\n    if (inlineStylesheet === void 0) { inlineStylesheet = true; }\n    if (maskAllInputs === void 0) { maskAllInputs = false; }\n    var idNodeMap = {};\n    return [\n        serializeNodeWithId(n, n, idNodeMap, blockClass, false, inlineStylesheet, maskAllInputs),\n        idNodeMap,\n    ];\n}\n\nvar commentre = /\\/\\*[^*]*\\*+([^/*][^*]*\\*+)*\\//g;\nfunction parse(css, options) {\n    if (options === void 0) { options = {}; }\n    var lineno = 1;\n    var column = 1;\n    function updatePosition(str) {\n        var lines = str.match(/\\n/g);\n        if (lines) {\n            lineno += lines.length;\n        }\n        var i = str.lastIndexOf('\\n');\n        column = i === -1 ? column + str.length : str.length - i;\n    }\n    function position() {\n        var start = { line: lineno, column: column };\n        return function (node) {\n            node.position = new Position(start);\n            whitespace();\n            return node;\n        };\n    }\n    var Position = (function () {\n        function Position(start) {\n            this.start = start;\n            this.end = { line: lineno, column: column };\n            this.source = options.source;\n        }\n        return Position;\n    }());\n    Position.prototype.content = css;\n    var errorsList = [];\n    function error(msg) {\n        var err = new Error(options.source + ':' + lineno + ':' + column + ': ' + msg);\n        err.reason = msg;\n        err.filename = options.source;\n        err.line = lineno;\n        err.column = column;\n        err.source = css;\n        if (options.silent) {\n            errorsList.push(err);\n        }\n        else {\n            throw err;\n        }\n    }\n    function stylesheet() {\n        var rulesList = rules();\n        return {\n            type: 'stylesheet',\n            stylesheet: {\n                source: options.source,\n                rules: rulesList,\n                parsingErrors: errorsList\n            }\n        };\n    }\n    function open() {\n        return match(/^{\\s*/);\n    }\n    function close() {\n        return match(/^}/);\n    }\n    function rules() {\n        var node;\n        var rules = [];\n        whitespace();\n        comments(rules);\n        while (css.length && css.charAt(0) !== '}' && (node = atrule() || rule())) {\n            if (node !== false) {\n                rules.push(node);\n                comments(rules);\n            }\n        }\n        return rules;\n    }\n    function match(re) {\n        var m = re.exec(css);\n        if (!m) {\n            return;\n        }\n        var str = m[0];\n        updatePosition(str);\n        css = css.slice(str.length);\n        return m;\n    }\n    function whitespace() {\n        match(/^\\s*/);\n    }\n    function comments(rules) {\n        if (rules === void 0) { rules = []; }\n        var c;\n        while ((c = comment())) {\n            if (c !== false) {\n                rules.push(c);\n            }\n            c = comment();\n        }\n        return rules;\n    }\n    function comment() {\n        var pos = position();\n        if ('/' !== css.charAt(0) || '*' !== css.charAt(1)) {\n            return;\n        }\n        var i = 2;\n        while ('' !== css.charAt(i) &&\n            ('*' !== css.charAt(i) || '/' !== css.charAt(i + 1))) {\n            ++i;\n        }\n        i += 2;\n        if ('' === css.charAt(i - 1)) {\n            return error('End of comment missing');\n        }\n        var str = css.slice(2, i - 2);\n        column += 2;\n        updatePosition(str);\n        css = css.slice(i);\n        column += 2;\n        return pos({\n            type: 'comment',\n            comment: str\n        });\n    }\n    function selector() {\n        var m = match(/^([^{]+)/);\n        if (!m) {\n            return;\n        }\n        return trim(m[0])\n            .replace(/\\/\\*([^*]|[\\r\\n]|(\\*+([^*/]|[\\r\\n])))*\\*\\/+/g, '')\n            .replace(/\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'/g, function (m) {\n            return m.replace(/,/g, '\\u200C');\n        })\n            .split(/\\s*(?![^(]*\\)),\\s*/)\n            .map(function (s) {\n            return s.replace(/\\u200C/g, ',');\n        });\n    }\n    function declaration() {\n        var pos = position();\n        var propMatch = match(/^(\\*?[-#\\/\\*\\\\\\w]+(\\[[0-9a-z_-]+\\])?)\\s*/);\n        if (!propMatch) {\n            return;\n        }\n        var prop = trim(propMatch[0]);\n        if (!match(/^:\\s*/)) {\n            return error(\"property missing ':'\");\n        }\n        var val = match(/^((?:'(?:\\\\'|.)*?'|\"(?:\\\\\"|.)*?\"|\\([^\\)]*?\\)|[^};])+)/);\n        var ret = pos({\n            type: 'declaration',\n            property: prop.replace(commentre, ''),\n            value: val ? trim(val[0]).replace(commentre, '') : ''\n        });\n        match(/^[;\\s]*/);\n        return ret;\n    }\n    function declarations() {\n        var decls = [];\n        if (!open()) {\n            return error(\"missing '{'\");\n        }\n        comments(decls);\n        var decl;\n        while ((decl = declaration())) {\n            if (decl !== false) {\n                decls.push(decl);\n                comments(decls);\n            }\n            decl = declaration();\n        }\n        if (!close()) {\n            return error(\"missing '}'\");\n        }\n        return decls;\n    }\n    function keyframe() {\n        var m;\n        var vals = [];\n        var pos = position();\n        while ((m = match(/^((\\d+\\.\\d+|\\.\\d+|\\d+)%?|[a-z]+)\\s*/))) {\n            vals.push(m[1]);\n            match(/^,\\s*/);\n        }\n        if (!vals.length) {\n            return;\n        }\n        return pos({\n            type: 'keyframe',\n            values: vals,\n            declarations: declarations()\n        });\n    }\n    function atkeyframes() {\n        var pos = position();\n        var m = match(/^@([-\\w]+)?keyframes\\s*/);\n        if (!m) {\n            return;\n        }\n        var vendor = m[1];\n        m = match(/^([-\\w]+)\\s*/);\n        if (!m) {\n            return error('@keyframes missing name');\n        }\n        var name = m[1];\n        if (!open()) {\n            return error(\"@keyframes missing '{'\");\n        }\n        var frame;\n        var frames = comments();\n        while ((frame = keyframe())) {\n            frames.push(frame);\n            frames = frames.concat(comments());\n        }\n        if (!close()) {\n            return error(\"@keyframes missing '}'\");\n        }\n        return pos({\n            type: 'keyframes',\n            name: name,\n            vendor: vendor,\n            keyframes: frames\n        });\n    }\n    function atsupports() {\n        var pos = position();\n        var m = match(/^@supports *([^{]+)/);\n        if (!m) {\n            return;\n        }\n        var supports = trim(m[1]);\n        if (!open()) {\n            return error(\"@supports missing '{'\");\n        }\n        var style = comments().concat(rules());\n        if (!close()) {\n            return error(\"@supports missing '}'\");\n        }\n        return pos({\n            type: 'supports',\n            supports: supports,\n            rules: style\n        });\n    }\n    function athost() {\n        var pos = position();\n        var m = match(/^@host\\s*/);\n        if (!m) {\n            return;\n        }\n        if (!open()) {\n            return error(\"@host missing '{'\");\n        }\n        var style = comments().concat(rules());\n        if (!close()) {\n            return error(\"@host missing '}'\");\n        }\n        return pos({\n            type: 'host',\n            rules: style\n        });\n    }\n    function atmedia() {\n        var pos = position();\n        var m = match(/^@media *([^{]+)/);\n        if (!m) {\n            return;\n        }\n        var media = trim(m[1]);\n        if (!open()) {\n            return error(\"@media missing '{'\");\n        }\n        var style = comments().concat(rules());\n        if (!close()) {\n            return error(\"@media missing '}'\");\n        }\n        return pos({\n            type: 'media',\n            media: media,\n            rules: style\n        });\n    }\n    function atcustommedia() {\n        var pos = position();\n        var m = match(/^@custom-media\\s+(--[^\\s]+)\\s*([^{;]+);/);\n        if (!m) {\n            return;\n        }\n        return pos({\n            type: 'custom-media',\n            name: trim(m[1]),\n            media: trim(m[2])\n        });\n    }\n    function atpage() {\n        var pos = position();\n        var m = match(/^@page */);\n        if (!m) {\n            return;\n        }\n        var sel = selector() || [];\n        if (!open()) {\n            return error(\"@page missing '{'\");\n        }\n        var decls = comments();\n        var decl;\n        while ((decl = declaration())) {\n            decls.push(decl);\n            decls = decls.concat(comments());\n        }\n        if (!close()) {\n            return error(\"@page missing '}'\");\n        }\n        return pos({\n            type: 'page',\n            selectors: sel,\n            declarations: decls\n        });\n    }\n    function atdocument() {\n        var pos = position();\n        var m = match(/^@([-\\w]+)?document *([^{]+)/);\n        if (!m) {\n            return;\n        }\n        var vendor = trim(m[1]);\n        var doc = trim(m[2]);\n        if (!open()) {\n            return error(\"@document missing '{'\");\n        }\n        var style = comments().concat(rules());\n        if (!close()) {\n            return error(\"@document missing '}'\");\n        }\n        return pos({\n            type: 'document',\n            document: doc,\n            vendor: vendor,\n            rules: style\n        });\n    }\n    function atfontface() {\n        var pos = position();\n        var m = match(/^@font-face\\s*/);\n        if (!m) {\n            return;\n        }\n        if (!open()) {\n            return error(\"@font-face missing '{'\");\n        }\n        var decls = comments();\n        var decl;\n        while ((decl = declaration())) {\n            decls.push(decl);\n            decls = decls.concat(comments());\n        }\n        if (!close()) {\n            return error(\"@font-face missing '}'\");\n        }\n        return pos({\n            type: 'font-face',\n            declarations: decls\n        });\n    }\n    var atimport = _compileAtrule('import');\n    var atcharset = _compileAtrule('charset');\n    var atnamespace = _compileAtrule('namespace');\n    function _compileAtrule(name) {\n        var re = new RegExp('^@' + name + '\\\\s*([^;]+);');\n        return function () {\n            var pos = position();\n            var m = match(re);\n            if (!m) {\n                return;\n            }\n            var ret = { type: name };\n            ret[name] = m[1].trim();\n            return pos(ret);\n        };\n    }\n    function atrule() {\n        if (css[0] !== '@') {\n            return;\n        }\n        return (atkeyframes() ||\n            atmedia() ||\n            atcustommedia() ||\n            atsupports() ||\n            atimport() ||\n            atcharset() ||\n            atnamespace() ||\n            atdocument() ||\n            atpage() ||\n            athost() ||\n            atfontface());\n    }\n    function rule() {\n        var pos = position();\n        var sel = selector();\n        if (!sel) {\n            return error('selector missing');\n        }\n        comments();\n        return pos({\n            type: 'rule',\n            selectors: sel,\n            declarations: declarations()\n        });\n    }\n    return addParent(stylesheet());\n}\nfunction trim(str) {\n    return str ? str.replace(/^\\s+|\\s+$/g, '') : '';\n}\nfunction addParent(obj, parent) {\n    var isNode = obj && typeof obj.type === 'string';\n    var childParent = isNode ? obj : parent;\n    for (var _i = 0, _a = Object.keys(obj); _i < _a.length; _i++) {\n        var k = _a[_i];\n        var value = obj[k];\n        if (Array.isArray(value)) {\n            value.forEach(function (v) {\n                addParent(v, childParent);\n            });\n        }\n        else if (value && typeof value === 'object') {\n            addParent(value, childParent);\n        }\n    }\n    if (isNode) {\n        Object.defineProperty(obj, 'parent', {\n            configurable: true,\n            writable: true,\n            enumerable: false,\n            value: parent || null\n        });\n    }\n    return obj;\n}\n\nvar tagMap = {\n    script: 'noscript',\n    altglyph: 'altGlyph',\n    altglyphdef: 'altGlyphDef',\n    altglyphitem: 'altGlyphItem',\n    animatecolor: 'animateColor',\n    animatemotion: 'animateMotion',\n    animatetransform: 'animateTransform',\n    clippath: 'clipPath',\n    feblend: 'feBlend',\n    fecolormatrix: 'feColorMatrix',\n    fecomponenttransfer: 'feComponentTransfer',\n    fecomposite: 'feComposite',\n    feconvolvematrix: 'feConvolveMatrix',\n    fediffuselighting: 'feDiffuseLighting',\n    fedisplacementmap: 'feDisplacementMap',\n    fedistantlight: 'feDistantLight',\n    fedropshadow: 'feDropShadow',\n    feflood: 'feFlood',\n    fefunca: 'feFuncA',\n    fefuncb: 'feFuncB',\n    fefuncg: 'feFuncG',\n    fefuncr: 'feFuncR',\n    fegaussianblur: 'feGaussianBlur',\n    feimage: 'feImage',\n    femerge: 'feMerge',\n    femergenode: 'feMergeNode',\n    femorphology: 'feMorphology',\n    feoffset: 'feOffset',\n    fepointlight: 'fePointLight',\n    fespecularlighting: 'feSpecularLighting',\n    fespotlight: 'feSpotLight',\n    fetile: 'feTile',\n    feturbulence: 'feTurbulence',\n    foreignobject: 'foreignObject',\n    glyphref: 'glyphRef',\n    lineargradient: 'linearGradient',\n    radialgradient: 'radialGradient'\n};\nfunction getTagName(n) {\n    var tagName = tagMap[n.tagName] ? tagMap[n.tagName] : n.tagName;\n    if (tagName === 'link' && n.attributes._cssText) {\n        tagName = 'style';\n    }\n    return tagName;\n}\nvar HOVER_SELECTOR = /([^\\\\]):hover/g;\nfunction addHoverClass(cssText) {\n    var ast = parse(cssText, { silent: true });\n    if (!ast.stylesheet) {\n        return cssText;\n    }\n    ast.stylesheet.rules.forEach(function (rule) {\n        if ('selectors' in rule) {\n            (rule.selectors || []).forEach(function (selector) {\n                if (HOVER_SELECTOR.test(selector)) {\n                    var newSelector = selector.replace(HOVER_SELECTOR, '$1.\\\\:hover');\n                    cssText = cssText.replace(selector, selector + \", \" + newSelector);\n                }\n            });\n        }\n    });\n    return cssText;\n}\nfunction buildNode(n, doc, HACK_CSS) {\n    switch (n.type) {\n        case NodeType.Document:\n            return doc.implementation.createDocument(null, '', null);\n        case NodeType.DocumentType:\n            return doc.implementation.createDocumentType(n.name, n.publicId, n.systemId);\n        case NodeType.Element:\n            var tagName = getTagName(n);\n            var node_1;\n            if (n.isSVG) {\n                node_1 = doc.createElementNS('http://www.w3.org/2000/svg', tagName);\n            }\n            else {\n                node_1 = doc.createElement(tagName);\n            }\n            var _loop_1 = function (name) {\n                if (!n.attributes.hasOwnProperty(name)) {\n                    return \"continue\";\n                }\n                var value = n.attributes[name];\n                value = typeof value === 'boolean' ? '' : value;\n                if (!name.startsWith('rr_')) {\n                    var isTextarea = tagName === 'textarea' && name === 'value';\n                    var isRemoteOrDynamicCss = tagName === 'style' && name === '_cssText';\n                    if (isRemoteOrDynamicCss && HACK_CSS) {\n                        value = addHoverClass(value);\n                    }\n                    if (isTextarea || isRemoteOrDynamicCss) {\n                        var child = doc.createTextNode(value);\n                        for (var _i = 0, _a = Array.from(node_1.childNodes); _i < _a.length; _i++) {\n                            var c = _a[_i];\n                            if (c.nodeType === node_1.TEXT_NODE) {\n                                node_1.removeChild(c);\n                            }\n                        }\n                        node_1.appendChild(child);\n                        return \"continue\";\n                    }\n                    if (tagName === 'iframe' && name === 'src') {\n                        return \"continue\";\n                    }\n                    try {\n                        if (n.isSVG && name === 'xlink:href') {\n                            node_1.setAttributeNS('http://www.w3.org/1999/xlink', name, value);\n                        }\n                        else {\n                            node_1.setAttribute(name, value);\n                        }\n                    }\n                    catch (error) {\n                    }\n                }\n                else {\n                    if (tagName === 'canvas' && name === 'rr_dataURL') {\n                        var image_1 = document.createElement('img');\n                        image_1.src = value;\n                        image_1.onload = function () {\n                            var ctx = node_1.getContext('2d');\n                            if (ctx) {\n                                ctx.drawImage(image_1, 0, 0, image_1.width, image_1.height);\n                            }\n                        };\n                    }\n                    if (name === 'rr_width') {\n                        node_1.style.width = value;\n                    }\n                    if (name === 'rr_height') {\n                        node_1.style.height = value;\n                    }\n                    if (name === 'rr_mediaState') {\n                        switch (value) {\n                            case 'played':\n                                node_1.play();\n                            case 'paused':\n                                node_1.pause();\n                                break;\n                            default:\n                        }\n                    }\n                }\n            };\n            for (var name in n.attributes) {\n                _loop_1(name);\n            }\n            return node_1;\n        case NodeType.Text:\n            return doc.createTextNode(n.isStyle && HACK_CSS ? addHoverClass(n.textContent) : n.textContent);\n        case NodeType.CDATA:\n            return doc.createCDATASection(n.textContent);\n        case NodeType.Comment:\n            return doc.createComment(n.textContent);\n        default:\n            return null;\n    }\n}\nfunction buildNodeWithSN(n, doc, map, skipChild, HACK_CSS) {\n    if (skipChild === void 0) { skipChild = false; }\n    if (HACK_CSS === void 0) { HACK_CSS = true; }\n    var node = buildNode(n, doc, HACK_CSS);\n    if (!node) {\n        return null;\n    }\n    if (n.type === NodeType.Document) {\n        doc.close();\n        doc.open();\n        node = doc;\n    }\n    node.__sn = n;\n    map[n.id] = node;\n    if ((n.type === NodeType.Document || n.type === NodeType.Element) &&\n        !skipChild) {\n        for (var _i = 0, _a = n.childNodes; _i < _a.length; _i++) {\n            var childN = _a[_i];\n            var childNode = buildNodeWithSN(childN, doc, map, false, HACK_CSS);\n            if (!childNode) {\n                console.warn('Failed to rebuild', childN);\n            }\n            else {\n                node.appendChild(childNode);\n            }\n        }\n    }\n    return node;\n}\nfunction rebuild(n, doc, HACK_CSS) {\n    if (HACK_CSS === void 0) { HACK_CSS = true; }\n    var idNodeMap = {};\n    return [buildNodeWithSN(n, doc, idNodeMap, false, HACK_CSS), idNodeMap];\n}\n\nexport { snapshot, serializeNodeWithId, rebuild, buildNodeWithSN, addHoverClass, transformAttribute, NodeType };\n","import {\n  Mirror,\n  throttleOptions,\n  listenerHandler,\n  hookResetter,\n  blockClass,\n} from './types';\nimport { INode } from 'rrweb-snapshot';\n\nexport function on(\n  type: string,\n  fn: EventListenerOrEventListenerObject,\n  target: Document | Window = document,\n): listenerHandler {\n  const options = { capture: true, passive: true };\n  target.addEventListener(type, fn, options);\n  return () => target.removeEventListener(type, fn, options);\n}\n\nexport const mirror: Mirror = {\n  map: {},\n  getId(n) {\n    // if n is not a serialized INode, use -1 as its id.\n    if (!n.__sn) {\n      return -1;\n    }\n    return n.__sn.id;\n  },\n  getNode(id) {\n    return mirror.map[id] || null;\n  },\n  // TODO: use a weakmap to get rid of manually memory management\n  removeNodeFromMap(n) {\n    const id = n.__sn && n.__sn.id;\n    delete mirror.map[id];\n    if (n.childNodes) {\n      n.childNodes.forEach(child =>\n        mirror.removeNodeFromMap((child as Node) as INode),\n      );\n    }\n  },\n  has(id) {\n    return mirror.map.hasOwnProperty(id);\n  },\n};\n\n// copy from underscore and modified\nexport function throttle<T>(\n  func: (arg: T) => void,\n  wait: number,\n  options: throttleOptions = {},\n) {\n  let timeout: number | null = null;\n  let previous = 0;\n  // tslint:disable-next-line: only-arrow-functions\n  return function(arg: T) {\n    let now = Date.now();\n    if (!previous && options.leading === false) {\n      previous = now;\n    }\n    let remaining = wait - (now - previous);\n    let context = this;\n    let args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        window.clearTimeout(timeout);\n        timeout = null;\n      }\n      previous = now;\n      func.apply(context, args);\n    } else if (!timeout && options.trailing !== false) {\n      timeout = window.setTimeout(() => {\n        previous = options.leading === false ? 0 : Date.now();\n        timeout = null;\n        func.apply(context, args);\n      }, remaining);\n    }\n  };\n}\n\nexport function hookSetter<T>(\n  target: T,\n  key: string | number | symbol,\n  d: PropertyDescriptor,\n  isRevoked?: boolean,\n): hookResetter {\n  const original = Object.getOwnPropertyDescriptor(target, key);\n  Object.defineProperty(\n    target,\n    key,\n    isRevoked\n      ? d\n      : {\n          set(value) {\n            // put hooked setter into event loop to avoid of set latency\n            setTimeout(() => {\n              d.set!.call(this, value);\n            }, 0);\n            if (original && original.set) {\n              original.set.call(this, value);\n            }\n          },\n        },\n  );\n  return () => hookSetter(target, key, original || {}, true);\n}\n\nexport function getWindowHeight(): number {\n  return (\n    window.innerHeight ||\n    (document.documentElement && document.documentElement.clientHeight) ||\n    (document.body && document.body.clientHeight)\n  );\n}\n\nexport function getWindowWidth(): number {\n  return (\n    window.innerWidth ||\n    (document.documentElement && document.documentElement.clientWidth) ||\n    (document.body && document.body.clientWidth)\n  );\n}\n\nexport function isBlocked(node: Node | null, blockClass: blockClass): boolean {\n  if (!node) {\n    return false;\n  }\n  if (node.nodeType === node.ELEMENT_NODE) {\n    let needBlock = false;\n    if (typeof blockClass === 'string') {\n      needBlock = (node as HTMLElement).classList.contains(blockClass);\n    } else {\n      (node as HTMLElement).classList.forEach(className => {\n        if (blockClass.test(className)) {\n          needBlock = true;\n        }\n      });\n    }\n    return needBlock || isBlocked(node.parentNode, blockClass);\n  }\n  return isBlocked(node.parentNode, blockClass);\n}\n\nexport function isAncestorRemoved(target: INode): boolean {\n  const id = mirror.getId(target);\n  if (!mirror.has(id)) {\n    return true;\n  }\n  if (\n    target.parentNode &&\n    target.parentNode.nodeType === target.DOCUMENT_NODE\n  ) {\n    return false;\n  }\n  // if the root is not document, it means the node is not in the DOM tree anymore\n  if (!target.parentNode) {\n    return true;\n  }\n  return isAncestorRemoved((target.parentNode as unknown) as INode);\n}\n\nexport function isTouchEvent(\n  event: MouseEvent | TouchEvent,\n): event is TouchEvent {\n  return Boolean((event as TouchEvent).changedTouches);\n}\n\nexport function polyfill() {\n  if ('NodeList' in window && !NodeList.prototype.forEach) {\n    NodeList.prototype.forEach = (Array.prototype\n      .forEach as unknown) as NodeList['forEach'];\n  }\n}\n","import { serializedNodeWithId, idNodeMap, INode } from 'rrweb-snapshot';\r\n\r\nexport enum EventType {\r\n  DomContentLoaded,\r\n  Load,\r\n  FullSnapshot,\r\n  IncrementalSnapshot,\r\n  Meta,\r\n  Custom,\r\n}\r\n\r\nexport type domContentLoadedEvent = {\r\n  type: EventType.DomContentLoaded;\r\n  data: {};\r\n};\r\n\r\nexport type loadedEvent = {\r\n  type: EventType.Load;\r\n  data: {};\r\n};\r\n\r\nexport type fullSnapshotEvent = {\r\n  type: EventType.FullSnapshot;\r\n  data: {\r\n    node: serializedNodeWithId;\r\n    initialOffset: {\r\n      top: number;\r\n      left: number;\r\n    };\r\n  };\r\n};\r\n\r\nexport type incrementalSnapshotEvent = {\r\n  type: EventType.IncrementalSnapshot;\r\n  data: incrementalData;\r\n};\r\n\r\nexport type metaEvent = {\r\n  type: EventType.Meta;\r\n  data: {\r\n    href: string;\r\n    width: number;\r\n    height: number;\r\n  };\r\n};\r\n\r\nexport type customEvent<T = unknown> = {\r\n  type: EventType.Custom;\r\n  data: {\r\n    tag: string;\r\n    payload: T;\r\n  };\r\n};\r\n\r\nexport enum IncrementalSource {\r\n  Mutation,\r\n  MouseMove,\r\n  MouseInteraction,\r\n  Scroll,\r\n  ViewportResize,\r\n  Input,\r\n  TouchMove,\r\n  MediaInteraction,\r\n  StyleSheetInteraction,\r\n}\r\n\r\nexport type mutationData = {\r\n  source: IncrementalSource.Mutation;\r\n} & mutationCallbackParam;\r\n\r\nexport type mousemoveData = {\r\n  source: IncrementalSource.MouseMove | IncrementalSource.TouchMove;\r\n  positions: mousePosition[];\r\n};\r\n\r\nexport type mouseInteractionData = {\r\n  source: IncrementalSource.MouseInteraction;\r\n} & mouseInteractionParam;\r\n\r\nexport type scrollData = {\r\n  source: IncrementalSource.Scroll;\r\n} & scrollPosition;\r\n\r\nexport type viewportResizeData = {\r\n  source: IncrementalSource.ViewportResize;\r\n} & viewportResizeDimention;\r\n\r\nexport type inputData = {\r\n  source: IncrementalSource.Input;\r\n  id: number;\r\n} & inputValue;\r\n\r\nexport type mediaInteractionData = {\r\n  source: IncrementalSource.MediaInteraction;\r\n} & mediaInteractionParam;\r\n\r\nexport type styleSheetInteractionData = {\r\n  source: IncrementalSource.StyleSheetInteraction;\r\n} & styleSheetInteractionParams;\r\n\r\nexport type incrementalData =\r\n  | mutationData\r\n  | mousemoveData\r\n  | mouseInteractionData\r\n  | scrollData\r\n  | viewportResizeData\r\n  | inputData\r\n  | mediaInteractionData\r\n  | styleSheetInteractionData;\r\n\r\nexport type event =\r\n  | domContentLoadedEvent\r\n  | loadedEvent\r\n  | fullSnapshotEvent\r\n  | incrementalSnapshotEvent\r\n  | metaEvent\r\n  | customEvent;\r\n\r\nexport type eventWithTime = event & {\r\n  timestamp: number;\r\n  delay?: number;\r\n};\r\n\r\nexport type blockClass = string | RegExp;\r\n\r\nexport type recordOptions = {\r\n  emit?: (e: eventWithTime, isCheckout?: boolean) => void;\r\n  checkoutEveryNth?: number;\r\n  checkoutEveryNms?: number;\r\n  blockClass?: blockClass;\r\n  ignoreClass?: string;\r\n  maskAllInputs?: boolean;\r\n  inlineStylesheet?: boolean;\r\n  hooks?: hooksParam;\r\n  mousemoveWait?: number;\r\n};\r\n\r\nexport type observerParam = {\r\n  mutationCb: mutationCallBack;\r\n  mousemoveCb: mousemoveCallBack;\r\n  mouseInteractionCb: mouseInteractionCallBack;\r\n  scrollCb: scrollCallback;\r\n  viewportResizeCb: viewportResizeCallback;\r\n  inputCb: inputCallback;\r\n  mediaInteractionCb: mediaInteractionCallback;\r\n  blockClass: blockClass;\r\n  ignoreClass: string;\r\n  maskAllInputs: boolean;\r\n  inlineStylesheet: boolean;\r\n  mousemoveWait: number;\r\n};\r\n\r\nexport type hooksParam = {\r\n  mutation?: mutationCallBack;\r\n  mousemove?: mousemoveCallBack;\r\n  mouseInteraction?: mouseInteractionCallBack;\r\n  scroll?: scrollCallback;\r\n  viewportResize?: viewportResizeCallback;\r\n  input?: inputCallback;\r\n  mediaInteaction?: mediaInteractionCallback;\r\n};\r\n\r\nexport type textCursor = {\r\n  node: Node;\r\n  value: string | null;\r\n};\r\nexport type textMutation = {\r\n  id: number;\r\n  value: string | null;\r\n};\r\n\r\nexport type attributeCursor = {\r\n  node: Node;\r\n  attributes: {\r\n    [key: string]: string | null;\r\n  };\r\n};\r\nexport type attributeMutation = {\r\n  id: number;\r\n  attributes: {\r\n    [key: string]: string | null;\r\n  };\r\n};\r\n\r\nexport type removedNodeMutation = {\r\n  parentId: number;\r\n  id: number;\r\n};\r\n\r\nexport type addedNodeMutation = {\r\n  parentId: number;\r\n  previousId: number | null;\r\n  nextId: number | null;\r\n  node: serializedNodeWithId;\r\n};\r\n\r\ntype mutationCallbackParam = {\r\n  texts: textMutation[];\r\n  attributes: attributeMutation[];\r\n  removes: removedNodeMutation[];\r\n  adds: addedNodeMutation[];\r\n};\r\n\r\nexport type mutationCallBack = (m: mutationCallbackParam) => void;\r\n\r\nexport type mousemoveCallBack = (\r\n  p: mousePosition[],\r\n  source: IncrementalSource.MouseMove | IncrementalSource.TouchMove,\r\n) => void;\r\n\r\nexport type mousePosition = {\r\n  x: number;\r\n  y: number;\r\n  id: number;\r\n  timeOffset: number;\r\n};\r\n\r\nexport enum MouseInteractions {\r\n  MouseUp,\r\n  MouseDown,\r\n  Click,\r\n  ContextMenu,\r\n  DblClick,\r\n  Focus,\r\n  Blur,\r\n  TouchStart,\r\n  TouchMove_Departed, // we will start a separate observer for touch move event\r\n  TouchEnd,\r\n}\r\n\r\ntype mouseInteractionParam = {\r\n  type: MouseInteractions;\r\n  id: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\nexport type mouseInteractionCallBack = (d: mouseInteractionParam) => void;\r\n\r\nexport type scrollPosition = {\r\n  id: number;\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\nexport type scrollCallback = (p: scrollPosition) => void;\r\n\r\nexport type viewportResizeDimention = {\r\n  width: number;\r\n  height: number;\r\n};\r\n\r\nexport type viewportResizeCallback = (d: viewportResizeDimention) => void;\r\n\r\nexport type inputValue = {\r\n  text: string;\r\n  isChecked: boolean;\r\n};\r\n\r\nexport type inputCallback = (v: inputValue & { id: number }) => void;\r\n\r\nexport const enum MediaInteractions {\r\n  Play,\r\n  Pause,\r\n}\r\n\r\nexport type mediaInteractionParam = {\r\n  type: MediaInteractions;\r\n  id: number;\r\n};\r\n\r\nexport const enum StyleSheetInteractions {\r\n  InsertRule,\r\n//  DeleteRule,\r\n}\r\n\r\nexport type styleSheetInteractionParams = {\r\n  type: StyleSheetInteractions;\r\n  rule: string;\r\n  index?: number;\r\n};\r\n\r\nexport type mediaInteractionCallback = (p: mediaInteractionParam) => void;\r\n\r\nexport type Mirror = {\r\n  map: idNodeMap;\r\n  getId: (n: INode) => number;\r\n  getNode: (id: number) => INode | null;\r\n  removeNodeFromMap: (n: INode) => void;\r\n  has: (id: number) => boolean;\r\n};\r\n\r\nexport type throttleOptions = {\r\n  leading?: boolean;\r\n  trailing?: boolean;\r\n};\r\n\r\nexport type listenerHandler = () => void;\r\nexport type hookResetter = () => void;\r\n\r\nexport type playerConfig = {\r\n  speed: number;\r\n  root: Element;\r\n  loadTimeout: number;\r\n  skipInactive: boolean;\r\n  showWarning: boolean;\r\n  showDebug: boolean;\r\n  blockClass: string;\r\n  liveMode: boolean;\r\n  insertStyleRules: string[];\r\n};\r\n\r\nexport type playerMetaData = {\r\n  totalTime: number;\r\n};\r\n\r\nexport type missingNode = {\r\n  node: Node;\r\n  mutation: addedNodeMutation;\r\n};\r\nexport type missingNodeMap = {\r\n  [id: number]: missingNode;\r\n};\r\n\r\nexport type actionWithDelay = {\r\n  doAction: () => void;\r\n  delay: number;\r\n};\r\n\r\nexport type Handler = (event?: unknown) => void;\r\n\r\nexport type Emitter = {\r\n  on(type: string, handler: Handler): void;\r\n  emit(type: string, event?: unknown): void;\r\n};\r\n\r\nexport type Arguments<T> = T extends (...payload: infer U) => unknown\r\n  ? U\r\n  : unknown;\r\n\r\nexport enum ReplayerEvents {\r\n  Start = 'start',\r\n  Pause = 'pause',\r\n  Resume = 'resume',\r\n  Resize = 'resize',\r\n  Finish = 'finish',\r\n  FullsnapshotRebuilded = 'fullsnapshot-rebuilded',\r\n  LoadStylesheetStart = 'load-stylesheet-start',\r\n  LoadStylesheetEnd = 'load-stylesheet-end',\r\n  SkipStart = 'skip-start',\r\n  SkipEnd = 'skip-end',\r\n  MouseInteraction = 'mouse-interaction',\r\n  EventCast = 'event-cast',\r\n}\r\n","/**\n * Some utils to handle the mutation observer DOM records.\n * It should be more clear to extend the native data structure\n * like Set and Map, but currently Typescript does not support\n * that.\n */\n\nimport { INode } from 'rrweb-snapshot';\nimport { removedNodeMutation } from '../types';\nimport { mirror } from '../utils';\n\nexport function deepDelete(addsSet: Set<Node>, n: Node) {\n  addsSet.delete(n);\n  n.childNodes.forEach(childN => deepDelete(addsSet, childN));\n}\n\nexport function isParentRemoved(\n  removes: removedNodeMutation[],\n  n: Node,\n): boolean {\n  const { parentNode } = n;\n  if (!parentNode) {\n    return false;\n  }\n  const parentId = mirror.getId((parentNode as Node) as INode);\n  if (removes.some(r => r.id === parentId)) {\n    return true;\n  }\n  return isParentRemoved(removes, parentNode);\n}\n\nexport function isAncestorInSet(set: Set<Node>, n: Node): boolean {\n  const { parentNode } = n;\n  if (!parentNode) {\n    return false;\n  }\n  if (set.has(parentNode)) {\n    return true;\n  }\n  return isAncestorInSet(set, parentNode);\n}\n","import { INode, serializeNodeWithId, transformAttribute } from 'rrweb-snapshot';\nimport {\n  mirror,\n  throttle,\n  on,\n  hookSetter,\n  getWindowHeight,\n  getWindowWidth,\n  isBlocked,\n  isAncestorRemoved,\n  isTouchEvent,\n} from '../utils';\nimport {\n  mutationCallBack,\n  removedNodeMutation,\n  addedNodeMutation,\n  observerParam,\n  mousemoveCallBack,\n  mousePosition,\n  mouseInteractionCallBack,\n  MouseInteractions,\n  listenerHandler,\n  scrollCallback,\n  viewportResizeCallback,\n  inputValue,\n  inputCallback,\n  hookResetter,\n  textCursor,\n  attributeCursor,\n  blockClass,\n  IncrementalSource,\n  hooksParam,\n  Arguments,\n  mediaInteractionCallback,\n  MediaInteractions,\n} from '../types';\nimport { deepDelete, isParentRemoved, isAncestorInSet } from './collection';\n\nconst moveKey = (id: number, parentId: number) => `${id}@${parentId}`;\nfunction isINode(n: Node | INode): n is INode {\n  return '__sn' in n;\n}\n\n/**\n * Mutation observer will merge several mutations into an array and pass\n * it to the callback function, this may make tracing added nodes hard.\n * For example, if we append an element el_1 into body, and then append\n * another element el_2 into el_1, these two mutations may be passed to the\n * callback function together when the two operations were done.\n * Generally we need trace child nodes of newly added node, but in this\n * case if we count el_2 as el_1's child node in the first mutation record,\n * then we will count el_2 again in the secoond mutation record which was\n * duplicated.\n * To avoid of duplicate counting added nodes, we will use a Set to store\n * added nodes and its child nodes during iterate mutation records. Then\n * collect added nodes from the Set which will has no duplicate copy. But\n * this also cause newly added node will not be serialized with id ASAP,\n * which means all the id related calculation should be lazy too.\n * @param cb mutationCallBack\n */\nfunction initMutationObserver(\n  cb: mutationCallBack,\n  blockClass: blockClass,\n  inlineStylesheet: boolean,\n  maskAllInputs: boolean,\n): MutationObserver {\n  const observer = new MutationObserver(mutations => {\n    const texts: textCursor[] = [];\n    const attributes: attributeCursor[] = [];\n    let removes: removedNodeMutation[] = [];\n    const adds: addedNodeMutation[] = [];\n\n    const addedSet = new Set<Node>();\n    const movedSet = new Set<Node>();\n    const droppedSet = new Set<Node>();\n\n    const movedMap: Record<string, true> = {};\n\n    const genAdds = (n: Node | INode, target?: Node | INode) => {\n      if (isBlocked(n, blockClass)) {\n        return;\n      }\n      if (isINode(n)) {\n        movedSet.add(n);\n        let targetId: number | null = null;\n        if (target && isINode(target)) {\n          targetId = target.__sn.id;\n        }\n        if (targetId) {\n          movedMap[moveKey(n.__sn.id, targetId)] = true;\n        }\n      } else {\n        addedSet.add(n);\n        droppedSet.delete(n);\n      }\n      n.childNodes.forEach(childN => genAdds(childN));\n    };\n\n    mutations.forEach(mutation => {\n      const {\n        type,\n        target,\n        oldValue,\n        addedNodes,\n        removedNodes,\n        attributeName,\n      } = mutation;\n      switch (type) {\n        case 'characterData': {\n          const value = target.textContent;\n          if (!isBlocked(target, blockClass) && value !== oldValue) {\n            texts.push({\n              value,\n              node: target,\n            });\n          }\n          break;\n        }\n        case 'attributes': {\n          const value = (target as HTMLElement).getAttribute(attributeName!);\n          if (isBlocked(target, blockClass) || value === oldValue) {\n            return;\n          }\n          let item: attributeCursor | undefined = attributes.find(\n            a => a.node === target,\n          );\n          if (!item) {\n            item = {\n              node: target,\n              attributes: {},\n            };\n            attributes.push(item);\n          }\n          // overwrite attribute if the mutations was triggered in same time\n          item.attributes[attributeName!] = transformAttribute(\n            document,\n            attributeName!,\n            value!,\n          );\n          break;\n        }\n        case 'childList': {\n          addedNodes.forEach(n => genAdds(n, target));\n          removedNodes.forEach(n => {\n            const nodeId = mirror.getId(n as INode);\n            const parentId = mirror.getId(target as INode);\n            if (isBlocked(n, blockClass)) {\n              return;\n            }\n            // removed node has not been serialized yet, just remove it from the Set\n            if (addedSet.has(n)) {\n              deepDelete(addedSet, n);\n              droppedSet.add(n);\n            } else if (addedSet.has(target) && nodeId === -1) {\n              /**\n               * If target was newly added and removed child node was\n               * not serialized, it means the child node has been removed\n               * before callback fired, so we can ignore it because\n               * newly added node will be serialized without child nodes.\n               * TODO: verify this\n               */\n            } else if (isAncestorRemoved(target as INode)) {\n              /**\n               * If parent id was not in the mirror map any more, it\n               * means the parent node has already been removed. So\n               * the node is also removed which we do not need to track\n               * and replay.\n               */\n            } else if (movedSet.has(n) && movedMap[moveKey(nodeId, parentId)]) {\n              deepDelete(movedSet, n);\n            } else {\n              removes.push({\n                parentId,\n                id: nodeId,\n              });\n            }\n            mirror.removeNodeFromMap(n as INode);\n          });\n          break;\n        }\n        default:\n          break;\n      }\n    });\n\n    /**\n     * Sometimes child node may be pushed before its newly added\n     * parent, so we init a queue to store these nodes.\n     */\n    const addQueue: Node[] = [];\n    const pushAdd = (n: Node) => {\n      const parentId = mirror.getId((n.parentNode as Node) as INode);\n      if (parentId === -1) {\n        return addQueue.push(n);\n      }\n      adds.push({\n        parentId,\n        previousId: !n.previousSibling\n          ? n.previousSibling\n          : mirror.getId(n.previousSibling as INode),\n        nextId: !n.nextSibling\n          ? n.nextSibling\n          : mirror.getId((n.nextSibling as unknown) as INode),\n        node: serializeNodeWithId(\n          n,\n          document,\n          mirror.map,\n          blockClass,\n          true,\n          inlineStylesheet,\n          maskAllInputs,\n        )!,\n      });\n    };\n\n    for (const n of movedSet) {\n      pushAdd(n);\n    }\n\n    for (const n of addedSet) {\n      if (!isAncestorInSet(droppedSet, n) && !isParentRemoved(removes, n)) {\n        pushAdd(n);\n      } else if (isAncestorInSet(movedSet, n)) {\n        pushAdd(n);\n      } else {\n        droppedSet.add(n);\n      }\n    }\n\n    while (addQueue.length) {\n      if (\n        addQueue.every(\n          n => mirror.getId((n.parentNode as Node) as INode) === -1,\n        )\n      ) {\n        /**\n         * If all nodes in queue could not find a serialized parent,\n         * it may be a bug or corner case. We need to escape the\n         * dead while loop at once.\n         */\n        break;\n      }\n      pushAdd(addQueue.shift()!);\n    }\n\n    const payload = {\n      texts: texts\n        .map(text => ({\n          id: mirror.getId(text.node as INode),\n          value: text.value,\n        }))\n        // text mutation's id was not in the mirror map means the target node has been removed\n        .filter(text => mirror.has(text.id)),\n      attributes: attributes\n        .map(attribute => ({\n          id: mirror.getId(attribute.node as INode),\n          attributes: attribute.attributes,\n        }))\n        // attribute mutation's id was not in the mirror map means the target node has been removed\n        .filter(attribute => mirror.has(attribute.id)),\n      removes,\n      adds,\n    };\n    // payload may be empty if the mutations happened in some blocked elements\n    if (\n      !payload.texts.length &&\n      !payload.attributes.length &&\n      !payload.removes.length &&\n      !payload.adds.length\n    ) {\n      return;\n    }\n    cb(payload);\n  });\n  observer.observe(document, {\n    attributes: true,\n    attributeOldValue: true,\n    characterData: true,\n    characterDataOldValue: true,\n    childList: true,\n    subtree: true,\n  });\n  return observer;\n}\n\nfunction initMoveObserver(\n  cb: mousemoveCallBack,\n  mousemoveWait: number,\n): listenerHandler {\n  let positions: mousePosition[] = [];\n  let timeBaseline: number | null;\n  const wrappedCb = throttle((isTouch: boolean) => {\n    const totalOffset = Date.now() - timeBaseline!;\n    cb(\n      positions.map(p => {\n        p.timeOffset -= totalOffset;\n        return p;\n      }),\n      isTouch ? IncrementalSource.TouchMove : IncrementalSource.MouseMove,\n    );\n    positions = [];\n    timeBaseline = null;\n  }, 500);\n  const updatePosition = throttle<MouseEvent | TouchEvent>(\n    evt => {\n      const { target } = evt;\n      const { clientX, clientY } = isTouchEvent(evt)\n        ? evt.changedTouches[0]\n        : evt;\n      if (!timeBaseline) {\n        timeBaseline = Date.now();\n      }\n      positions.push({\n        x: clientX,\n        y: clientY,\n        id: mirror.getId(target as INode),\n        timeOffset: Date.now() - timeBaseline,\n      });\n      wrappedCb(isTouchEvent(evt));\n    },\n    mousemoveWait,\n    {\n      trailing: false,\n    },\n  );\n  const handlers = [\n    on('mousemove', updatePosition),\n    on('touchmove', updatePosition),\n  ];\n  return () => {\n    handlers.forEach(h => h());\n  };\n}\n\nfunction initMouseInteractionObserver(\n  cb: mouseInteractionCallBack,\n  blockClass: blockClass,\n): listenerHandler {\n  const handlers: listenerHandler[] = [];\n  const getHandler = (eventKey: keyof typeof MouseInteractions) => {\n    return (event: MouseEvent | TouchEvent) => {\n      if (isBlocked(event.target as Node, blockClass)) {\n        return;\n      }\n      const id = mirror.getId(event.target as INode);\n      const { clientX, clientY } = isTouchEvent(event)\n        ? event.changedTouches[0]\n        : event;\n      cb({\n        type: MouseInteractions[eventKey],\n        id,\n        x: clientX,\n        y: clientY,\n      });\n    };\n  };\n  Object.keys(MouseInteractions)\n    .filter(key => Number.isNaN(Number(key)) && !key.endsWith('_Departed'))\n    .forEach((eventKey: keyof typeof MouseInteractions) => {\n      const eventName = eventKey.toLowerCase();\n      const handler = getHandler(eventKey);\n      handlers.push(on(eventName, handler));\n    });\n  return () => {\n    handlers.forEach(h => h());\n  };\n}\n\nfunction initScrollObserver(\n  cb: scrollCallback,\n  blockClass: blockClass,\n): listenerHandler {\n  const updatePosition = throttle<UIEvent>(evt => {\n    if (!evt.target || isBlocked(evt.target as Node, blockClass)) {\n      return;\n    }\n    const id = mirror.getId(evt.target as INode);\n    if (evt.target === document) {\n      const scrollEl = (document.scrollingElement || document.documentElement)!;\n      cb({\n        id,\n        x: scrollEl.scrollLeft,\n        y: scrollEl.scrollTop,\n      });\n    } else {\n      cb({\n        id,\n        x: (evt.target as HTMLElement).scrollLeft,\n        y: (evt.target as HTMLElement).scrollTop,\n      });\n    }\n  }, 100);\n  return on('scroll', updatePosition);\n}\n\nfunction initViewportResizeObserver(\n  cb: viewportResizeCallback,\n): listenerHandler {\n  const updateDimension = throttle(() => {\n    const height = getWindowHeight();\n    const width = getWindowWidth();\n    cb({\n      width: Number(width),\n      height: Number(height),\n    });\n  }, 200);\n  return on('resize', updateDimension, window);\n}\n\nconst INPUT_TAGS = ['INPUT', 'TEXTAREA', 'SELECT'];\nconst MASK_TYPES = [\n  'color',\n  'date',\n  'datetime-local',\n  'email',\n  'month',\n  'number',\n  'range',\n  'search',\n  'tel',\n  'text',\n  'time',\n  'url',\n  'week',\n];\nconst lastInputValueMap: WeakMap<EventTarget, inputValue> = new WeakMap();\nfunction initInputObserver(\n  cb: inputCallback,\n  blockClass: blockClass,\n  ignoreClass: string,\n  maskAllInputs: boolean,\n): listenerHandler {\n  function eventHandler(event: Event) {\n    const { target } = event;\n    if (\n      !target ||\n      !(target as Element).tagName ||\n      INPUT_TAGS.indexOf((target as Element).tagName) < 0 ||\n      isBlocked(target as Node, blockClass)\n    ) {\n      return;\n    }\n    const type: string | undefined = (target as HTMLInputElement).type;\n    if (\n      type === 'password' ||\n      (target as HTMLElement).classList.contains(ignoreClass)\n    ) {\n      return;\n    }\n    let text = (target as HTMLInputElement).value;\n    let isChecked = false;\n    const hasTextInput =\n      MASK_TYPES.includes(type) || (target as Element).tagName === 'TEXTAREA';\n    if (type === 'radio' || type === 'checkbox') {\n      isChecked = (target as HTMLInputElement).checked;\n    } else if (hasTextInput && maskAllInputs) {\n      text = '*'.repeat(text.length);\n    }\n    cbWithDedup(target, { text, isChecked });\n    // if a radio was checked\n    // the other radios with the same name attribute will be unchecked.\n    const name: string | undefined = (target as HTMLInputElement).name;\n    if (type === 'radio' && name && isChecked) {\n      document\n        .querySelectorAll(`input[type=\"radio\"][name=\"${name}\"]`)\n        .forEach(el => {\n          if (el !== target) {\n            cbWithDedup(el, {\n              text: (el as HTMLInputElement).value,\n              isChecked: !isChecked,\n            });\n          }\n        });\n    }\n  }\n  function cbWithDedup(target: EventTarget, v: inputValue) {\n    const lastInputValue = lastInputValueMap.get(target);\n    if (\n      !lastInputValue ||\n      lastInputValue.text !== v.text ||\n      lastInputValue.isChecked !== v.isChecked\n    ) {\n      lastInputValueMap.set(target, v);\n      const id = mirror.getId(target as INode);\n      cb({\n        ...v,\n        id,\n      });\n    }\n  }\n  const handlers: Array<listenerHandler | hookResetter> = [\n    'input',\n    'change',\n  ].map(eventName => on(eventName, eventHandler));\n  const propertyDescriptor = Object.getOwnPropertyDescriptor(\n    HTMLInputElement.prototype,\n    'value',\n  );\n  const hookProperties: Array<[HTMLElement, string]> = [\n    [HTMLInputElement.prototype, 'value'],\n    [HTMLInputElement.prototype, 'checked'],\n    [HTMLSelectElement.prototype, 'value'],\n    [HTMLTextAreaElement.prototype, 'value'],\n  ];\n  if (propertyDescriptor && propertyDescriptor.set) {\n    handlers.push(\n      ...hookProperties.map(p =>\n        hookSetter<HTMLElement>(p[0], p[1], {\n          set() {\n            // mock to a normal event\n            eventHandler({ target: this } as Event);\n          },\n        }),\n      ),\n    );\n  }\n  return () => {\n    handlers.forEach(h => h());\n  };\n}\n\nfunction initMediaInteractionObserver(\n  mediaInteractionCb: mediaInteractionCallback,\n  blockClass: blockClass,\n): listenerHandler {\n  const handler = (type: 'play' | 'pause') => (event: Event) => {\n    const { target } = event;\n    if (!target || isBlocked(target as Node, blockClass)) {\n      return;\n    }\n    mediaInteractionCb({\n      type: type === 'play' ? MediaInteractions.Play : MediaInteractions.Pause,\n      id: mirror.getId(target as INode),\n    });\n  };\n  const handlers = [on('play', handler('play')), on('pause', handler('pause'))];\n  return () => {\n    handlers.forEach(h => h());\n  };\n}\n\nfunction mergeHooks(o: observerParam, hooks: hooksParam) {\n  const {\n    mutationCb,\n    mousemoveCb,\n    mouseInteractionCb,\n    scrollCb,\n    viewportResizeCb,\n    inputCb,\n    mediaInteractionCb,\n  } = o;\n  o.mutationCb = (...p: Arguments<mutationCallBack>) => {\n    if (hooks.mutation) {\n      hooks.mutation(...p);\n    }\n    mutationCb(...p);\n  };\n  o.mousemoveCb = (...p: Arguments<mousemoveCallBack>) => {\n    if (hooks.mousemove) {\n      hooks.mousemove(...p);\n    }\n    mousemoveCb(...p);\n  };\n  o.mouseInteractionCb = (...p: Arguments<mouseInteractionCallBack>) => {\n    if (hooks.mouseInteraction) {\n      hooks.mouseInteraction(...p);\n    }\n    mouseInteractionCb(...p);\n  };\n  o.scrollCb = (...p: Arguments<scrollCallback>) => {\n    if (hooks.scroll) {\n      hooks.scroll(...p);\n    }\n    scrollCb(...p);\n  };\n  o.viewportResizeCb = (...p: Arguments<viewportResizeCallback>) => {\n    if (hooks.viewportResize) {\n      hooks.viewportResize(...p);\n    }\n    viewportResizeCb(...p);\n  };\n  o.inputCb = (...p: Arguments<inputCallback>) => {\n    if (hooks.input) {\n      hooks.input(...p);\n    }\n    inputCb(...p);\n  };\n  o.mediaInteractionCb = (...p: Arguments<mediaInteractionCallback>) => {\n    if (hooks.mediaInteaction) {\n      hooks.mediaInteaction(...p);\n    }\n    mediaInteractionCb(...p);\n  };\n}\n\nexport default function initObservers(\n  o: observerParam,\n  hooks: hooksParam = {},\n): listenerHandler {\n  mergeHooks(o, hooks);\n  const mutationObserver = initMutationObserver(\n    o.mutationCb,\n    o.blockClass,\n    o.inlineStylesheet,\n    o.maskAllInputs,\n  );\n  const mousemoveHandler = initMoveObserver(o.mousemoveCb, o.mousemoveWait);\n  const mouseInteractionHandler = initMouseInteractionObserver(\n    o.mouseInteractionCb,\n    o.blockClass,\n  );\n  const scrollHandler = initScrollObserver(o.scrollCb, o.blockClass);\n  const viewportResizeHandler = initViewportResizeObserver(o.viewportResizeCb);\n  const inputHandler = initInputObserver(\n    o.inputCb,\n    o.blockClass,\n    o.ignoreClass,\n    o.maskAllInputs,\n  );\n  const mediaInteractionHandler = initMediaInteractionObserver(\n    o.mediaInteractionCb,\n    o.blockClass,\n  );\n  return () => {\n    mutationObserver.disconnect();\n    mousemoveHandler();\n    mouseInteractionHandler();\n    scrollHandler();\n    viewportResizeHandler();\n    inputHandler();\n    mediaInteractionHandler();\n  };\n}\n","import { snapshot } from 'rrweb-snapshot';\r\nimport initObservers from './observer';\r\nimport {\r\n  mirror,\r\n  on,\r\n  getWindowWidth,\r\n  getWindowHeight,\r\n  polyfill,\r\n} from '../utils';\r\nimport {\r\n  EventType,\r\n  event,\r\n  eventWithTime,\r\n  recordOptions,\r\n  IncrementalSource,\r\n  listenerHandler,\r\n  StyleSheetInteractions,\r\n} from '../types';\r\n\r\nfunction wrapEvent(e: event): eventWithTime {\r\n  return {\r\n    ...e,\r\n    timestamp: Date.now(),\r\n  };\r\n}\r\n\r\nlet wrappedEmit!: (e: eventWithTime, isCheckout?: boolean) => void;\r\n\r\nfunction record(options: recordOptions = {}): listenerHandler | undefined {\r\n  const {\r\n    emit,\r\n    checkoutEveryNms,\r\n    checkoutEveryNth,\r\n    blockClass = 'rr-block',\r\n    ignoreClass = 'rr-ignore',\r\n    inlineStylesheet = true,\r\n    maskAllInputs = false,\r\n    hooks,\r\n    mousemoveWait = 50,\r\n  } = options;\r\n  // runtime checks for user options\r\n  if (!emit) {\r\n    throw new Error('emit function is required');\r\n  }\r\n\r\n  polyfill();\r\n\r\n  let lastFullSnapshotEvent: eventWithTime;\r\n  let incrementalSnapshotCount = 0;\r\n  wrappedEmit = (e: eventWithTime, isCheckout?: boolean) => {\r\n    emit(e, isCheckout);\r\n    if (e.type === EventType.FullSnapshot) {\r\n      lastFullSnapshotEvent = e;\r\n      incrementalSnapshotCount = 0;\r\n    } else if (e.type === EventType.IncrementalSnapshot) {\r\n      incrementalSnapshotCount++;\r\n      const exceedCount =\r\n        checkoutEveryNth && incrementalSnapshotCount >= checkoutEveryNth;\r\n      const exceedTime =\r\n        checkoutEveryNms &&\r\n        e.timestamp - lastFullSnapshotEvent.timestamp > checkoutEveryNms;\r\n      if (exceedCount || exceedTime) {\r\n        takeFullSnapshot(true);\r\n      }\r\n    }\r\n  };\r\n\r\n  function takeFullSnapshot(isCheckout = false) {\r\n    wrappedEmit(\r\n      wrapEvent({\r\n        type: EventType.Meta,\r\n        data: {\r\n          href: window.location.href,\r\n          width: getWindowWidth(),\r\n          height: getWindowHeight(),\r\n        },\r\n      }),\r\n      isCheckout,\r\n    );\r\n    const [node, idNodeMap] = snapshot(\r\n      document,\r\n      blockClass,\r\n      inlineStylesheet,\r\n      maskAllInputs,\r\n    );\r\n    if (!node) {\r\n      return console.warn('Failed to snapshot the document');\r\n    }\r\n    mirror.map = idNodeMap;\r\n    wrappedEmit(\r\n      wrapEvent({\r\n        type: EventType.FullSnapshot,\r\n        data: {\r\n          node,\r\n          initialOffset: {\r\n            left: document.documentElement!.scrollLeft,\r\n            top: document.documentElement!.scrollTop,\r\n          },\r\n        },\r\n      }),\r\n    );\r\n  }\r\n\r\n  function patchingCSSStyleSheet(){\r\n    const insertRule = CSSStyleSheet.prototype.insertRule;\r\n    CSSStyleSheet.prototype.insertRule = function (rule: string, index?: number) {\r\n      wrappedEmit(\r\n        wrapEvent({\r\n          type: EventType.IncrementalSnapshot,\r\n          data: {\r\n            source: IncrementalSource.StyleSheetInteraction,\r\n            type: StyleSheetInteractions.InsertRule,\r\n            rule,\r\n            index,\r\n          },\r\n        }),\r\n      );\r\n      return insertRule.apply(this, arguments);\r\n  }\r\n\r\n  }\r\n\r\n  try {\r\n    const handlers: listenerHandler[] = [];\r\n    handlers.push(\r\n      on('DOMContentLoaded', () => {\r\n        wrappedEmit(\r\n          wrapEvent({\r\n            type: EventType.DomContentLoaded,\r\n            data: {},\r\n          }),\r\n        );\r\n      }),\r\n    );\r\n    const init = () => {\r\n      patchingCSSStyleSheet();\r\n      takeFullSnapshot();\r\n\r\n      handlers.push(\r\n        initObservers(\r\n          {\r\n            mutationCb: m =>\r\n              wrappedEmit(\r\n                wrapEvent({\r\n                  type: EventType.IncrementalSnapshot,\r\n                  data: {\r\n                    source: IncrementalSource.Mutation,\r\n                    ...m,\r\n                  },\r\n                }),\r\n              ),\r\n            mousemoveCb: (positions, source) =>\r\n              wrappedEmit(\r\n                wrapEvent({\r\n                  type: EventType.IncrementalSnapshot,\r\n                  data: {\r\n                    source,\r\n                    positions,\r\n                  },\r\n                }),\r\n              ),\r\n            mouseInteractionCb: d =>\r\n              wrappedEmit(\r\n                wrapEvent({\r\n                  type: EventType.IncrementalSnapshot,\r\n                  data: {\r\n                    source: IncrementalSource.MouseInteraction,\r\n                    ...d,\r\n                  },\r\n                }),\r\n              ),\r\n            scrollCb: p =>\r\n              wrappedEmit(\r\n                wrapEvent({\r\n                  type: EventType.IncrementalSnapshot,\r\n                  data: {\r\n                    source: IncrementalSource.Scroll,\r\n                    ...p,\r\n                  },\r\n                }),\r\n              ),\r\n            viewportResizeCb: d =>\r\n              wrappedEmit(\r\n                wrapEvent({\r\n                  type: EventType.IncrementalSnapshot,\r\n                  data: {\r\n                    source: IncrementalSource.ViewportResize,\r\n                    ...d,\r\n                  },\r\n                }),\r\n              ),\r\n            inputCb: v =>\r\n              wrappedEmit(\r\n                wrapEvent({\r\n                  type: EventType.IncrementalSnapshot,\r\n                  data: {\r\n                    source: IncrementalSource.Input,\r\n                    ...v,\r\n                  },\r\n                }),\r\n              ),\r\n            mediaInteractionCb: p =>\r\n              wrappedEmit(\r\n                wrapEvent({\r\n                  type: EventType.IncrementalSnapshot,\r\n                  data: {\r\n                    source: IncrementalSource.MediaInteraction,\r\n                    ...p,\r\n                  },\r\n                }),\r\n              ),\r\n            blockClass,\r\n            ignoreClass,\r\n            maskAllInputs,\r\n            inlineStylesheet,\r\n            mousemoveWait,\r\n          },\r\n          hooks,\r\n        ),\r\n      );\r\n    };\r\n    if (\r\n      document.readyState === 'interactive' ||\r\n      document.readyState === 'complete'\r\n    ) {\r\n      init();\r\n    } else {\r\n      handlers.push(\r\n        on(\r\n          'load',\r\n          () => {\r\n            wrappedEmit(\r\n              wrapEvent({\r\n                type: EventType.Load,\r\n                data: {},\r\n              }),\r\n            );\r\n            init();\r\n          },\r\n          window,\r\n        ),\r\n      );\r\n    }\r\n    return () => {\r\n      handlers.forEach(h => h());\r\n    };\r\n  } catch (error) {\r\n    // TODO: handle internal error\r\n    console.warn(error);\r\n  }\r\n}\r\n\r\nrecord.addCustomEvent = <T>(tag: string, payload: T) => {\r\n  if (!wrappedEmit) {\r\n    throw new Error('please add custom event after start recording');\r\n  }\r\n  wrappedEmit(\r\n    wrapEvent({\r\n      type: EventType.Custom,\r\n      data: {\r\n        tag,\r\n        payload,\r\n      },\r\n    }),\r\n  );\r\n};\r\n\r\nexport default record;\r\n","//      \n// An event handler can take an optional event argument\n// and should not return a value\n                                          \n                                                               \n\n// An array of all currently registered event handlers for a type\n                                            \n                                                            \n// A map of event types and their corresponding event handlers.\n                        \n                                 \n                                   \n  \n\n/** Mitt: Tiny (~200b) functional event emitter / pubsub.\n *  @name mitt\n *  @returns {Mitt}\n */\nfunction mitt(all                 ) {\n\tall = all || Object.create(null);\n\n\treturn {\n\t\t/**\n\t\t * Register an event handler for the given type.\n\t\t *\n\t\t * @param  {String} type\tType of event to listen for, or `\"*\"` for all events\n\t\t * @param  {Function} handler Function to call in response to given event\n\t\t * @memberOf mitt\n\t\t */\n\t\ton: function on(type        , handler              ) {\n\t\t\t(all[type] || (all[type] = [])).push(handler);\n\t\t},\n\n\t\t/**\n\t\t * Remove an event handler for the given type.\n\t\t *\n\t\t * @param  {String} type\tType of event to unregister `handler` from, or `\"*\"`\n\t\t * @param  {Function} handler Handler function to remove\n\t\t * @memberOf mitt\n\t\t */\n\t\toff: function off(type        , handler              ) {\n\t\t\tif (all[type]) {\n\t\t\t\tall[type].splice(all[type].indexOf(handler) >>> 0, 1);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Invoke all handlers for the given type.\n\t\t * If present, `\"*\"` handlers are invoked after type-matched handlers.\n\t\t *\n\t\t * @param {String} type  The event type to invoke\n\t\t * @param {Any} [evt]  Any value (object is recommended and powerful), passed to each handler\n\t\t * @memberOf mitt\n\t\t */\n\t\temit: function emit(type        , evt     ) {\n\t\t\t(all[type] || []).slice().map(function (handler) { handler(evt); });\n\t\t\t(all['*'] || []).slice().map(function (handler) { handler(type, evt); });\n\t\t}\n\t};\n}\n\nexport default mitt;\n//# sourceMappingURL=mitt.es.js.map\n","/* smoothscroll v0.4.4 - 2019 - Dustan Kasten, Jeremias Menichelli - MIT License */\n(function () {\n  'use strict';\n\n  // polyfill\n  function polyfill() {\n    // aliases\n    var w = window;\n    var d = document;\n\n    // return if scroll behavior is supported and polyfill is not forced\n    if (\n      'scrollBehavior' in d.documentElement.style &&\n      w.__forceSmoothScrollPolyfill__ !== true\n    ) {\n      return;\n    }\n\n    // globals\n    var Element = w.HTMLElement || w.Element;\n    var SCROLL_TIME = 468;\n\n    // object gathering original scroll methods\n    var original = {\n      scroll: w.scroll || w.scrollTo,\n      scrollBy: w.scrollBy,\n      elementScroll: Element.prototype.scroll || scrollElement,\n      scrollIntoView: Element.prototype.scrollIntoView\n    };\n\n    // define timing method\n    var now =\n      w.performance && w.performance.now\n        ? w.performance.now.bind(w.performance)\n        : Date.now;\n\n    /**\n     * indicates if a the current browser is made by Microsoft\n     * @method isMicrosoftBrowser\n     * @param {String} userAgent\n     * @returns {Boolean}\n     */\n    function isMicrosoftBrowser(userAgent) {\n      var userAgentPatterns = ['MSIE ', 'Trident/', 'Edge/'];\n\n      return new RegExp(userAgentPatterns.join('|')).test(userAgent);\n    }\n\n    /*\n     * IE has rounding bug rounding down clientHeight and clientWidth and\n     * rounding up scrollHeight and scrollWidth causing false positives\n     * on hasScrollableSpace\n     */\n    var ROUNDING_TOLERANCE = isMicrosoftBrowser(w.navigator.userAgent) ? 1 : 0;\n\n    /**\n     * changes scroll position inside an element\n     * @method scrollElement\n     * @param {Number} x\n     * @param {Number} y\n     * @returns {undefined}\n     */\n    function scrollElement(x, y) {\n      this.scrollLeft = x;\n      this.scrollTop = y;\n    }\n\n    /**\n     * returns result of applying ease math function to a number\n     * @method ease\n     * @param {Number} k\n     * @returns {Number}\n     */\n    function ease(k) {\n      return 0.5 * (1 - Math.cos(Math.PI * k));\n    }\n\n    /**\n     * indicates if a smooth behavior should be applied\n     * @method shouldBailOut\n     * @param {Number|Object} firstArg\n     * @returns {Boolean}\n     */\n    function shouldBailOut(firstArg) {\n      if (\n        firstArg === null ||\n        typeof firstArg !== 'object' ||\n        firstArg.behavior === undefined ||\n        firstArg.behavior === 'auto' ||\n        firstArg.behavior === 'instant'\n      ) {\n        // first argument is not an object/null\n        // or behavior is auto, instant or undefined\n        return true;\n      }\n\n      if (typeof firstArg === 'object' && firstArg.behavior === 'smooth') {\n        // first argument is an object and behavior is smooth\n        return false;\n      }\n\n      // throw error when behavior is not supported\n      throw new TypeError(\n        'behavior member of ScrollOptions ' +\n          firstArg.behavior +\n          ' is not a valid value for enumeration ScrollBehavior.'\n      );\n    }\n\n    /**\n     * indicates if an element has scrollable space in the provided axis\n     * @method hasScrollableSpace\n     * @param {Node} el\n     * @param {String} axis\n     * @returns {Boolean}\n     */\n    function hasScrollableSpace(el, axis) {\n      if (axis === 'Y') {\n        return el.clientHeight + ROUNDING_TOLERANCE < el.scrollHeight;\n      }\n\n      if (axis === 'X') {\n        return el.clientWidth + ROUNDING_TOLERANCE < el.scrollWidth;\n      }\n    }\n\n    /**\n     * indicates if an element has a scrollable overflow property in the axis\n     * @method canOverflow\n     * @param {Node} el\n     * @param {String} axis\n     * @returns {Boolean}\n     */\n    function canOverflow(el, axis) {\n      var overflowValue = w.getComputedStyle(el, null)['overflow' + axis];\n\n      return overflowValue === 'auto' || overflowValue === 'scroll';\n    }\n\n    /**\n     * indicates if an element can be scrolled in either axis\n     * @method isScrollable\n     * @param {Node} el\n     * @param {String} axis\n     * @returns {Boolean}\n     */\n    function isScrollable(el) {\n      var isScrollableY = hasScrollableSpace(el, 'Y') && canOverflow(el, 'Y');\n      var isScrollableX = hasScrollableSpace(el, 'X') && canOverflow(el, 'X');\n\n      return isScrollableY || isScrollableX;\n    }\n\n    /**\n     * finds scrollable parent of an element\n     * @method findScrollableParent\n     * @param {Node} el\n     * @returns {Node} el\n     */\n    function findScrollableParent(el) {\n      while (el !== d.body && isScrollable(el) === false) {\n        el = el.parentNode || el.host;\n      }\n\n      return el;\n    }\n\n    /**\n     * self invoked function that, given a context, steps through scrolling\n     * @method step\n     * @param {Object} context\n     * @returns {undefined}\n     */\n    function step(context) {\n      var time = now();\n      var value;\n      var currentX;\n      var currentY;\n      var elapsed = (time - context.startTime) / SCROLL_TIME;\n\n      // avoid elapsed times higher than one\n      elapsed = elapsed > 1 ? 1 : elapsed;\n\n      // apply easing to elapsed time\n      value = ease(elapsed);\n\n      currentX = context.startX + (context.x - context.startX) * value;\n      currentY = context.startY + (context.y - context.startY) * value;\n\n      context.method.call(context.scrollable, currentX, currentY);\n\n      // scroll more if we have not reached our destination\n      if (currentX !== context.x || currentY !== context.y) {\n        w.requestAnimationFrame(step.bind(w, context));\n      }\n    }\n\n    /**\n     * scrolls window or element with a smooth behavior\n     * @method smoothScroll\n     * @param {Object|Node} el\n     * @param {Number} x\n     * @param {Number} y\n     * @returns {undefined}\n     */\n    function smoothScroll(el, x, y) {\n      var scrollable;\n      var startX;\n      var startY;\n      var method;\n      var startTime = now();\n\n      // define scroll context\n      if (el === d.body) {\n        scrollable = w;\n        startX = w.scrollX || w.pageXOffset;\n        startY = w.scrollY || w.pageYOffset;\n        method = original.scroll;\n      } else {\n        scrollable = el;\n        startX = el.scrollLeft;\n        startY = el.scrollTop;\n        method = scrollElement;\n      }\n\n      // scroll looping over a frame\n      step({\n        scrollable: scrollable,\n        method: method,\n        startTime: startTime,\n        startX: startX,\n        startY: startY,\n        x: x,\n        y: y\n      });\n    }\n\n    // ORIGINAL METHODS OVERRIDES\n    // w.scroll and w.scrollTo\n    w.scroll = w.scrollTo = function() {\n      // avoid action when no arguments are passed\n      if (arguments[0] === undefined) {\n        return;\n      }\n\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0]) === true) {\n        original.scroll.call(\n          w,\n          arguments[0].left !== undefined\n            ? arguments[0].left\n            : typeof arguments[0] !== 'object'\n              ? arguments[0]\n              : w.scrollX || w.pageXOffset,\n          // use top prop, second argument if present or fallback to scrollY\n          arguments[0].top !== undefined\n            ? arguments[0].top\n            : arguments[1] !== undefined\n              ? arguments[1]\n              : w.scrollY || w.pageYOffset\n        );\n\n        return;\n      }\n\n      // LET THE SMOOTHNESS BEGIN!\n      smoothScroll.call(\n        w,\n        d.body,\n        arguments[0].left !== undefined\n          ? ~~arguments[0].left\n          : w.scrollX || w.pageXOffset,\n        arguments[0].top !== undefined\n          ? ~~arguments[0].top\n          : w.scrollY || w.pageYOffset\n      );\n    };\n\n    // w.scrollBy\n    w.scrollBy = function() {\n      // avoid action when no arguments are passed\n      if (arguments[0] === undefined) {\n        return;\n      }\n\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0])) {\n        original.scrollBy.call(\n          w,\n          arguments[0].left !== undefined\n            ? arguments[0].left\n            : typeof arguments[0] !== 'object' ? arguments[0] : 0,\n          arguments[0].top !== undefined\n            ? arguments[0].top\n            : arguments[1] !== undefined ? arguments[1] : 0\n        );\n\n        return;\n      }\n\n      // LET THE SMOOTHNESS BEGIN!\n      smoothScroll.call(\n        w,\n        d.body,\n        ~~arguments[0].left + (w.scrollX || w.pageXOffset),\n        ~~arguments[0].top + (w.scrollY || w.pageYOffset)\n      );\n    };\n\n    // Element.prototype.scroll and Element.prototype.scrollTo\n    Element.prototype.scroll = Element.prototype.scrollTo = function() {\n      // avoid action when no arguments are passed\n      if (arguments[0] === undefined) {\n        return;\n      }\n\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0]) === true) {\n        // if one number is passed, throw error to match Firefox implementation\n        if (typeof arguments[0] === 'number' && arguments[1] === undefined) {\n          throw new SyntaxError('Value could not be converted');\n        }\n\n        original.elementScroll.call(\n          this,\n          // use left prop, first number argument or fallback to scrollLeft\n          arguments[0].left !== undefined\n            ? ~~arguments[0].left\n            : typeof arguments[0] !== 'object' ? ~~arguments[0] : this.scrollLeft,\n          // use top prop, second argument or fallback to scrollTop\n          arguments[0].top !== undefined\n            ? ~~arguments[0].top\n            : arguments[1] !== undefined ? ~~arguments[1] : this.scrollTop\n        );\n\n        return;\n      }\n\n      var left = arguments[0].left;\n      var top = arguments[0].top;\n\n      // LET THE SMOOTHNESS BEGIN!\n      smoothScroll.call(\n        this,\n        this,\n        typeof left === 'undefined' ? this.scrollLeft : ~~left,\n        typeof top === 'undefined' ? this.scrollTop : ~~top\n      );\n    };\n\n    // Element.prototype.scrollBy\n    Element.prototype.scrollBy = function() {\n      // avoid action when no arguments are passed\n      if (arguments[0] === undefined) {\n        return;\n      }\n\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0]) === true) {\n        original.elementScroll.call(\n          this,\n          arguments[0].left !== undefined\n            ? ~~arguments[0].left + this.scrollLeft\n            : ~~arguments[0] + this.scrollLeft,\n          arguments[0].top !== undefined\n            ? ~~arguments[0].top + this.scrollTop\n            : ~~arguments[1] + this.scrollTop\n        );\n\n        return;\n      }\n\n      this.scroll({\n        left: ~~arguments[0].left + this.scrollLeft,\n        top: ~~arguments[0].top + this.scrollTop,\n        behavior: arguments[0].behavior\n      });\n    };\n\n    // Element.prototype.scrollIntoView\n    Element.prototype.scrollIntoView = function() {\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0]) === true) {\n        original.scrollIntoView.call(\n          this,\n          arguments[0] === undefined ? true : arguments[0]\n        );\n\n        return;\n      }\n\n      // LET THE SMOOTHNESS BEGIN!\n      var scrollableParent = findScrollableParent(this);\n      var parentRects = scrollableParent.getBoundingClientRect();\n      var clientRects = this.getBoundingClientRect();\n\n      if (scrollableParent !== d.body) {\n        // reveal element inside parent\n        smoothScroll.call(\n          this,\n          scrollableParent,\n          scrollableParent.scrollLeft + clientRects.left - parentRects.left,\n          scrollableParent.scrollTop + clientRects.top - parentRects.top\n        );\n\n        // reveal parent in viewport unless is fixed\n        if (w.getComputedStyle(scrollableParent).position !== 'fixed') {\n          w.scrollBy({\n            left: parentRects.left,\n            top: parentRects.top,\n            behavior: 'smooth'\n          });\n        }\n      } else {\n        // reveal element in viewport\n        w.scrollBy({\n          left: clientRects.left,\n          top: clientRects.top,\n          behavior: 'smooth'\n        });\n      }\n    };\n  }\n\n  if (typeof exports === 'object' && typeof module !== 'undefined') {\n    // commonjs\n    module.exports = { polyfill: polyfill };\n  } else {\n    // global\n    polyfill();\n  }\n\n}());\n","import { playerConfig, actionWithDelay } from '../types';\n\nexport default class Timer {\n  public timeOffset: number = 0;\n\n  private actions: actionWithDelay[];\n  private config: playerConfig;\n  private raf: number;\n\n  constructor(config: playerConfig, actions: actionWithDelay[] = []) {\n    this.actions = actions;\n    this.config = config;\n  }\n  /**\n   * Add an action after the timer starts.\n   * @param action\n   */\n  public addAction(action: actionWithDelay) {\n    const index = this.findActionIndex(action);\n    this.actions.splice(index, 0, action);\n  }\n  /**\n   * Add all actions before the timer starts\n   * @param actions\n   */\n  public addActions(actions: actionWithDelay[]) {\n    this.actions.push(...actions);\n  }\n\n  public start() {\n    this.actions.sort((a1, a2) => a1.delay - a2.delay);\n    this.timeOffset = 0;\n    let lastTimestamp = performance.now();\n    const { actions, config } = this;\n    const self = this;\n    function check(time: number) {\n      self.timeOffset += (time - lastTimestamp) * config.speed;\n      lastTimestamp = time;\n      while (actions.length) {\n        const action = actions[0];\n        if (self.timeOffset >= action.delay) {\n          actions.shift();\n          action.doAction();\n        } else {\n          break;\n        }\n      }\n      if (actions.length > 0 || self.config.liveMode) {\n        self.raf = requestAnimationFrame(check);\n      }\n    }\n    this.raf = requestAnimationFrame(check);\n  }\n\n  public clear() {\n    if (this.raf) {\n      cancelAnimationFrame(this.raf);\n    }\n    this.actions.length = 0;\n  }\n\n  private findActionIndex(action: actionWithDelay): number {\n    let start = 0;\n    let end = this.actions.length - 1;\n    while (start <= end) {\n      let mid = Math.floor((start + end) / 2);\n      if (this.actions[mid].delay < action.delay) {\n        start = mid + 1;\n      } else if (this.actions[mid].delay > action.delay) {\n        end = mid - 1;\n      } else {\n        return mid;\n      }\n    }\n    return start;\n  }\n}\n","const rules: (blockClass: string) => string[] = (blockClass: string) => [\n  `iframe, .${blockClass} { background: #ccc }`,\n  'noscript { display: none !important; }',\n];\n\nexport default rules;\n","import { rebuild, buildNodeWithSN } from 'rrweb-snapshot';\r\nimport * as mittProxy from 'mitt';\r\nimport * as smoothscroll from 'smoothscroll-polyfill';\r\nimport Timer from './timer';\r\nimport {\r\n  EventType,\r\n  IncrementalSource,\r\n  fullSnapshotEvent,\r\n  eventWithTime,\r\n  MouseInteractions,\r\n  playerConfig,\r\n  playerMetaData,\r\n  viewportResizeDimention,\r\n  missingNodeMap,\r\n  addedNodeMutation,\r\n  missingNode,\r\n  actionWithDelay,\r\n  incrementalSnapshotEvent,\r\n  incrementalData,\r\n  ReplayerEvents,\r\n  Handler,\r\n  Emitter,\r\n  MediaInteractions,\r\n} from '../types';\r\nimport { mirror, polyfill } from '../utils';\r\nimport getInjectStyleRules from './styles/inject-style';\r\nimport './styles/style.css';\r\n\r\nconst SKIP_TIME_THRESHOLD = 10 * 1000;\r\nconst SKIP_TIME_INTERVAL = 5 * 1000;\r\n\r\n// https://github.com/rollup/rollup/issues/1267#issuecomment-296395734\r\n// tslint:disable-next-line\r\nconst mitt = (mittProxy as any).default || mittProxy;\r\n\r\nconst REPLAY_CONSOLE_PREFIX = '[replayer]';\r\n\r\nexport class Replayer {\r\n  public wrapper: HTMLDivElement;\r\n  public iframe: HTMLIFrameElement;\r\n\r\n  public timer: Timer;\r\n\r\n  private events: eventWithTime[] = [];\r\n  private config: playerConfig;\r\n\r\n  private mouse: HTMLDivElement;\r\n\r\n  private emitter: Emitter = mitt();\r\n\r\n  private baselineTime: number = 0;\r\n  // record last played event timestamp when paused\r\n  private lastPlayedEvent: eventWithTime;\r\n\r\n  private nextUserInteractionEvent: eventWithTime | null;\r\n  private noramlSpeed: number = -1;\r\n\r\n  private missingNodeRetryMap: missingNodeMap = {};\r\n\r\n  constructor(events: eventWithTime[], config?: Partial<playerConfig>) {\r\n    if (events.length < 2) {\r\n      throw new Error('Replayer need at least 2 events.');\r\n    }\r\n    this.events = events;\r\n    this.handleResize = this.handleResize.bind(this);\r\n\r\n    const defaultConfig: playerConfig = {\r\n      speed: 1,\r\n      root: document.body,\r\n      loadTimeout: 0,\r\n      skipInactive: false,\r\n      showWarning: true,\r\n      showDebug: false,\r\n      blockClass: 'rr-block',\r\n      liveMode: false,\r\n      insertStyleRules: [],\r\n    };\r\n    this.config = Object.assign({}, defaultConfig, config);\r\n\r\n    this.timer = new Timer(this.config);\r\n    smoothscroll.polyfill();\r\n    polyfill();\r\n    this.setupDom();\r\n    this.emitter.on('resize', this.handleResize as Handler);\r\n  }\r\n\r\n  public on(event: string, handler: Handler) {\r\n    this.emitter.on(event, handler);\r\n  }\r\n\r\n  public setConfig(config: Partial<playerConfig>) {\r\n    Object.keys(config).forEach((key: keyof playerConfig) => {\r\n      this.config[key] = config[key]!;\r\n    });\r\n    if (!this.config.skipInactive) {\r\n      this.noramlSpeed = -1;\r\n    }\r\n  }\r\n\r\n  public getMetaData(): playerMetaData {\r\n    const firstEvent = this.events[0];\r\n    const lastEvent = this.events[this.events.length - 1];\r\n    return {\r\n      totalTime: lastEvent.timestamp - firstEvent.timestamp,\r\n    };\r\n  }\r\n\r\n  public getCurrentTime(): number {\r\n    return this.timer.timeOffset + this.getTimeOffset();\r\n  }\r\n\r\n  public getTimeOffset(): number {\r\n    return this.baselineTime - this.events[0].timestamp;\r\n  }\r\n\r\n  /**\r\n   * This API was designed to be used as play at any time offset.\r\n   * Since we minimized the data collected from recorder, we do not\r\n   * have the ability of undo an event.\r\n   * So the implementation of play at any time offset will always iterate\r\n   * all of the events, cast event before the offset synchronously\r\n   * and cast event after the offset asynchronously with timer.\r\n   * @param timeOffset number\r\n   */\r\n  public play(timeOffset = 0) {\r\n    this.timer.clear();\r\n    this.baselineTime = this.events[0].timestamp + timeOffset;\r\n    const actions = new Array<actionWithDelay>();\r\n    for (const event of this.events) {\r\n      const isSync = event.timestamp < this.baselineTime;\r\n      const castFn = this.getCastFn(event, isSync);\r\n      if (isSync) {\r\n        castFn();\r\n      } else {\r\n        actions.push({\r\n          doAction: () => {\r\n            castFn();\r\n            this.emitter.emit(ReplayerEvents.EventCast, event);\r\n          },\r\n          delay: this.getDelay(event),\r\n        });\r\n      }\r\n    }\r\n    this.timer.addActions(actions);\r\n    this.timer.start();\r\n    this.emitter.emit(ReplayerEvents.Start);\r\n  }\r\n\r\n  public pause() {\r\n    this.timer.clear();\r\n    this.emitter.emit(ReplayerEvents.Pause);\r\n  }\r\n\r\n  public resume(timeOffset = 0) {\r\n    this.timer.clear();\r\n    this.baselineTime = this.events[0].timestamp + timeOffset;\r\n    const actions = new Array<actionWithDelay>();\r\n    for (const event of this.events) {\r\n      if (\r\n        event.timestamp <= this.lastPlayedEvent.timestamp ||\r\n        event === this.lastPlayedEvent\r\n      ) {\r\n        continue;\r\n      }\r\n      const castFn = this.getCastFn(event);\r\n      actions.push({\r\n        doAction: castFn,\r\n        delay: this.getDelay(event),\r\n      });\r\n    }\r\n    this.timer.addActions(actions);\r\n    this.timer.start();\r\n    this.emitter.emit(ReplayerEvents.Resume);\r\n  }\r\n\r\n  public addEvent(event: eventWithTime) {\r\n    const castFn = this.getCastFn(event, true);\r\n    castFn();\r\n  }\r\n\r\n  private setupDom() {\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add('replayer-wrapper');\r\n    this.config.root.appendChild(this.wrapper);\r\n\r\n    this.mouse = document.createElement('div');\r\n    this.mouse.classList.add('replayer-mouse');\r\n    this.wrapper.appendChild(this.mouse);\r\n\r\n    this.iframe = document.createElement('iframe');\r\n    this.iframe.setAttribute('sandbox', 'allow-same-origin');\r\n    this.iframe.setAttribute('scrolling', 'no');\r\n    this.iframe.setAttribute('style', 'pointer-events: none');\r\n    this.wrapper.appendChild(this.iframe);\r\n  }\r\n\r\n  private handleResize(dimension: viewportResizeDimention) {\r\n    this.iframe.width = `${dimension.width}px`;\r\n    this.iframe.height = `${dimension.height}px`;\r\n  }\r\n\r\n  // TODO: add speed to mouse move timestamp calculation\r\n  private getDelay(event: eventWithTime): number {\r\n    // Mouse move events was recorded in a throttle function,\r\n    // so we need to find the real timestamp by traverse the time offsets.\r\n    if (\r\n      event.type === EventType.IncrementalSnapshot &&\r\n      event.data.source === IncrementalSource.MouseMove\r\n    ) {\r\n      const firstOffset = event.data.positions[0].timeOffset;\r\n      // timeOffset is a negative offset to event.timestamp\r\n      const firstTimestamp = event.timestamp + firstOffset;\r\n      event.delay = firstTimestamp - this.baselineTime;\r\n      return firstTimestamp - this.baselineTime;\r\n    }\r\n    event.delay = event.timestamp - this.baselineTime;\r\n    return event.timestamp - this.baselineTime;\r\n  }\r\n\r\n  private getCastFn(event: eventWithTime, isSync = false) {\r\n    let castFn: undefined | (() => void);\r\n    switch (event.type) {\r\n      case EventType.DomContentLoaded:\r\n      case EventType.Load:\r\n        break;\r\n      case EventType.Meta:\r\n        castFn = () =>\r\n          this.emitter.emit(ReplayerEvents.Resize, {\r\n            width: event.data.width,\r\n            height: event.data.height,\r\n          });\r\n        break;\r\n      case EventType.FullSnapshot:\r\n        castFn = () => {\r\n          this.rebuildFullSnapshot(event);\r\n          this.iframe.contentWindow!.scrollTo(event.data.initialOffset);\r\n        };\r\n        break;\r\n      case EventType.IncrementalSnapshot:\r\n        castFn = () => {\r\n          this.applyIncremental(event, isSync);\r\n          if (event === this.nextUserInteractionEvent) {\r\n            this.nextUserInteractionEvent = null;\r\n            this.restoreSpeed();\r\n          }\r\n          if (this.config.skipInactive && !this.nextUserInteractionEvent) {\r\n            for (const _event of this.events) {\r\n              if (_event.timestamp! <= event.timestamp!) {\r\n                continue;\r\n              }\r\n              if (this.isUserInteraction(_event)) {\r\n                if (\r\n                  _event.delay! - event.delay! >\r\n                  SKIP_TIME_THRESHOLD * this.config.speed\r\n                ) {\r\n                  this.nextUserInteractionEvent = _event;\r\n                }\r\n                break;\r\n              }\r\n            }\r\n            if (this.nextUserInteractionEvent) {\r\n              this.noramlSpeed = this.config.speed;\r\n              const skipTime =\r\n                this.nextUserInteractionEvent.delay! - event.delay!;\r\n              const payload = {\r\n                speed: Math.min(Math.round(skipTime / SKIP_TIME_INTERVAL), 360),\r\n              };\r\n              this.setConfig(payload);\r\n              this.emitter.emit(ReplayerEvents.SkipStart, payload);\r\n            }\r\n          }\r\n        };\r\n        break;\r\n      default:\r\n    }\r\n    const wrappedCastFn = () => {\r\n      if (castFn) {\r\n        castFn();\r\n      }\r\n      this.lastPlayedEvent = event;\r\n      if (event === this.events[this.events.length - 1]) {\r\n        this.restoreSpeed();\r\n        this.emitter.emit(ReplayerEvents.Finish);\r\n      }\r\n    };\r\n    return wrappedCastFn;\r\n  }\r\n\r\n  private rebuildFullSnapshot(\r\n    event: fullSnapshotEvent & { timestamp: number },\r\n  ) {\r\n    if (Object.keys(this.missingNodeRetryMap).length) {\r\n      console.warn(\r\n        'Found unresolved missing node map',\r\n        this.missingNodeRetryMap,\r\n      );\r\n    }\r\n    this.missingNodeRetryMap = {};\r\n    mirror.map = rebuild(event.data.node, this.iframe.contentDocument!)[1];\r\n    const styleEl = document.createElement('style');\r\n    const { documentElement, head } = this.iframe.contentDocument!;\r\n    documentElement!.insertBefore(styleEl, head);\r\n    const injectStylesRules = getInjectStyleRules(\r\n      this.config.blockClass,\r\n    ).concat(this.config.insertStyleRules);\r\n    for (let idx = 0; idx < injectStylesRules.length; idx++) {\r\n      (styleEl.sheet! as CSSStyleSheet).insertRule(injectStylesRules[idx], idx);\r\n    }\r\n    this.emitter.emit(ReplayerEvents.FullsnapshotRebuilded);\r\n    this.waitForStylesheetLoad();\r\n  }\r\n\r\n  /**\r\n   * pause when loading style sheet, resume when loaded all timeout exceed\r\n   */\r\n  private waitForStylesheetLoad() {\r\n    const { head } = this.iframe.contentDocument!;\r\n    if (head) {\r\n      const unloadSheets: Set<HTMLLinkElement> = new Set();\r\n      let timer: number;\r\n      head\r\n        .querySelectorAll('link[rel=\"stylesheet\"]')\r\n        .forEach((css: HTMLLinkElement) => {\r\n          if (!css.sheet) {\r\n            if (unloadSheets.size === 0) {\r\n              this.pause();\r\n              this.emitter.emit(ReplayerEvents.LoadStylesheetStart);\r\n              timer = window.setTimeout(() => {\r\n                this.resume(this.getCurrentTime());\r\n                // mark timer was called\r\n                timer = -1;\r\n              }, this.config.loadTimeout);\r\n            }\r\n            unloadSheets.add(css);\r\n            css.addEventListener('load', () => {\r\n              unloadSheets.delete(css);\r\n              if (unloadSheets.size === 0 && timer !== -1) {\r\n                this.resume(this.getCurrentTime());\r\n                this.emitter.emit(ReplayerEvents.LoadStylesheetEnd);\r\n                if (timer) {\r\n                  window.clearTimeout(timer);\r\n                }\r\n              }\r\n            });\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  private applyIncremental(\r\n    e: incrementalSnapshotEvent & { timestamp: number },\r\n    isSync: boolean,\r\n  ) {\r\n    const { data: d } = e;\r\n    switch (d.source) {\r\n      case IncrementalSource.Mutation: {\r\n        d.removes.forEach(mutation => {\r\n          const target = mirror.getNode(mutation.id);\r\n          if (!target) {\r\n            return this.warnNodeNotFound(d, mutation.id);\r\n          }\r\n          const parent = mirror.getNode(mutation.parentId);\r\n          if (!parent) {\r\n            return this.warnNodeNotFound(d, mutation.parentId);\r\n          }\r\n          // target may be removed with its parents before\r\n          mirror.removeNodeFromMap(target);\r\n          if (parent) {\r\n            parent.removeChild(target);\r\n          }\r\n        });\r\n\r\n        const missingNodeMap: missingNodeMap = { ...this.missingNodeRetryMap };\r\n        const queue: addedNodeMutation[] = [];\r\n\r\n        const appendNode = (mutation: addedNodeMutation) => {\r\n          const parent = mirror.getNode(mutation.parentId);\r\n          if (!parent) {\r\n            return queue.push(mutation);\r\n          }\r\n          const target = buildNodeWithSN(\r\n            mutation.node,\r\n            this.iframe.contentDocument!,\r\n            mirror.map,\r\n            true,\r\n          ) as Node;\r\n          let previous: Node | null = null;\r\n          let next: Node | null = null;\r\n          if (mutation.previousId) {\r\n            previous = mirror.getNode(mutation.previousId) as Node;\r\n          }\r\n          if (mutation.nextId) {\r\n            next = mirror.getNode(mutation.nextId) as Node;\r\n          }\r\n\r\n          if (mutation.previousId === -1 || mutation.nextId === -1) {\r\n            missingNodeMap[mutation.node.id] = {\r\n              node: target,\r\n              mutation,\r\n            };\r\n            return;\r\n          }\r\n\r\n          if (\r\n            previous &&\r\n            previous.nextSibling &&\r\n            previous.nextSibling.parentNode\r\n          ) {\r\n            parent.insertBefore(target, previous.nextSibling);\r\n          } else if (next && next.parentNode) {\r\n            parent.insertBefore(target, next);\r\n          } else {\r\n            parent.appendChild(target);\r\n          }\r\n\r\n          if (mutation.previousId || mutation.nextId) {\r\n            this.resolveMissingNode(missingNodeMap, parent, target, mutation);\r\n          }\r\n        };\r\n\r\n        d.adds.forEach(mutation => {\r\n          appendNode(mutation);\r\n        });\r\n\r\n        while (queue.length) {\r\n          if (queue.every(m => !Boolean(mirror.getNode(m.parentId)))) {\r\n            return queue.forEach(m => this.warnNodeNotFound(d, m.node.id));\r\n          }\r\n          const mutation = queue.shift()!;\r\n          appendNode(mutation);\r\n        }\r\n\r\n        if (Object.keys(missingNodeMap).length) {\r\n          Object.assign(this.missingNodeRetryMap, missingNodeMap);\r\n        }\r\n\r\n        d.texts.forEach(mutation => {\r\n          const target = mirror.getNode(mutation.id);\r\n          if (!target) {\r\n            return this.warnNodeNotFound(d, mutation.id);\r\n          }\r\n          target.textContent = mutation.value;\r\n        });\r\n        d.attributes.forEach(mutation => {\r\n          const target = mirror.getNode(mutation.id);\r\n          if (!target) {\r\n            return this.warnNodeNotFound(d, mutation.id);\r\n          }\r\n          for (const attributeName in mutation.attributes) {\r\n            if (typeof attributeName === 'string') {\r\n              const value = mutation.attributes[attributeName];\r\n              if (value !== null) {\r\n                ((target as Node) as Element).setAttribute(\r\n                  attributeName,\r\n                  value,\r\n                );\r\n              } else {\r\n                ((target as Node) as Element).removeAttribute(attributeName);\r\n              }\r\n            }\r\n          }\r\n        });\r\n        break;\r\n      }\r\n      case IncrementalSource.MouseMove:\r\n        if (isSync) {\r\n          const lastPosition = d.positions[d.positions.length - 1];\r\n          this.moveAndHover(d, lastPosition.x, lastPosition.y, lastPosition.id);\r\n        } else {\r\n          d.positions.forEach(p => {\r\n            const action = {\r\n              doAction: () => {\r\n                this.moveAndHover(d, p.x, p.y, p.id);\r\n              },\r\n              delay: p.timeOffset + e.timestamp - this.baselineTime,\r\n            };\r\n            this.timer.addAction(action);\r\n          });\r\n        }\r\n        break;\r\n      case IncrementalSource.MouseInteraction: {\r\n        /**\r\n         * Same as the situation of missing input target.\r\n         */\r\n        if (d.id === -1) {\r\n          break;\r\n        }\r\n        const event = new Event(MouseInteractions[d.type].toLowerCase());\r\n        const target = mirror.getNode(d.id);\r\n        if (!target) {\r\n          return this.debugNodeNotFound(d, d.id);\r\n        }\r\n        this.emitter.emit(ReplayerEvents.MouseInteraction, {\r\n          type: d.type,\r\n          target,\r\n        });\r\n        switch (d.type) {\r\n          case MouseInteractions.Blur:\r\n            if (((target as Node) as HTMLElement).blur) {\r\n              ((target as Node) as HTMLElement).blur();\r\n            }\r\n            break;\r\n          case MouseInteractions.Focus:\r\n            if (((target as Node) as HTMLElement).focus) {\r\n              ((target as Node) as HTMLElement).focus({\r\n                preventScroll: true,\r\n              });\r\n            }\r\n            break;\r\n          case MouseInteractions.Click:\r\n          case MouseInteractions.TouchStart:\r\n          case MouseInteractions.TouchEnd:\r\n            /**\r\n             * Click has no visual impact when replaying and may\r\n             * trigger navigation when apply to an <a> link.\r\n             * So we will not call click(), instead we add an\r\n             * animation to the mouse element which indicate user\r\n             * clicked at this moment.\r\n             */\r\n            if (!isSync) {\r\n              this.moveAndHover(d, d.x, d.y, d.id);\r\n              this.mouse.classList.remove('active');\r\n              // tslint:disable-next-line\r\n              void this.mouse.offsetWidth;\r\n              this.mouse.classList.add('active');\r\n            }\r\n            break;\r\n          default:\r\n            target.dispatchEvent(event);\r\n        }\r\n        break;\r\n      }\r\n      case IncrementalSource.Scroll: {\r\n        /**\r\n         * Same as the situation of missing input target.\r\n         */\r\n        if (d.id === -1) {\r\n          break;\r\n        }\r\n        const target = mirror.getNode(d.id);\r\n        if (!target) {\r\n          return this.debugNodeNotFound(d, d.id);\r\n        }\r\n        if ((target as Node) === this.iframe.contentDocument) {\r\n          this.iframe.contentWindow!.scrollTo({\r\n            top: d.y,\r\n            left: d.x,\r\n            behavior: isSync ? 'auto' : 'smooth',\r\n          });\r\n        } else {\r\n          try {\r\n            ((target as Node) as Element).scrollTop = d.y;\r\n            ((target as Node) as Element).scrollLeft = d.x;\r\n          } catch (error) {\r\n            /**\r\n             * Seldomly we may found scroll target was removed before\r\n             * its last scroll event.\r\n             */\r\n          }\r\n        }\r\n        break;\r\n      }\r\n      case IncrementalSource.ViewportResize:\r\n        this.emitter.emit(ReplayerEvents.Resize, {\r\n          width: d.width,\r\n          height: d.height,\r\n        });\r\n        break;\r\n      case IncrementalSource.Input: {\r\n        /**\r\n         * Input event on an unserialized node usually means the event\r\n         * was synchrony triggered programmatically after the node was\r\n         * created. This means there was not an user observable interaction\r\n         * and we do not need to replay it.\r\n         */\r\n        if (d.id === -1) {\r\n          break;\r\n        }\r\n        const target = mirror.getNode(d.id);\r\n        if (!target) {\r\n          return this.debugNodeNotFound(d, d.id);\r\n        }\r\n        try {\r\n          ((target as Node) as HTMLInputElement).checked = d.isChecked;\r\n          ((target as Node) as HTMLInputElement).value = d.text;\r\n        } catch (error) {\r\n          // for safe\r\n        }\r\n        break;\r\n      }\r\n      case IncrementalSource.MediaInteraction: {\r\n        const target = mirror.getNode(d.id);\r\n        if (!target) {\r\n          return this.debugNodeNotFound(d, d.id);\r\n        }\r\n        const mediaEl = (target as Node) as HTMLMediaElement;\r\n        if (d.type === MediaInteractions.Pause) {\r\n          mediaEl.pause();\r\n        }\r\n        if (d.type === MediaInteractions.Play) {\r\n          if (mediaEl.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA) {\r\n            mediaEl.play();\r\n          } else {\r\n            mediaEl.addEventListener('canplay', () => {\r\n              mediaEl.play();\r\n            });\r\n          }\r\n        }\r\n        break;\r\n      }\r\n      case IncrementalSource.StyleSheetInteraction: {\r\n        const { head } = this.iframe.contentDocument!;\r\n        const stylesEls = head.getElementsByTagName('style');\r\n        const styleSheet = stylesEls[stylesEls.length - 1].sheet as CSSStyleSheet;\r\n        if (styleSheet) {\r\n          styleSheet.insertRule(d.rule, d.index);\r\n        }\r\n        break;\r\n      }\r\n      default:\r\n    }\r\n  }\r\n\r\n  private resolveMissingNode(\r\n    map: missingNodeMap,\r\n    parent: Node,\r\n    target: Node,\r\n    targetMutation: addedNodeMutation,\r\n  ) {\r\n    const { previousId, nextId } = targetMutation;\r\n    const previousInMap = previousId && map[previousId];\r\n    const nextInMap = nextId && map[nextId];\r\n    if (previousInMap) {\r\n      const { node, mutation } = previousInMap as missingNode;\r\n      parent.insertBefore(node, target);\r\n      delete map[mutation.node.id];\r\n      delete this.missingNodeRetryMap[mutation.node.id];\r\n      if (mutation.previousId || mutation.nextId) {\r\n        this.resolveMissingNode(map, parent, node as Node, mutation);\r\n      }\r\n    }\r\n    if (nextInMap) {\r\n      const { node, mutation } = nextInMap as missingNode;\r\n      parent.insertBefore(node, target.nextSibling);\r\n      delete map[mutation.node.id];\r\n      delete this.missingNodeRetryMap[mutation.node.id];\r\n      if (mutation.previousId || mutation.nextId) {\r\n        this.resolveMissingNode(map, parent, node as Node, mutation);\r\n      }\r\n    }\r\n  }\r\n\r\n  private moveAndHover(d: incrementalData, x: number, y: number, id: number) {\r\n    this.mouse.style.left = `${x}px`;\r\n    this.mouse.style.top = `${y}px`;\r\n    const target = mirror.getNode(id);\r\n    if (!target) {\r\n      return this.debugNodeNotFound(d, id);\r\n    }\r\n    this.hoverElements((target as Node) as Element);\r\n  }\r\n\r\n  private hoverElements(el: Element) {\r\n    this.iframe\r\n      .contentDocument!.querySelectorAll('.\\\\:hover')\r\n      .forEach(hoveredEl => {\r\n        hoveredEl.classList.remove(':hover');\r\n      });\r\n    let currentEl: Element | null = el;\r\n    while (currentEl) {\r\n      currentEl.classList.add(':hover');\r\n      currentEl = currentEl.parentElement;\r\n    }\r\n  }\r\n\r\n  private isUserInteraction(event: eventWithTime): boolean {\r\n    if (event.type !== EventType.IncrementalSnapshot) {\r\n      return false;\r\n    }\r\n    return (\r\n      event.data.source > IncrementalSource.Mutation &&\r\n      event.data.source <= IncrementalSource.Input\r\n    );\r\n  }\r\n\r\n  private restoreSpeed() {\r\n    if (this.noramlSpeed === -1) {\r\n      return;\r\n    }\r\n    const payload = { speed: this.noramlSpeed };\r\n    this.setConfig(payload);\r\n    this.emitter.emit(ReplayerEvents.SkipEnd, payload);\r\n    this.noramlSpeed = -1;\r\n  }\r\n\r\n  private warnNodeNotFound(d: incrementalData, id: number) {\r\n    if (!this.config.showWarning) {\r\n      return;\r\n    }\r\n    console.warn(REPLAY_CONSOLE_PREFIX, `Node with id '${id}' not found in`, d);\r\n  }\r\n\r\n  private debugNodeNotFound(d: incrementalData, id: number) {\r\n    /**\r\n     * There maybe some valid scenes of node not being found.\r\n     * Because DOM events are macrotask and MutationObserver callback\r\n     * is microtask, so events fired on a removed DOM may emit\r\n     * snapshots in the reverse order.\r\n     */\r\n    if (!this.config.showDebug) {\r\n      return;\r\n    }\r\n    // tslint:disable-next-line: no-console\r\n    console.log(REPLAY_CONSOLE_PREFIX, `Node with id '${id}' not found in`, d);\r\n  }\r\n}\r\n","import record from './record';\nimport { Replayer } from './replay';\nimport { mirror } from './utils';\n\nexport {\n  EventType,\n  IncrementalSource,\n  MouseInteractions,\n  ReplayerEvents,\n} from './types';\n\nconst { addCustomEvent } = record;\n\nexport { record, addCustomEvent, Replayer, mirror };\n"],"names":["NodeType","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__values","o","m","Symbol","iterator","next","value","done","__read","r","e","ar","push","error","__spread","concat","_id","symbolAndNumberRegex","RegExp","genId","getValidTagName","tagName","processedTagName","toLowerCase","trim","test","getCssRulesString","rules","cssRules","Array","from","reduce","prev","cur","getCssRuleString","rule","isCSSImportRule","styleSheet","cssText","extractOrigin","url","indexOf","split","slice","join","URL_IN_CSS_REF","RELATIVE_PATH","DATA_URI","absoluteToStylesheet","href","replace","origin","path1","path2","path3","filePath","stack","parts","pop","_i","parts_1","part","getAbsoluteSrcsetString","doc","attributeValue","map","srcItem","urlAndSize","trimLeft","trimRight","absoluteToDoc","a","createElement","isSVGElement","el","SVGElement","transformAttribute","name","location","serializeNode","blockClass","inlineStylesheet","maskAllInputs","nodeType","DOCUMENT_NODE","type","Document","childNodes","DOCUMENT_TYPE_NODE","DocumentType","publicId","systemId","ELEMENT_NODE","needBlock_1","classList","contains","forEach","className","attributes_1","_a","attributes","_b","stylesheet","styleSheets","find","rel","_cssText","sheet","innerText","textContent","repeat","checked","selectValue","parentElement","selected","rr_dataURL","toDataURL","rr_mediaState","paused","_c","getBoundingClientRect","width","height","rr_width","rr_height","Element","isSVG","undefined","needBlock","TEXT_NODE","parentTagName","parentNode","isStyle","Text","CDATA_SECTION_NODE","CDATA","COMMENT_NODE","Comment","serializeNodeWithId","skipChild","id","_serializedNode","console","warn","__sn","serializedNode","recordChild","serializedChildNode","snapshot","idNodeMap","commentre","parse","css","options","lineno","column","updatePosition","str","lines","match","lastIndexOf","position","start","line","node","Position","whitespace","end","source","content","errorsList","msg","err","Error","reason","filename","silent","open","close","comments","charAt","atrule","re","exec","c","comment","pos","selector","declaration","propMatch","prop","val","ret","property","declarations","decl","decls","keyframe","vals","values","rulesList","atimport","_compileAtrule","atcharset","atnamespace","vendor","frame","frames","keyframes","atkeyframes","media","style","atmedia","atcustommedia","supports","atsupports","document","atdocument","sel","selectors","atpage","athost","atfontface","addParent","parsingErrors","obj","parent","isNode","childParent","keys","isArray","v","defineProperty","configurable","writable","enumerable","tagMap","script","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","clippath","feblend","fecolormatrix","fecomponenttransfer","fecomposite","feconvolvematrix","fediffuselighting","fedisplacementmap","fedistantlight","fedropshadow","feflood","fefunca","fefuncb","fefuncg","fefuncr","fegaussianblur","feimage","femerge","femergenode","femorphology","feoffset","fepointlight","fespecularlighting","fespotlight","fetile","feturbulence","foreignobject","glyphref","lineargradient","radialgradient","getTagName","HOVER_SELECTOR","addHoverClass","ast","newSelector","buildNode","HACK_CSS","implementation","createDocument","createDocumentType","node_1","createElementNS","_loop_1","startsWith","image_1","src","onload","ctx","getContext","drawImage","play","pause","isTextarea","isRemoteOrDynamicCss","child","createTextNode","removeChild","appendChild","setAttributeNS","setAttribute","createCDATASection","createComment","buildNodeWithSN","childN","childNode","rebuild","on","fn","target","capture","passive","addEventListener","removeEventListener","EventType","IncrementalSource","MouseInteractions","MediaInteractions","StyleSheetInteractions","ReplayerEvents","mirror","getId","getNode","removeNodeFromMap","has","throttle","func","wait","timeout","previous","arg","now","Date","leading","remaining","context","args","window","clearTimeout","trailing","setTimeout","hookSetter","key","d","isRevoked","original","getOwnPropertyDescriptor","set","_this","getWindowHeight","innerHeight","documentElement","clientHeight","body","getWindowWidth","innerWidth","clientWidth","isBlocked","isAncestorRemoved","isTouchEvent","event","Boolean","changedTouches","polyfill","NodeList","deepDelete","addsSet","delete","isParentRemoved","removes","parentId","some","isAncestorInSet","moveKey","isINode","initMutationObserver","cb","observer","MutationObserver","mutations","texts","adds","addedSet","Set","movedSet","droppedSet","movedMap","genAdds","add","targetId","mutation","oldValue","addedNodes","removedNodes","attributeName","getAttribute","item","nodeId","addQueue","pushAdd","previousId","previousSibling","nextId","nextSibling","movedSet_1","addedSet_1","every","shift","payload","text","filter","attribute","observe","attributeOldValue","characterData","characterDataOldValue","childList","subtree","initMoveObserver","mousemoveWait","timeBaseline","positions","wrappedCb","isTouch","totalOffset","timeOffset","TouchMove","MouseMove","evt","clientX","clientY","x","y","handlers","h","initMouseInteractionObserver","Number","isNaN","endsWith","eventKey","eventName","handler","getHandler","initScrollObserver","scrollEl","scrollingElement","scrollLeft","scrollTop","initViewportResizeObserver","wrappedEmit","INPUT_TAGS","MASK_TYPES","lastInputValueMap","WeakMap","initInputObserver","ignoreClass","eventHandler","isChecked","hasTextInput","includes","cbWithDedup","querySelectorAll","lastInputValue","get","propertyDescriptor","HTMLInputElement","hookProperties","HTMLSelectElement","HTMLTextAreaElement","initMediaInteractionObserver","mediaInteractionCb","Play","Pause","mergeHooks","hooks","mutationCb","mousemoveCb","mouseInteractionCb","scrollCb","viewportResizeCb","inputCb","mousemove","mouseInteraction","scroll","viewportResize","input","mediaInteaction","initObservers","mutationObserver","mousemoveHandler","mouseInteractionHandler","scrollHandler","viewportResizeHandler","inputHandler","mediaInteractionHandler","disconnect","wrapEvent","timestamp","record","lastFullSnapshotEvent","emit","checkoutEveryNms","checkoutEveryNth","_d","_e","incrementalSnapshotCount","takeFullSnapshot","isCheckout","Meta","data","FullSnapshot","initialOffset","left","top","IncrementalSnapshot","exceedCount","exceedTime","handlers_1","DomContentLoaded","init_1","insertRule","CSSStyleSheet","index","StyleSheetInteraction","InsertRule","Mutation","MouseInteraction","Scroll","ViewportResize","Input","MediaInteraction","readyState","Load","mitt","all","create","off","splice","addCustomEvent","tag","Custom","module","w","__forceSmoothScrollPolyfill__","userAgent","HTMLElement","SCROLL_TIME","scrollTo","scrollBy","elementScroll","scrollElement","scrollIntoView","performance","bind","ROUNDING_TOLERANCE","navigator","shouldBailOut","smoothScroll","scrollX","pageXOffset","scrollY","pageYOffset","SyntaxError","behavior","scrollableParent","isScrollable","host","findScrollableParent","parentRects","clientRects","getComputedStyle","firstArg","TypeError","hasScrollableSpace","axis","scrollHeight","scrollWidth","canOverflow","overflowValue","isScrollableY","isScrollableX","step","currentX","currentY","k","elapsed","startTime","Math","cos","PI","startX","startY","method","scrollable","requestAnimationFrame","config","actions","Timer","action","findActionIndex","sort","a1","a2","delay","lastTimestamp","self","raf","check","time","speed","doAction","liveMode","cancelAnimationFrame","mid","floor","SKIP_TIME_THRESHOLD","SKIP_TIME_INTERVAL","mittProxy.default","mittProxy","REPLAY_CONSOLE_PREFIX","events","handleResize","defaultConfig","root","loadTimeout","skipInactive","showWarning","showDebug","insertStyleRules","timer","smoothscroll.polyfill","setupDom","emitter","Replayer","noramlSpeed","firstEvent","totalTime","getTimeOffset","baselineTime","clear","isSync","this_1","castFn","getCastFn","EventCast","getDelay","addActions","Start","lastPlayedEvent","Resume","wrapper","mouse","iframe","dimension","firstOffset","firstTimestamp","Resize","rebuildFullSnapshot","contentWindow","applyIncremental","nextUserInteractionEvent","restoreSpeed","_event","isUserInteraction","skipTime","min","round","setConfig","SkipStart","Finish","missingNodeRetryMap","contentDocument","styleEl","head","insertBefore","injectStylesRules","getInjectStyleRules","idx","FullsnapshotRebuilded","waitForStylesheetLoad","timer_1","unloadSheets_1","size","LoadStylesheetStart","resume","getCurrentTime","LoadStylesheetEnd","warnNodeNotFound","missingNodeMap_1","queue_1","appendNode_1","resolveMissingNode","removeAttribute","lastPosition","moveAndHover","addAction","Event","debugNodeNotFound","Blur","blur","Focus","focus","preventScroll","Click","TouchStart","TouchEnd","remove","offsetWidth","dispatchEvent","mediaEl_1","HTMLMediaElement","HAVE_CURRENT_DATA","stylesEls","getElementsByTagName","targetMutation","previousInMap","nextInMap","hoverElements","hoveredEl","currentEl","SkipEnd","log"],"mappings":"AA6BA,IC7BIA,SD6BOC,SAAW,WAQlB,OAPAA,SAAWC,OAAOC,QAAU,SAAkBC,GAC1C,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAII,KADTL,EAAIG,UAAUF,GACOJ,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,KAAIN,EAAEM,GAAKL,EAAEK,IAE9E,OAAON,IAEKU,MAAMC,KAAMP,YAuEzB,SAASQ,SAASC,GACrB,IAAIC,EAAsB,mBAAXC,QAAyBF,EAAEE,OAAOC,UAAWd,EAAI,EAChE,OAAIY,EAAUA,EAAEL,KAAKI,GACd,CACHI,KAAM,WAEF,OADIJ,GAAKX,GAAKW,EAAER,SAAQQ,OAAI,GACrB,CAAEK,MAAOL,GAAKA,EAAEX,KAAMiB,MAAON,KAKzC,SAASO,OAAOP,EAAGV,GACtB,IAAIW,EAAsB,mBAAXC,QAAyBF,EAAEE,OAAOC,UACjD,IAAKF,EAAG,OAAOD,EACf,IAAmBQ,EAAYC,EAA3BpB,EAAIY,EAAEL,KAAKI,GAAOU,EAAK,GAC3B,IACI,WAAc,IAANpB,GAAgBA,KAAM,MAAQkB,EAAInB,EAAEe,QAAQE,MAAMI,EAAGC,KAAKH,EAAEH,OAExE,MAAOO,GAASH,EAAI,CAAEG,MAAOA,WAEzB,IACQJ,IAAMA,EAAEF,OAASL,EAAIZ,EAAU,SAAIY,EAAEL,KAAKP,WAExC,GAAIoB,EAAG,MAAMA,EAAEG,OAE7B,OAAOF,EAGX,SAAgBG,WACZ,IAAK,IAAIH,EAAK,GAAIrB,EAAI,EAAGA,EAAIE,UAAUC,OAAQH,IAC3CqB,EAAKA,EAAGI,OAAOP,OAAOhB,UAAUF,KACpC,OAAOqB,GC1IX,SAAW3B,GACPA,EAASA,EAAmB,SAAI,GAAK,WACrCA,EAASA,EAAuB,aAAI,GAAK,eACzCA,EAASA,EAAkB,QAAI,GAAK,UACpCA,EAASA,EAAe,KAAI,GAAK,OACjCA,EAASA,EAAgB,MAAI,GAAK,QAClCA,EAASA,EAAkB,QAAI,GAAK,UANxC,CAOGA,WAAaA,SAAW,KAE3B,IAAIgC,IAAM,EACNC,qBAAuBC,OAAO,UAClC,SAASC,QACL,OAAOH,MAEX,SAASI,gBAAgBC,GACrB,IAAIC,EAAmBD,EAAQE,cAAcC,OAC7C,OAAIP,qBAAqBQ,KAAKH,GACnB,MAEJA,EAEX,SAASI,kBAAkBrC,GACvB,IACI,IAAIsC,EAAQtC,EAAEsC,OAAStC,EAAEuC,SACzB,OAAOD,EACDE,MAAMC,KAAKH,GAAOI,OAAO,SAAUC,EAAMC,GAAO,OAAOD,EAAOE,iBAAiBD,IAAS,IACxF,KAEV,MAAOpB,GACH,OAAO,MAGf,SAASqB,iBAAiBC,GACtB,OAAOC,gBAAgBD,GACjBT,kBAAkBS,EAAKE,aAAe,GACtCF,EAAKG,QAEf,SAASF,gBAAgBD,GACrB,MAAO,eAAgBA,EAE3B,SAASI,cAAcC,GAYnB,OAVIA,EAAIC,QAAQ,OAAS,EACZD,EACJE,MAAM,KACNC,MAAM,EAAG,GACTC,KAAK,KAGDJ,EAAIE,MAAM,KAAK,IAEZA,MAAM,KAAK,GAG/B,IAAIG,eAAiB,2CACjBC,cAAgB,oDAChBC,SAAW,wDACf,SAASC,qBAAqBV,EAASW,GACnC,OAAOX,EAAQY,QAAQL,eAAgB,SAAUM,EAAQC,EAAOC,EAAOC,GACnE,IAAIC,EAAWH,GAASC,GAASC,EACjC,IAAKC,EACD,OAAOJ,EAEX,IAAKL,cAAcrB,KAAK8B,GACpB,MAAO,QAAUA,EAAW,KAEhC,GAAIR,SAAStB,KAAK8B,GACd,MAAO,OAASA,EAAW,IAE/B,GAAoB,MAAhBA,EAAS,GACT,MAAO,SAAWhB,cAAcU,GAAQM,GAAY,KAExD,IAAIC,EAAQP,EAAKP,MAAM,KACnBe,EAAQF,EAASb,MAAM,KAC3Bc,EAAME,MACN,IAAK,IAAIC,EAAK,EAAGC,EAAUH,EAAOE,EAAKC,EAAQnE,OAAQkE,IAAM,CACzD,IAAIE,EAAOD,EAAQD,GACN,MAATE,IAGc,OAATA,EACLL,EAAME,MAGNF,EAAM5C,KAAKiD,IAGnB,MAAO,QAAUL,EAAMZ,KAAK,KAAO,OAG3C,SAASkB,wBAAwBC,EAAKC,GAClC,MAA8B,KAA1BA,EAAexC,OACRwC,EAEQA,EAAetB,MAAM,KAEnCuB,IAAI,SAAUC,GACf,IACIC,EADiBD,EAAQE,WAAWC,YACR3B,MAAM,KACtC,OAA0B,IAAtByB,EAAW1E,OACE6E,cAAcP,EAAKI,EAAW,IAC3B,IAAMA,EAAW,GAEN,IAAtBA,EAAW1E,OAET,GADM6E,cAAcP,EAAKI,EAAW,IAGxC,KAENvB,KAAK,KAGd,SAAS0B,cAAcP,EAAKC,GACxB,GAA8B,KAA1BA,EAAexC,OACf,OAAOwC,EAEX,IAAIO,EAAIR,EAAIS,cAAc,KAE1B,OADAD,EAAEtB,KAAOe,EACFO,EAAEtB,KAEb,SAASwB,aAAaC,GAClB,MAAsB,QAAfA,EAAGrD,SAAqBqD,aAAcC,WAEjD,SAASC,mBAAmBb,EAAKc,EAAMvE,GACnC,MAAa,QAATuE,GAA4B,SAATA,GAAmBvE,EAC/BgE,cAAcP,EAAKzD,GAEZ,WAATuE,GAAqBvE,EACnBwD,wBAAwBC,EAAKzD,GAEtB,UAATuE,GAAoBvE,EAClB0C,qBAAqB1C,EAAOwE,SAAS7B,MAGrC3C,EAGf,SAASyE,cAAcxF,EAAGwE,EAAKiB,EAAYC,EAAkBC,GACzD,OAAQ3F,EAAE4F,UACN,KAAK5F,EAAE6F,cACH,MAAO,CACHC,KAAMrG,SAASsG,SACfC,WAAY,IAEpB,KAAKhG,EAAEiG,mBACH,MAAO,CACHH,KAAMrG,SAASyG,aACfZ,KAAMtF,EAAEsF,KACRa,SAAUnG,EAAEmG,SACZC,SAAUpG,EAAEoG,UAEpB,KAAKpG,EAAEqG,aACH,IAAIC,GAAc,EACQ,iBAAfb,EACPa,EAActG,EAAEuG,UAAUC,SAASf,GAGnCzF,EAAEuG,UAAUE,QAAQ,SAAUC,GACtBjB,EAAWvD,KAAKwE,KAChBJ,GAAc,KAM1B,IAFA,IAAIxE,EAAUD,gBAAgB7B,EAAE8B,SAC5B6E,EAAe,GACVvC,EAAK,EAAGwC,EAAKtE,MAAMC,KAAKvC,EAAE6G,YAAazC,EAAKwC,EAAG1G,OAAQkE,IAAM,CAClE,IAAI0C,EAAKF,EAAGxC,GAAKkB,EAAOwB,EAAGxB,KAAMvE,EAAQ+F,EAAG/F,MAC5C4F,EAAarB,GAAQD,mBAAmBb,EAAKc,EAAMvE,GAEvD,GAAgB,SAAZe,GAAsB4D,EAAkB,CACxC,IAGI3C,EAHAgE,EAAazE,MAAMC,KAAKiC,EAAIwC,aAAaC,KAAK,SAAUnH,GACxD,OAAOA,EAAE4D,OAAS1D,EAAE0D,QAEpBX,EAAUZ,kBAAkB4E,aAErBJ,EAAaO,WACbP,EAAajD,KACpBiD,EAAaQ,SAAW1D,qBAAqBV,EAASgE,EAAWrD,OAGzE,GAAgB,UAAZ5B,GACA9B,EAAEoH,SACApH,EAAEqH,WACArH,EAAEsH,aACF,IAAIrF,OAAO/B,QACX6C,EAAUZ,kBAAkBnC,EAAEoH,UAE9BT,EAAaQ,SAAW1D,qBAAqBV,EAASwC,SAAS7B,OAGvE,GAAgB,UAAZ5B,GACY,aAAZA,GACY,WAAZA,EAAsB,CAClBf,EAAQf,EAAEe,MACY,UAAtB4F,EAAab,MACS,aAAtBa,EAAab,MACb/E,EACA4F,EAAa5F,MAAQ4E,EAAgB,IAAI4B,OAAOxG,EAAMb,QAAUa,EAE3Df,EAAEwH,UACPb,EAAaa,QAAUxH,EAAEwH,SAGjC,GAAgB,WAAZ1F,EAAsB,CACtB,IAAI2F,EAAczH,EAAE0H,cAChBf,EAAa5F,QAAU0G,EAAY1G,QACnC4F,EAAagB,SAAW3H,EAAE2H,UAWlC,GARgB,WAAZ7F,IACA6E,EAAaiB,WAAa5H,EAAE6H,aAEhB,UAAZ/F,GAAmC,UAAZA,IACvB6E,EAAamB,cAAgB9H,EAAE+H,OACzB,SACA,UAENzB,EAAa,CACb,IAAI0B,EAAKhI,EAAEiI,wBAAyBC,EAAQF,EAAGE,MAAOC,EAASH,EAAGG,OAClExB,EAAayB,SAAWF,EAAQ,KAChCvB,EAAa0B,UAAYF,EAAS,KAEtC,MAAO,CACHrC,KAAMrG,SAAS6I,QACfxG,QAASA,EACT+E,WAAYF,EACZX,WAAY,GACZuC,MAAOrD,aAAalF,SAAMwI,EAC1BC,UAAWnC,GAEnB,KAAKtG,EAAE0I,UACH,IAAIC,EAAgB3I,EAAE4I,YAAc5I,EAAE4I,WAAW9G,QAC7CwF,EAActH,EAAEsH,YAChBuB,EAA4B,UAAlBF,QAAmCH,EAOjD,OANIK,GAAWvB,IACXA,EAAc7D,qBAAqB6D,EAAa/B,SAAS7B,OAEvC,WAAlBiF,IACArB,EAAc,sBAEX,CACHxB,KAAMrG,SAASqJ,KACfxB,YAAaA,GAAe,GAC5BuB,QAASA,GAEjB,KAAK7I,EAAE+I,mBACH,MAAO,CACHjD,KAAMrG,SAASuJ,MACf1B,YAAa,IAErB,KAAKtH,EAAEiJ,aACH,MAAO,CACHnD,KAAMrG,SAASyJ,QACf5B,YAAatH,EAAEsH,aAAe,IAEtC,QACI,OAAO,GAGnB,SAAS6B,oBAAoBnJ,EAAGwE,EAAKE,EAAKe,EAAY2D,EAAW1D,EAAkBC,QAC7D,IAAdyD,IAAwBA,GAAY,QACf,IAArB1D,IAA+BA,GAAmB,QAChC,IAAlBC,IAA4BA,GAAgB,GAChD,IAKI0D,EALAC,EAAkB9D,cAAcxF,EAAGwE,EAAKiB,EAAYC,EAAkBC,GAC1E,IAAK2D,EAED,OADAC,QAAQC,KAAKxJ,EAAG,kBACT,KAIPqJ,EADA,SAAUrJ,EACLA,EAAEyJ,KAAKJ,GAGPzH,QAET,IAAI8H,EAAiB/J,OAAOC,OAAO0J,EAAiB,CAAED,GAAIA,IAC1DrJ,EAAEyJ,KAAOC,EACThF,EAAI2E,GAAMrJ,EACV,IAAI2J,GAAeP,EAKnB,GAJIM,EAAe5D,OAASrG,SAAS6I,UACjCqB,EAAcA,IAAgBD,EAAejB,iBACtCiB,EAAejB,YAErBiB,EAAe5D,OAASrG,SAASsG,UAClC2D,EAAe5D,OAASrG,SAAS6I,UACjCqB,EACA,IAAK,IAAIvF,EAAK,EAAGwC,EAAKtE,MAAMC,KAAKvC,EAAEgG,YAAa5B,EAAKwC,EAAG1G,OAAQkE,IAAM,CAClE,IACIwF,EAAsBT,oBADbvC,EAAGxC,GACsCI,EAAKE,EAAKe,EAAY2D,EAAW1D,EAAkBC,GACrGiE,GACAF,EAAe1D,WAAW3E,KAAKuI,GAI3C,OAAOF,EAEX,SAASG,SAAS7J,EAAGyF,EAAYC,EAAkBC,QAC5B,IAAfF,IAAyBA,EAAa,iBACjB,IAArBC,IAA+BA,GAAmB,QAChC,IAAlBC,IAA4BA,GAAgB,GAChD,IAAImE,EAAY,GAChB,MAAO,CACHX,oBAAoBnJ,EAAGA,EAAG8J,EAAWrE,GAAY,EAAOC,EAAkBC,GAC1EmE,GAIR,IAAIC,UAAY,kCAChB,SAASC,MAAMC,EAAKC,QACA,IAAZA,IAAsBA,EAAU,IACpC,IAAIC,EAAS,EACTC,EAAS,EACb,SAASC,EAAeC,GACpB,IAAIC,EAAQD,EAAIE,MAAM,OAClBD,IACAJ,GAAUI,EAAMrK,QAEpB,IAAIH,EAAIuK,EAAIG,YAAY,MACxBL,GAAgB,IAAPrK,EAAWqK,EAASE,EAAIpK,OAASoK,EAAIpK,OAASH,EAE3D,SAAS2K,IACL,IAAIC,EAAQ,CAAEC,KAAMT,EAAQC,OAAQA,GACpC,OAAO,SAAUS,GAGb,OAFAA,EAAKH,SAAW,IAAII,EAASH,GAC7BI,IACOF,GAGf,IAAIC,EAAY,WAMZ,OALA,SAAkBH,GACdnK,KAAKmK,MAAQA,EACbnK,KAAKwK,IAAM,CAAEJ,KAAMT,EAAQC,OAAQA,GACnC5J,KAAKyK,OAASf,EAAQe,WAI9BH,EAAS1K,UAAU8K,QAAUjB,EAC7B,IAAIkB,EAAa,GACjB,SAAS7J,EAAM8J,GACX,IAAIC,EAAM,IAAIC,MAAMpB,EAAQe,OAAS,IAAMd,EAAS,IAAMC,EAAS,KAAOgB,GAM1E,GALAC,EAAIE,OAASH,EACbC,EAAIG,SAAWtB,EAAQe,OACvBI,EAAIT,KAAOT,EACXkB,EAAIjB,OAASA,EACbiB,EAAIJ,OAAShB,GACTC,EAAQuB,OAIR,MAAMJ,EAHNF,EAAW9J,KAAKgK,GAiBxB,SAASK,IACL,OAAOlB,EAAM,SAEjB,SAASmB,IACL,OAAOnB,EAAM,MAEjB,SAASpI,IACL,IAAIyI,EACAzI,EAAQ,GAGZ,IAFA2I,IACAa,EAASxJ,GACF6H,EAAI/J,QAA4B,MAAlB+J,EAAI4B,OAAO,KAAehB,EAAOiB,KAAYlJ,OACjD,IAATiI,IACAzI,EAAMf,KAAKwJ,GACXe,EAASxJ,IAGjB,OAAOA,EAEX,SAASoI,EAAMuB,GACX,IAAIpL,EAAIoL,EAAGC,KAAK/B,GAChB,GAAKtJ,EAAL,CAGA,IAAI2J,EAAM3J,EAAE,GAGZ,OAFA0J,EAAeC,GACfL,EAAMA,EAAI7G,MAAMkH,EAAIpK,QACbS,GAEX,SAASoK,IACLP,EAAM,QAEV,SAASoB,EAASxJ,GAEd,IAAI6J,EACJ,SAFc,IAAV7J,IAAoBA,EAAQ,IAExB6J,EAAIC,MACE,IAAND,GACA7J,EAAMf,KAAK4K,GAEfA,EAAIC,IAER,OAAO9J,EAEX,SAAS8J,IACL,IAAIC,EAAMzB,IACV,GAAI,MAAQT,EAAI4B,OAAO,IAAM,MAAQ5B,EAAI4B,OAAO,GAAhD,CAIA,IADA,IAAI9L,EAAI,EACD,KAAOkK,EAAI4B,OAAO9L,KACpB,MAAQkK,EAAI4B,OAAO9L,IAAM,MAAQkK,EAAI4B,OAAO9L,EAAI,OAC/CA,EAGN,GADAA,GAAK,EACD,KAAOkK,EAAI4B,OAAO9L,EAAI,GACtB,OAAOuB,EAAM,0BAEjB,IAAIgJ,EAAML,EAAI7G,MAAM,EAAGrD,EAAI,GAK3B,OAJAqK,GAAU,EACVC,EAAeC,GACfL,EAAMA,EAAI7G,MAAMrD,GAChBqK,GAAU,EACH+B,EAAI,CACPrG,KAAM,UACNoG,QAAS5B,KAGjB,SAAS8B,IACL,IAAIzL,EAAI6J,EAAM,YACd,GAAK7J,EAGL,OAAOsB,KAAKtB,EAAE,IACTgD,QAAQ,+CAAgD,IACxDA,QAAQ,mCAAoC,SAAUhD,GACvD,OAAOA,EAAEgD,QAAQ,KAAM,OAEtBR,MAAM,sBACNuB,IAAI,SAAU5E,GACf,OAAOA,EAAE6D,QAAQ,UAAW,OAGpC,SAAS0I,IACL,IAAIF,EAAMzB,IACN4B,EAAY9B,EAAM,4CACtB,GAAK8B,EAAL,CAGA,IAAIC,EAAOtK,KAAKqK,EAAU,IAC1B,IAAK9B,EAAM,SACP,OAAOlJ,EAAM,wBAEjB,IAAIkL,EAAMhC,EAAM,yDACZiC,EAAMN,EAAI,CACVrG,KAAM,cACN4G,SAAUH,EAAK5I,QAAQoG,UAAW,IAClChJ,MAAOyL,EAAMvK,KAAKuK,EAAI,IAAI7I,QAAQoG,UAAW,IAAM,KAGvD,OADAS,EAAM,WACCiC,GAEX,SAASE,IACL,IAKIC,EALAC,EAAQ,GACZ,IAAKnB,IACD,OAAOpK,EAAM,eAIjB,IAFAsK,EAASiB,GAEDD,EAAOP,MACE,IAATO,IACAC,EAAMxL,KAAKuL,GACXhB,EAASiB,IAEbD,EAAOP,IAEX,OAAKV,IAGEkB,EAFIvL,EAAM,eAIrB,SAASwL,IAIL,IAHA,IAAInM,EACAoM,EAAO,GACPZ,EAAMzB,IACF/J,EAAI6J,EAAM,wCACduC,EAAK1L,KAAKV,EAAE,IACZ6J,EAAM,SAEV,GAAKuC,EAAK7M,OAGV,OAAOiM,EAAI,CACPrG,KAAM,WACNkH,OAAQD,EACRJ,aAAcA,MA8KtB,IA9TQM,EA8TJC,EAAWC,EAAe,UAC1BC,EAAYD,EAAe,WAC3BE,EAAcF,EAAe,aACjC,SAASA,EAAe7H,GACpB,IAAIyG,EAAK,IAAIpK,OAAO,KAAO2D,EAAO,gBAClC,OAAO,WACH,IAAI6G,EAAMzB,IACN/J,EAAI6J,EAAMuB,GACd,GAAKpL,EAAL,CAGA,IAAI8L,EAAM,CAAE3G,KAAMR,GAElB,OADAmH,EAAInH,GAAQ3E,EAAE,GAAGsB,OACVkK,EAAIM,KAGnB,SAASX,IACL,GAAe,MAAX7B,EAAI,GAGR,OA/LJ,WACI,IAAIkC,EAAMzB,IACN/J,EAAI6J,EAAM,2BACd,GAAK7J,EAAL,CAGA,IAAI2M,EAAS3M,EAAE,GAEf,KADAA,EAAI6J,EAAM,iBAEN,OAAOlJ,EAAM,2BAEjB,IAIIiM,EAJAjI,EAAO3E,EAAE,GACb,IAAK+K,IACD,OAAOpK,EAAM,0BAIjB,IADA,IAAIkM,EAAS5B,IACL2B,EAAQT,KACZU,EAAOnM,KAAKkM,GACZC,EAASA,EAAOhM,OAAOoK,KAE3B,OAAKD,IAGEQ,EAAI,CACPrG,KAAM,YACNR,KAAMA,EACNgI,OAAQA,EACRG,UAAWD,IANJlM,EAAM,2BAyKToM,IA1HZ,WACI,IAAIvB,EAAMzB,IACN/J,EAAI6J,EAAM,oBACd,GAAK7J,EAAL,CAGA,IAAIgN,EAAQ1L,KAAKtB,EAAE,IACnB,IAAK+K,IACD,OAAOpK,EAAM,sBAEjB,IAAIsM,EAAQhC,IAAWpK,OAAOY,KAC9B,OAAKuJ,IAGEQ,EAAI,CACPrG,KAAM,QACN6H,MAAOA,EACPvL,MAAOwL,IALAtM,EAAM,uBA+GbuM,IAvGR,WACI,IAAI1B,EAAMzB,IACN/J,EAAI6J,EAAM,2CACd,GAAK7J,EAGL,OAAOwL,EAAI,CACPrG,KAAM,eACNR,KAAMrD,KAAKtB,EAAE,IACbgN,MAAO1L,KAAKtB,EAAE,MA+FdmN,IAlKR,WACI,IAAI3B,EAAMzB,IACN/J,EAAI6J,EAAM,uBACd,GAAK7J,EAAL,CAGA,IAAIoN,EAAW9L,KAAKtB,EAAE,IACtB,IAAK+K,IACD,OAAOpK,EAAM,yBAEjB,IAAIsM,EAAQhC,IAAWpK,OAAOY,KAC9B,OAAKuJ,IAGEQ,EAAI,CACPrG,KAAM,WACNiI,SAAUA,EACV3L,MAAOwL,IALAtM,EAAM,0BAuJb0M,IACAd,KACAE,KACAC,KAvER,WACI,IAAIlB,EAAMzB,IACN/J,EAAI6J,EAAM,gCACd,GAAK7J,EAAL,CAGA,IAAI2M,EAASrL,KAAKtB,EAAE,IAChB6D,EAAMvC,KAAKtB,EAAE,IACjB,IAAK+K,IACD,OAAOpK,EAAM,yBAEjB,IAAIsM,EAAQhC,IAAWpK,OAAOY,KAC9B,OAAKuJ,IAGEQ,EAAI,CACPrG,KAAM,WACNmI,SAAUzJ,EACV8I,OAAQA,EACRlL,MAAOwL,IANAtM,EAAM,0BA2Db4M,IAjGR,WACI,IAAI/B,EAAMzB,IAEV,GADQF,EAAM,YACd,CAGA,IAAI2D,EAAM/B,KAAc,GACxB,IAAKV,IACD,OAAOpK,EAAM,qBAIjB,IAFA,IACIsL,EADAC,EAAQjB,IAEJgB,EAAOP,KACXQ,EAAMxL,KAAKuL,GACXC,EAAQA,EAAMrL,OAAOoK,KAEzB,OAAKD,IAGEQ,EAAI,CACPrG,KAAM,OACNsI,UAAWD,EACXxB,aAAcE,IALPvL,EAAM,sBAiFb+M,IApJR,WACI,IAAIlC,EAAMzB,IAEV,GADQF,EAAM,aACd,CAGA,IAAKkB,IACD,OAAOpK,EAAM,qBAEjB,IAAIsM,EAAQhC,IAAWpK,OAAOY,KAC9B,OAAKuJ,IAGEQ,EAAI,CACPrG,KAAM,OACN1D,MAAOwL,IAJAtM,EAAM,sBA0IbgN,IApDR,WACI,IAAInC,EAAMzB,IAEV,GADQF,EAAM,kBACd,CAGA,IAAKkB,IACD,OAAOpK,EAAM,0BAIjB,IAFA,IACIsL,EADAC,EAAQjB,IAEJgB,EAAOP,KACXQ,EAAMxL,KAAKuL,GACXC,EAAQA,EAAMrL,OAAOoK,KAEzB,OAAKD,IAGEQ,EAAI,CACPrG,KAAM,YACN6G,aAAcE,IAJPvL,EAAM,2BAqCbiN,GAER,SAAS3L,IACL,IAAIuJ,EAAMzB,IACNyD,EAAM/B,IACV,OAAK+B,GAGLvC,IACOO,EAAI,CACPrG,KAAM,OACNsI,UAAWD,EACXxB,aAAcA,OANPrL,EAAM,oBASrB,OAAOkN,WA3WCvB,EAAY7K,IACT,CACH0D,KAAM,aACNiB,WAAY,CACRkE,OAAQf,EAAQe,OAChB7I,MAAO6K,EACPwB,cAAetD,MAuW/B,SAASlJ,KAAKqI,GACV,OAAOA,EAAMA,EAAI3G,QAAQ,aAAc,IAAM,GAEjD,SAAS6K,UAAUE,EAAKC,GAGpB,IAFA,IAAIC,EAASF,GAA2B,iBAAbA,EAAI5I,KAC3B+I,EAAcD,EAASF,EAAMC,EACxBvK,EAAK,EAAGwC,EAAKjH,OAAOmP,KAAKJ,GAAMtK,EAAKwC,EAAG1G,OAAQkE,IAAM,CAC1D,IACIrD,EAAQ2N,EADJ9H,EAAGxC,IAEP9B,MAAMyM,QAAQhO,GACdA,EAAM0F,QAAQ,SAAUuI,GACpBR,UAAUQ,EAAGH,KAGZ9N,GAA0B,iBAAVA,GACrByN,UAAUzN,EAAO8N,GAWzB,OARID,GACAjP,OAAOsP,eAAeP,EAAK,SAAU,CACjCQ,cAAc,EACdC,UAAU,EACVC,YAAY,EACZrO,MAAO4N,GAAU,OAGlBD,EAGX,IAAIW,OAAS,CACTC,OAAQ,WACRC,SAAU,WACVC,YAAa,cACbC,aAAc,eACdC,aAAc,eACdC,cAAe,gBACfC,iBAAkB,mBAClBC,SAAU,WACVC,QAAS,UACTC,cAAe,gBACfC,oBAAqB,sBACrBC,YAAa,cACbC,iBAAkB,mBAClBC,kBAAmB,oBACnBC,kBAAmB,oBACnBC,eAAgB,iBAChBC,aAAc,eACdC,QAAS,UACTC,QAAS,UACTC,QAAS,UACTC,QAAS,UACTC,QAAS,UACTC,eAAgB,iBAChBC,QAAS,UACTC,QAAS,UACTC,YAAa,cACbC,aAAc,eACdC,SAAU,WACVC,aAAc,eACdC,mBAAoB,qBACpBC,YAAa,cACbC,OAAQ,SACRC,aAAc,eACdC,cAAe,gBACfC,SAAU,WACVC,eAAgB,iBAChBC,eAAgB,kBAEpB,SAASC,WAAW3R,GAChB,IAAI8B,EAAUuN,OAAOrP,EAAE8B,SAAWuN,OAAOrP,EAAE8B,SAAW9B,EAAE8B,QAIxD,MAHgB,SAAZA,GAAsB9B,EAAE6G,WAAWM,WACnCrF,EAAU,SAEPA,EAEX,IAAI8P,eAAiB,iBACrB,SAASC,cAAc9O,GACnB,IAAI+O,EAAM9H,MAAMjH,EAAS,CAAE0I,QAAQ,IACnC,OAAKqG,EAAI/K,YAGT+K,EAAI/K,WAAW3E,MAAMqE,QAAQ,SAAU7D,GAC/B,cAAeA,IACdA,EAAKwL,WAAa,IAAI3H,QAAQ,SAAU2F,GACrC,GAAIwF,eAAe1P,KAAKkK,GAAW,CAC/B,IAAI2F,EAAc3F,EAASzI,QAAQiO,eAAgB,eACnD7O,EAAUA,EAAQY,QAAQyI,EAAUA,EAAW,KAAO2F,QAK/DhP,GAZIA,EAcf,SAASiP,UAAUhS,EAAGwE,EAAKyN,GACvB,OAAQjS,EAAE8F,MACN,KAAKrG,SAASsG,SACV,OAAOvB,EAAI0N,eAAeC,eAAe,KAAM,GAAI,MACvD,KAAK1S,SAASyG,aACV,OAAO1B,EAAI0N,eAAeE,mBAAmBpS,EAAEsF,KAAMtF,EAAEmG,SAAUnG,EAAEoG,UACvE,KAAK3G,SAAS6I,QACV,IACI+J,EADAvQ,EAAU6P,WAAW3R,GAGrBqS,EADArS,EAAEuI,MACO/D,EAAI8N,gBAAgB,6BAA8BxQ,GAGlD0C,EAAIS,cAAcnD,GAE/B,IAAIyQ,EAAU,SAAUjN,GACpB,IAAKtF,EAAE6G,WAAWxG,eAAeiF,GAC7B,MAAO,WAEX,IAAIvE,EAAQf,EAAE6G,WAAWvB,GAEzB,GADAvE,EAAyB,kBAAVA,EAAsB,GAAKA,EACrCuE,EAAKkN,WAAW,OA+BhB,CACD,GAAgB,WAAZ1Q,GAAiC,eAATwD,EAAuB,CAC/C,IAAImN,EAAUxE,SAAShJ,cAAc,OACrCwN,EAAQC,IAAM3R,EACd0R,EAAQE,OAAS,WACb,IAAIC,EAAMP,EAAOQ,WAAW,MACxBD,GACAA,EAAIE,UAAUL,EAAS,EAAG,EAAGA,EAAQvK,MAAOuK,EAAQtK,SAUhE,GANa,aAAT7C,IACA+M,EAAOzE,MAAM1F,MAAQnH,GAEZ,cAATuE,IACA+M,EAAOzE,MAAMzF,OAASpH,GAEb,kBAATuE,EACA,OAAQvE,GACJ,IAAK,SACDsR,EAAOU,OACX,IAAK,SACDV,EAAOW,aArDM,CACzB,IAAIC,EAAyB,aAAZnR,GAAmC,UAATwD,EACvC4N,EAAmC,UAAZpR,GAAgC,aAATwD,EAIlD,GAHI4N,GAAwBjB,IACxBlR,EAAQ8Q,cAAc9Q,IAEtBkS,GAAcC,EAAsB,CAEpC,IADA,IAAIC,EAAQ3O,EAAI4O,eAAerS,GACtBqD,EAAK,EAAGwC,EAAKtE,MAAMC,KAAK8P,EAAOrM,YAAa5B,EAAKwC,EAAG1G,OAAQkE,IAAM,CACvE,IAAI6H,EAAIrF,EAAGxC,GACP6H,EAAErG,WAAayM,EAAO3J,WACtB2J,EAAOgB,YAAYpH,GAI3B,OADAoG,EAAOiB,YAAYH,GACZ,WAEX,GAAgB,WAAZrR,GAAiC,QAATwD,EACxB,MAAO,WAEX,IACQtF,EAAEuI,OAAkB,eAATjD,EACX+M,EAAOkB,eAAe,+BAAgCjO,EAAMvE,GAG5DsR,EAAOmB,aAAalO,EAAMvE,GAGlC,MAAOO,OAgCf,IAAK,IAAIgE,KAAQtF,EAAE6G,WACf0L,EAAQjN,GAEZ,OAAO+M,EACX,KAAK5S,SAASqJ,KACV,OAAOtE,EAAI4O,eAAepT,EAAE6I,SAAWoJ,EAAWJ,cAAc7R,EAAEsH,aAAetH,EAAEsH,aACvF,KAAK7H,SAASuJ,MACV,OAAOxE,EAAIiP,mBAAmBzT,EAAEsH,aACpC,KAAK7H,SAASyJ,QACV,OAAO1E,EAAIkP,cAAc1T,EAAEsH,aAC/B,QACI,OAAO,MAGnB,SAASqM,gBAAgB3T,EAAGwE,EAAKE,EAAK0E,EAAW6I,QAC3B,IAAd7I,IAAwBA,GAAY,QACvB,IAAb6I,IAAuBA,GAAW,GACtC,IAAIpH,EAAOmH,UAAUhS,EAAGwE,EAAKyN,GAC7B,IAAKpH,EACD,OAAO,KASX,GAPI7K,EAAE8F,OAASrG,SAASsG,WACpBvB,EAAImH,QACJnH,EAAIkH,OACJb,EAAOrG,GAEXqG,EAAKpB,KAAOzJ,EACZ0E,EAAI1E,EAAEqJ,IAAMwB,GACP7K,EAAE8F,OAASrG,SAASsG,UAAY/F,EAAE8F,OAASrG,SAAS6I,WACpDc,EACD,IAAK,IAAIhF,EAAK,EAAGwC,EAAK5G,EAAEgG,WAAY5B,EAAKwC,EAAG1G,OAAQkE,IAAM,CACtD,IAAIwP,EAAShN,EAAGxC,GACZyP,EAAYF,gBAAgBC,EAAQpP,EAAKE,GAAK,EAAOuN,GACpD4B,EAIDhJ,EAAKyI,YAAYO,GAHjBtK,QAAQC,KAAK,oBAAqBoK,GAO9C,OAAO/I,EAEX,SAASiJ,QAAQ9T,EAAGwE,EAAKyN,QACJ,IAAbA,IAAuBA,GAAW,GACtC,IAAInI,EAAY,GAChB,MAAO,CAAC6J,gBAAgB3T,EAAGwE,EAAKsF,GAAW,EAAOmI,GAAWnI,YCl6BjDiK,GACdjO,EACAkO,EACAC,gBAAAA,YAEA,IAAM/J,EAAU,CAAEgK,SAAS,EAAMC,SAAS,GAE1C,OADAF,EAAOG,iBAAiBtO,EAAMkO,EAAI9J,GAC3B,WAAM,OAAA+J,EAAOI,oBAAoBvO,EAAMkO,EAAI9J,IAGpD,ICjBYoK,UAoDAC,kBAmKAC,kBA4CMC,kBAUAC,uBAqENC,eDjUCC,OAAiB,CAC5BlQ,IAAK,GACLmQ,eAAM7U,GAEJ,OAAKA,EAAEyJ,KAGAzJ,EAAEyJ,KAAKJ,IAFJ,GAIZyL,iBAAQzL,GACN,OAAOuL,OAAOlQ,IAAI2E,IAAO,MAG3B0L,kBAAA,SAAkB/U,GAChB,IAAMqJ,EAAKrJ,EAAEyJ,MAAQzJ,EAAEyJ,KAAKJ,UACrBuL,OAAOlQ,IAAI2E,GACdrJ,EAAEgG,YACJhG,EAAEgG,WAAWS,QAAQ,SAAA0M,GACnB,OAAAyB,OAAOG,kBAAmB5B,MAIhC6B,aAAI3L,GACF,OAAOuL,OAAOlQ,IAAIrE,eAAegJ,KAKrC,SAAgB4L,SACdC,EACAC,EACAjL,gBAAAA,MAEA,IAAIkL,EAAyB,KACzBC,EAAW,EAEf,OAAO,SAASC,GACd,IAAIC,EAAMC,KAAKD,MACVF,IAAgC,IAApBnL,EAAQuL,UACvBJ,EAAWE,GAEb,IAAIG,EAAYP,GAAQI,EAAMF,GAC1BM,EAAUnV,KACVoV,EAAO3V,UACPyV,GAAa,GAAKA,EAAYP,GAC5BC,IACFS,OAAOC,aAAaV,GACpBA,EAAU,MAEZC,EAAWE,EACXL,EAAK3U,MAAMoV,EAASC,IACVR,IAAgC,IAArBlL,EAAQ6L,WAC7BX,EAAUS,OAAOG,WAAW,WAC1BX,GAA+B,IAApBnL,EAAQuL,QAAoB,EAAID,KAAKD,MAChDH,EAAU,KACVF,EAAK3U,MAAMoV,EAASC,IACnBF,KAKT,SAAgBO,WACdhC,EACAiC,EACAC,EACAC,GAEA,IAAMC,EAAW1W,OAAO2W,yBAAyBrC,EAAQiC,GAkBzD,OAjBAvW,OAAOsP,eACLgF,EACAiC,EACAE,EACID,EACA,CACEI,IAAA,SAAIxV,GAAJ,WAEEiV,WAAW,WACTG,EAAEI,IAAKjW,KAAKkW,EAAMzV,IACjB,GACCsV,GAAYA,EAASE,KACvBF,EAASE,IAAIjW,KAAKE,KAAMO,MAK7B,WAAM,OAAAkV,WAAWhC,EAAQiC,EAAKG,GAAY,IAAI,IAGvD,SAAgBI,kBACd,OACEZ,OAAOa,aACNzI,SAAS0I,iBAAmB1I,SAAS0I,gBAAgBC,cACrD3I,SAAS4I,MAAQ5I,SAAS4I,KAAKD,aAIpC,SAAgBE,iBACd,OACEjB,OAAOkB,YACN9I,SAAS0I,iBAAmB1I,SAAS0I,gBAAgBK,aACrD/I,SAAS4I,MAAQ5I,SAAS4I,KAAKG,qBAIpBC,UAAUpM,EAAmBpF,GAC3C,IAAKoF,EACH,OAAO,EAET,GAAIA,EAAKjF,WAAaiF,EAAKxE,aAAc,CACvC,IAAIC,GAAY,EAUhB,MAT0B,iBAAfb,EACTa,EAAauE,EAAqBtE,UAAUC,SAASf,GAEpDoF,EAAqBtE,UAAUE,QAAQ,SAAAC,GAClCjB,EAAWvD,KAAKwE,KAClBJ,GAAY,KAIXA,GAAa2Q,UAAUpM,EAAKjC,WAAYnD,GAEjD,OAAOwR,UAAUpM,EAAKjC,WAAYnD,YAGpByR,kBAAkBjD,GAChC,IAAM5K,EAAKuL,OAAOC,MAAMZ,GACxB,OAAKW,OAAOI,IAAI3L,MAId4K,EAAOrL,YACPqL,EAAOrL,WAAWhD,WAAaqO,EAAOpO,kBAKnCoO,EAAOrL,YAGLsO,kBAAmBjD,EAAOrL,sBAGnBuO,aACdC,GAEA,OAAOC,QAASD,EAAqBE,gBAGvC,SAAgBC,WACV,aAAc1B,SAAW2B,SAASpX,UAAUqG,UAC9C+Q,SAASpX,UAAUqG,QAAWnE,MAAMlC,UACjCqG,kBE/JSgR,WAAWC,EAAoB1X,GAC7C0X,EAAQC,OAAO3X,GACfA,EAAEgG,WAAWS,QAAQ,SAAAmN,GAAU,OAAA6D,WAAWC,EAAS9D,cAGrCgE,gBACdC,EACA7X,GAEQ,IAAA4I,eACR,IAAKA,EACH,OAAO,EAET,IAAMkP,EAAWlD,OAAOC,MAAOjM,GAC/B,QAAIiP,EAAQE,KAAK,SAAA7W,GAAK,OAAAA,EAAEmI,KAAOyO,KAGxBF,gBAAgBC,EAASjP,YAGlBoP,gBAAgBzB,EAAgBvW,GACtC,IAAA4I,eACR,QAAKA,MAGD2N,EAAIvB,IAAIpM,IAGLoP,gBAAgBzB,EAAK3N,KDrC9B,SAAY0L,GACVA,2CACAA,mBACAA,mCACAA,iDACAA,mBACAA,uBANF,CAAYA,YAAAA,eAoDZ,SAAYC,GACVA,2BACAA,6BACAA,2CACAA,uBACAA,uCACAA,qBACAA,6BACAA,2CACAA,qDATF,CAAYA,oBAAAA,uBAmKZ,SAAYC,GACVA,yBACAA,6BACAA,qBACAA,iCACAA,2BACAA,qBACAA,mBACAA,+BACAA,+CACAA,2BAVF,CAAYA,oBAAAA,uBA4CZ,SAAkBC,GAChBA,mBACAA,qBAFF,CAAkBA,oBAAAA,uBAUlB,SAAkBC,GAChBA,+BADF,CAAkBA,yBAAAA,4BAqElB,SAAYC,GACVA,gBACAA,gBACAA,kBACAA,kBACAA,kBACAA,iDACAA,8CACAA,0CACAA,yBACAA,qBACAA,uCACAA,yBAZF,CAAYA,iBAAAA,oBE9SZ,IAAMsD,QAAU,SAAC5O,EAAYyO,GAAqB,OAAGzO,MAAMyO,GAC3D,SAASI,QAAQlY,GACf,MAAO,SAAUA,EAoBnB,SAASmY,qBACPC,EACA3S,EACAC,EACAC,GAEA,IAAM0S,EAAW,IAAIC,iBAAiB,SAAAC,eAC9BC,EAAsB,GACtB3R,EAAgC,GAClCgR,EAAiC,GAC/BY,EAA4B,GAE5BC,EAAW,IAAIC,IACfC,EAAW,IAAID,IACfE,EAAa,IAAIF,IAEjBG,EAAiC,GAEjCC,EAAU,SAAC/Y,EAAiBiU,GAChC,IAAIgD,UAAUjX,EAAGyF,GAAjB,CAGA,GAAIyS,QAAQlY,GAAI,CACd4Y,EAASI,IAAIhZ,GACb,IAAIiZ,EAA0B,KAC1BhF,GAAUiE,QAAQjE,KACpBgF,EAAWhF,EAAOxK,KAAKJ,IAErB4P,IACFH,EAASb,QAAQjY,EAAEyJ,KAAKJ,GAAI4P,KAAa,QAG3CP,EAASM,IAAIhZ,GACb6Y,EAAWlB,OAAO3X,GAEpBA,EAAEgG,WAAWS,QAAQ,SAAAmN,GAAU,OAAAmF,EAAQnF,OAGzC2E,EAAU9R,QAAQ,SAAAyS,GAEd,IAAApT,SACAmO,WACAkF,aACAC,eACAC,iBACAC,kBAEF,OAAQxT,GACN,IAAK,gBACH,IAAM/E,EAAQkT,EAAO3M,YAChB2P,UAAUhD,EAAQxO,IAAe1E,IAAUoY,GAC9CX,EAAMnX,KAAK,CACTN,QACA8J,KAAMoJ,IAGV,MAEF,IAAK,aACGlT,EAASkT,EAAuBsF,aAAaD,GACnD,GAAIrC,UAAUhD,EAAQxO,IAAe1E,IAAUoY,EAC7C,OAEF,IAAIK,EAAoC3S,EAAWI,KACjD,SAAAjC,GAAK,OAAAA,EAAE6F,OAASoJ,IAEbuF,IACHA,EAAO,CACL3O,KAAMoJ,EACNpN,WAAY,IAEdA,EAAWxF,KAAKmY,IAGlBA,EAAK3S,WAAWyS,GAAkBjU,mBAChC4I,SACAqL,EACAvY,GAEF,MAEF,IAAK,YACHqY,EAAW3S,QAAQ,SAAAzG,GAAK,OAAA+Y,EAAQ/Y,EAAGiU,KACnCoF,EAAa5S,QAAQ,SAAAzG,GACnB,IAAMyZ,EAAS7E,OAAOC,MAAM7U,GACtB8X,EAAWlD,OAAOC,MAAMZ,GAC1BgD,UAAUjX,EAAGyF,KAIbiT,EAAS1D,IAAIhV,IACfyX,WAAWiB,EAAU1Y,GACrB6Y,EAAWG,IAAIhZ,IACN0Y,EAAS1D,IAAIf,KAAuB,IAAZwF,GAQxBvC,kBAAkBjD,KAOlB2E,EAAS5D,IAAIhV,IAAM8Y,EAASb,QAAQwB,EAAQ3B,IACrDL,WAAWmB,EAAU5Y,GAErB6X,EAAQxW,KAAK,CACXyW,WACAzO,GAAIoQ,KAGR7E,OAAOG,kBAAkB/U,SAajC,IAAM0Z,EAAmB,GACnBC,EAAU,SAAC3Z,GACf,IAAM8X,EAAWlD,OAAOC,MAAO7U,EAAE4I,YACjC,IAAkB,IAAdkP,EACF,OAAO4B,EAASrY,KAAKrB,GAEvByY,EAAKpX,KAAK,CACRyW,WACA8B,WAAa5Z,EAAE6Z,gBAEXjF,OAAOC,MAAM7U,EAAE6Z,iBADf7Z,EAAE6Z,gBAENC,OAAS9Z,EAAE+Z,YAEPnF,OAAOC,MAAO7U,EAAE+Z,aADhB/Z,EAAE+Z,YAENlP,KAAM1B,oBACJnJ,EACAiO,SACA2G,OAAOlQ,IACPe,GACA,EACAC,EACAC,UAKN,IAAgB,IAAAqU,EAAAvZ,SAAAmY,iCAAU,CACxBe,EADS3Z,iHAIX,IAAgB,IAAAia,EAAAxZ,SAAAiY,iCAAU,CAArB,IAAM1Y,UACJgY,gBAAgBa,EAAY7Y,IAAO4X,gBAAgBC,EAAS7X,GAEtDgY,gBAAgBY,EAAU5Y,GACnC2Z,EAAQ3Z,GAER6Y,EAAWG,IAAIhZ,GAJf2Z,EAAQ3Z,qGAQZ,KAAO0Z,EAASxZ,SAEZwZ,EAASQ,MACP,SAAAla,GAAK,OAAmD,IAAnD4U,OAAOC,MAAO7U,EAAE4I,eAUzB+Q,EAAQD,EAASS,SAGnB,IAAMC,EAAU,CACd5B,MAAOA,EACJ9T,IAAI,SAAA2V,GAAQ,OACXhR,GAAIuL,OAAOC,MAAMwF,EAAKxP,MACtB9J,MAAOsZ,EAAKtZ,SAGbuZ,OAAO,SAAAD,GAAQ,OAAAzF,OAAOI,IAAIqF,EAAKhR,MAClCxC,WAAYA,EACTnC,IAAI,SAAA6V,GAAa,OAChBlR,GAAIuL,OAAOC,MAAM0F,EAAU1P,MAC3BhE,WAAY0T,EAAU1T,cAGvByT,OAAO,SAAAC,GAAa,OAAA3F,OAAOI,IAAIuF,EAAUlR,MAC5CwO,UACAY,SAIC2B,EAAQ5B,MAAMtY,QACdka,EAAQvT,WAAW3G,QACnBka,EAAQvC,QAAQ3X,QAChBka,EAAQ3B,KAAKvY,SAIhBkY,EAAGgC,KAUL,OARA/B,EAASmC,QAAQvM,SAAU,CACzBpH,YAAY,EACZ4T,mBAAmB,EACnBC,eAAe,EACfC,uBAAuB,EACvBC,WAAW,EACXC,SAAS,IAEJxC,EAGT,SAASyC,iBACP1C,EACA2C,GAEA,IACIC,EADAC,EAA6B,GAE3BC,EAAYjG,SAAS,SAACkG,GAC1B,IAAMC,EAAc5F,KAAKD,MAAQyF,EACjC5C,EACE6C,EAAUvW,IAAI,SAAAvE,GAEZ,OADAA,EAAEkb,YAAcD,EACTjb,IAETgb,EAAU5G,kBAAkB+G,UAAY/G,kBAAkBgH,WAE5DN,EAAY,GACZD,EAAe,MACd,KACG3Q,EAAiB4K,SACrB,SAAAuG,GACU,IAAAvH,WACFrN,wCAAE6U,YAASC,YAGZV,IACHA,EAAexF,KAAKD,OAEtB0F,EAAU5Z,KAAK,CACbsa,EAAGF,EACHG,EAAGF,EACHrS,GAAIuL,OAAOC,MAAMZ,GACjBoH,WAAY7F,KAAKD,MAAQyF,IAE3BE,EAAU/D,aAAaqE,KAEzBT,EACA,CACEhF,UAAU,IAGR8F,EAAW,CACf9H,GAAG,YAAa1J,GAChB0J,GAAG,YAAa1J,IAElB,OAAO,WACLwR,EAASpV,QAAQ,SAAAqV,GAAK,OAAAA,OAI1B,SAASC,6BACP3D,EACA3S,GAEA,IAAMoW,EAA8B,GAyBpC,OAPAlc,OAAOmP,KAAK0F,mBACT8F,OAAO,SAAApE,GAAO,OAAA8F,OAAOC,MAAMD,OAAO9F,MAAUA,EAAIgG,SAAS,eACzDzV,QAAQ,SAAC0V,GACR,IAAMC,EAAYD,EAASna,cACrBqa,EArBS,SAACF,GAClB,OAAO,SAAC/E,GACN,IAAIH,UAAUG,EAAMnD,OAAgBxO,GAApC,CAGA,IAAM4D,EAAKuL,OAAOC,MAAMuC,EAAMnD,QACxBrN,wCAAE6U,YAASC,YAGjBtD,EAAG,CACDtS,KAAM0O,kBAAkB2H,GACxB9S,KACAsS,EAAGF,EACHG,EAAGF,MAQWY,CAAWH,GAC3BN,EAASxa,KAAK0S,GAAGqI,EAAWC,MAEzB,WACLR,EAASpV,QAAQ,SAAAqV,GAAK,OAAAA,OAI1B,SAASS,mBACPnE,EACA3S,GAsBA,OAAOsO,GAAG,SApBakB,SAAkB,SAAAuG,GACvC,GAAKA,EAAIvH,SAAUgD,UAAUuE,EAAIvH,OAAgBxO,GAAjD,CAGA,IAAM4D,EAAKuL,OAAOC,MAAM2G,EAAIvH,QAC5B,GAAIuH,EAAIvH,SAAWhG,SAAU,CAC3B,IAAMuO,EAAYvO,SAASwO,kBAAoBxO,SAAS0I,gBACxDyB,EAAG,CACD/O,KACAsS,EAAGa,EAASE,WACZd,EAAGY,EAASG,iBAGdvE,EAAG,CACD/O,KACAsS,EAAIH,EAAIvH,OAAuByI,WAC/Bd,EAAIJ,EAAIvH,OAAuB0I,cAGlC,MAIL,SAASC,2BACPxE,GAUA,OAAOrE,GAAG,SARckB,SAAS,WAC/B,IAAM9M,EAASsO,kBACTvO,EAAQ4O,iBACdsB,EAAG,CACDlQ,MAAO8T,OAAO9T,GACdC,OAAQ6T,OAAO7T,MAEhB,KACkC0N,QAGvC,IC/XIgH,YD+XEC,WAAa,CAAC,QAAS,WAAY,UACnCC,WAAa,CACjB,QACA,OACA,iBACA,QACA,QACA,SACA,QACA,SACA,MACA,OACA,OACA,MACA,QAEIC,kBAAsD,IAAIC,QAChE,SAASC,kBACP9E,EACA3S,EACA0X,EACAxX,GAEA,SAASyX,EAAahG,GACZ,IAAAnD,WACR,GACGA,GACCA,EAAmBnS,WACrBgb,WAAW5Z,QAAS+Q,EAAmBnS,SAAW,KAClDmV,UAAUhD,EAAgBxO,GAJ5B,CAQA,IAAMK,EAA4BmO,EAA4BnO,KAC9D,GACW,aAATA,IACCmO,EAAuB1N,UAAUC,SAAS2W,GAF7C,CAMA,IAAI9C,EAAQpG,EAA4BlT,MACpCsc,GAAY,EACVC,EACJP,WAAWQ,SAASzX,IAAyC,aAA/BmO,EAAmBnS,QACtC,UAATgE,GAA6B,aAATA,EACtBuX,EAAapJ,EAA4BzM,QAChC8V,GAAgB3X,IACzB0U,EAAO,IAAI9S,OAAO8S,EAAKna,SAEzBsd,EAAYvJ,EAAQ,CAAEoG,OAAMgD,cAG5B,IAAM/X,EAA4B2O,EAA4B3O,KACjD,UAATQ,GAAoBR,GAAQ+X,GAC9BpP,SACGwP,iBAAiB,6BAA6BnY,QAC9CmB,QAAQ,SAAAtB,GACHA,IAAO8O,GACTuJ,EAAYrY,EAAI,CACdkV,KAAOlV,EAAwBpE,MAC/Bsc,WAAYA,QAMxB,SAASG,EAAYvJ,EAAqBjF,GACxC,IAAM0O,EAAiBV,kBAAkBW,IAAI1J,GAC7C,IACGyJ,GACDA,EAAerD,OAASrL,EAAEqL,MAC1BqD,EAAeL,YAAcrO,EAAEqO,UAC/B,CACAL,kBAAkBzG,IAAItC,EAAQjF,GAC9B,IAAM3F,EAAKuL,OAAOC,MAAMZ,GACxBmE,uBACKpJ,IACH3F,SAIN,IAAMwS,EAAkD,CACtD,QACA,UACAnX,IAAI,SAAA0X,GAAa,OAAArI,GAAGqI,EAAWgB,KAC3BQ,EAAqBje,OAAO2W,yBAChCuH,iBAAiBzd,UACjB,SAEI0d,EAA+C,CACnD,CAACD,iBAAiBzd,UAAW,SAC7B,CAACyd,iBAAiBzd,UAAW,WAC7B,CAAC2d,kBAAkB3d,UAAW,SAC9B,CAAC4d,oBAAoB5d,UAAW,UAclC,OAZIwd,GAAsBA,EAAmBrH,KAC3CsF,EAASxa,WAATwa,WACKiC,EAAepZ,IAAI,SAAAvE,GACpB,OAAA8V,WAAwB9V,EAAE,GAAIA,EAAE,GAAI,CAClCoW,IAAA,WAEE6G,EAAa,CAAEnJ,OAAQzT,cAM1B,WACLqb,EAASpV,QAAQ,SAAAqV,GAAK,OAAAA,OAI1B,SAASmC,6BACPC,EACAzY,GAEA,IAAM4W,EAAU,SAACvW,GAA2B,OAAA,SAACsR,GACnC,IAAAnD,WACHA,IAAUgD,UAAUhD,EAAgBxO,IAGzCyY,EAAmB,CACjBpY,KAAe,SAATA,EAAkB2O,kBAAkB0J,KAAO1J,kBAAkB2J,MACnE/U,GAAIuL,OAAOC,MAAMZ,OAGf4H,EAAW,CAAC9H,GAAG,OAAQsI,EAAQ,SAAUtI,GAAG,QAASsI,EAAQ,WACnE,OAAO,WACLR,EAASpV,QAAQ,SAAAqV,GAAK,OAAAA,OAI1B,SAASuC,WAAW3d,EAAkB4d,GAElC,IAAAC,eACAC,gBACAC,uBACAC,aACAC,qBACAC,YACAV,uBAEFxd,EAAE6d,WAAa,eAAC,aAAAna,mBAAAA,IAAAjE,kBACVme,EAAMpF,UACRoF,EAAMpF,eAANoF,WAAkBne,IAEpBoe,wBAAcpe,KAEhBO,EAAE8d,YAAc,eAAC,aAAApa,mBAAAA,IAAAjE,kBACXme,EAAMO,WACRP,EAAMO,gBAANP,WAAmBne,IAErBqe,wBAAere,KAEjBO,EAAE+d,mBAAqB,eAAC,aAAAra,mBAAAA,IAAAjE,kBAClBme,EAAMQ,kBACRR,EAAMQ,uBAANR,WAA0Bne,IAE5Bse,wBAAsBte,KAExBO,EAAEge,SAAW,eAAC,aAAAta,mBAAAA,IAAAjE,kBACRme,EAAMS,QACRT,EAAMS,aAANT,WAAgBne,IAElBue,wBAAYve,KAEdO,EAAEie,iBAAmB,eAAC,aAAAva,mBAAAA,IAAAjE,kBAChBme,EAAMU,gBACRV,EAAMU,qBAANV,WAAwBne,IAE1Bwe,wBAAoBxe,KAEtBO,EAAEke,QAAU,eAAC,aAAAxa,mBAAAA,IAAAjE,kBACPme,EAAMW,OACRX,EAAMW,YAANX,WAAene,IAEjBye,wBAAWze,KAEbO,EAAEwd,mBAAqB,eAAC,aAAA9Z,mBAAAA,IAAAjE,kBAClBme,EAAMY,iBACRZ,EAAMY,sBAANZ,WAAyBne,IAE3B+d,wBAAsB/d,cAIFgf,cACtBze,EACA4d,gBAAAA,MAEAD,WAAW3d,EAAG4d,GACd,IAAMc,EAAmBjH,qBACvBzX,EAAE6d,WACF7d,EAAE+E,WACF/E,EAAEgF,iBACFhF,EAAEiF,eAEE0Z,EAAmBvE,iBAAiBpa,EAAE8d,YAAa9d,EAAEqa,eACrDuE,EAA0BvD,6BAC9Brb,EAAE+d,mBACF/d,EAAE+E,YAEE8Z,EAAgBhD,mBAAmB7b,EAAEge,SAAUhe,EAAE+E,YACjD+Z,EAAwB5C,2BAA2Blc,EAAEie,kBACrDc,EAAevC,kBACnBxc,EAAEke,QACFle,EAAE+E,WACF/E,EAAEyc,YACFzc,EAAEiF,eAEE+Z,EAA0BzB,6BAC9Bvd,EAAEwd,mBACFxd,EAAE+E,YAEJ,OAAO,WACL2Z,EAAiBO,aACjBN,IACAC,IACAC,IACAC,IACAC,IACAC,KCnmBJ,SAASE,UAAUze,GACjB,4BACKA,IACH0e,UAAWrK,KAAKD,QAMpB,SAASuK,OAAO5V,gBAAAA,MAEZ,IAiBE6V,EAjBFC,SACAC,qBACAC,qBACAtZ,eAAAnB,0BACAqB,gBAAAqW,2BACAnV,qBAAAtC,gBACAya,kBAAAxa,gBACA2Y,UACA8B,kBAAArF,kBAGF,IAAKiF,EACH,MAAM,IAAI1U,MAAM,6BAGlBiM,WAGA,IAAI8I,EAA2B,EAmB/B,SAASC,EAAiBC,gBAAAA,MACxB1D,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUkM,KAChBC,KAAM,CACJ/c,KAAMmS,OAAOtQ,SAAS7B,KACtBwE,MAAO4O,iBACP3O,OAAQsO,qBAGZ8J,GAEI,IAAA3Z,qCAACiE,OAAMf,OAMb,IAAKe,EACH,OAAOtB,QAAQC,KAAK,mCAEtBoL,OAAOlQ,IAAMoF,EACb+S,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUoM,aAChBD,KAAM,CACJ5V,OACA8V,cAAe,CACbC,KAAM3S,SAAS0I,gBAAiB+F,WAChCmE,IAAK5S,SAAS0I,gBAAiBgG,eA/CzCE,YAAc,SAAC1b,EAAkBof,GAE/B,GADAP,EAAK7e,EAAGof,GACJpf,EAAE2E,OAASwO,UAAUoM,aACvBX,EAAwB5e,EACxBkf,EAA2B,OACtB,GAAIlf,EAAE2E,OAASwO,UAAUwM,oBAAqB,CACnDT,IACA,IAAMU,EACJb,GAAoBG,GAA4BH,EAC5Cc,EACJf,GACA9e,EAAE0e,UAAYE,EAAsBF,UAAYI,GAC9Cc,GAAeC,IACjBV,GAAiB,KA4DvB,IACE,IAAMW,EAA8B,GACpCA,EAAS5f,KACP0S,GAAG,mBAAoB,WACrB8I,YACE+C,UAAU,CACR9Z,KAAMwO,UAAU4M,iBAChBT,KAAM,SAKd,IAAMU,EAAO,WA/Bf,IACQC,EAAAA,EAAaC,cAAcjhB,UAAUghB,WAC3CC,cAAcjhB,UAAUghB,WAAa,SAAUxe,EAAc0e,GAY3D,OAXAzE,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUwM,oBAChBL,KAAM,CACJxV,OAAQsJ,kBAAkBgN,sBAC1Bzb,KAAM4O,uBAAuB8M,WAC7B5e,OACA0e,YAICF,EAAW7gB,MAAMC,KAAMP,YAmB9BqgB,IAEAW,EAAS5f,KACP8d,cACE,CACEZ,WAAY,SAAA5d,GACV,OAAAkc,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUwM,oBAChBL,eACExV,OAAQsJ,kBAAkBkN,UACvB9gB,OAIX6d,YAAa,SAACvD,EAAWhQ,GACvB,OAAA4R,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUwM,oBAChBL,KAAM,CACJxV,SACAgQ,iBAIRwD,mBAAoB,SAAAtI,GAClB,OAAA0G,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUwM,oBAChBL,eACExV,OAAQsJ,kBAAkBmN,kBACvBvL,OAIXuI,SAAU,SAAAve,GACR,OAAA0c,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUwM,oBAChBL,eACExV,OAAQsJ,kBAAkBoN,QACvBxhB,OAIXwe,iBAAkB,SAAAxI,GAChB,OAAA0G,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUwM,oBAChBL,eACExV,OAAQsJ,kBAAkBqN,gBACvBzL,OAIXyI,QAAS,SAAA5P,GACP,OAAA6N,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUwM,oBAChBL,eACExV,OAAQsJ,kBAAkBsN,OACvB7S,OAIXkP,mBAAoB,SAAA/d,GAClB,OAAA0c,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUwM,oBAChBL,eACExV,OAAQsJ,kBAAkBuN,kBACvB3hB,OAIXsF,aACA0X,cACAxX,gBACAD,mBACAqV,iBAEFuD,KA0BN,MArB0B,gBAAxBrQ,SAAS8T,YACe,aAAxB9T,SAAS8T,WAETZ,IAEAF,EAAS5f,KACP0S,GACE,OACA,WACE8I,YACE+C,UAAU,CACR9Z,KAAMwO,UAAU0N,KAChBvB,KAAM,MAGVU,KAEFtL,SAIC,WACLoL,EAASxa,QAAQ,SAAAqV,GAAK,OAAAA,OAExB,MAAOxa,GAEPiI,QAAQC,KAAKlI,ICrOjB,SAAS2gB,KAAKC,GAGb,OAFAA,EAAMA,GAAOviB,OAAOwiB,OAAO,MAEpB,CAQNpO,GAAI,SAAYjO,EAAcuW,IAC5B6F,EAAIpc,KAAUoc,EAAIpc,GAAQ,KAAKzE,KAAKgb,IAUtC+F,IAAK,SAAatc,EAAcuW,GAC3B6F,EAAIpc,IACPoc,EAAIpc,GAAMuc,OAAOH,EAAIpc,GAAM5C,QAAQmZ,KAAa,EAAG,IAYrD2D,KAAM,SAAcla,EAAc0V,IAChC0G,EAAIpc,IAAS,IAAI1C,QAAQsB,IAAI,SAAU2X,GAAWA,EAAQb,MAC1D0G,EAAI,MAAQ,IAAI9e,QAAQsB,IAAI,SAAU2X,GAAWA,EAAQvW,EAAM0V,ODmMnEsE,OAAOwC,eAAiB,SAAIC,EAAanI,GACvC,IAAKyC,YACH,MAAM,IAAIvR,MAAM,iDAElBuR,YACE+C,UAAU,CACR9Z,KAAMwO,UAAUkO,OAChB/B,KAAM,CACJ8B,MACAnI,gMEpQP,WAyaGqI,UAAiB,CAAElL,SArarB,WAEE,IAAImL,EAAI7M,OACJM,EAAIlI,SAGR,KACE,mBAAoBkI,EAAEQ,gBAAgB/I,QACF,IAApC8U,EAAEC,+BAFJ,CAQA,IAuB4BC,EAvBxBta,EAAUoa,EAAEG,aAAeH,EAAEpa,QAC7Bwa,EAAc,IAGdzM,EAAW,CACb0I,OAAQ2D,EAAE3D,QAAU2D,EAAEK,SACtBC,SAAUN,EAAEM,SACZC,cAAe3a,EAAQlI,UAAU2e,QAAUmE,EAC3CC,eAAgB7a,EAAQlI,UAAU+iB,gBAIhC5N,EACFmN,EAAEU,aAAeV,EAAEU,YAAY7N,IAC3BmN,EAAEU,YAAY7N,IAAI8N,KAAKX,EAAEU,aACzB5N,KAAKD,IAmBP+N,GAXwBV,EAWgBF,EAAEa,UAAUX,UAR/C,IAAIjhB,OAFa,CAAC,QAAS,WAAY,SAEV0B,KAAK,MAAMnB,KAAK0gB,GAQe,EAAI,GA0LzEF,EAAE3D,OAAS2D,EAAEK,SAAW,gBAEDva,IAAjBvI,UAAU,MAKsB,IAAhCujB,EAAcvjB,UAAU,IAoB5BwjB,EAAanjB,KACXoiB,EACAvM,EAAEU,UACoBrO,IAAtBvI,UAAU,GAAG2gB,OACP3gB,UAAU,GAAG2gB,KACf8B,EAAEgB,SAAWhB,EAAEiB,iBACEnb,IAArBvI,UAAU,GAAG4gB,MACP5gB,UAAU,GAAG4gB,IACf6B,EAAEkB,SAAWlB,EAAEmB,aA3BnBxN,EAAS0I,OAAOze,KACdoiB,OACsBla,IAAtBvI,UAAU,GAAG2gB,KACT3gB,UAAU,GAAG2gB,KACW,iBAAjB3gB,UAAU,GACfA,UAAU,GACVyiB,EAAEgB,SAAWhB,EAAEiB,iBAEAnb,IAArBvI,UAAU,GAAG4gB,IACT5gB,UAAU,GAAG4gB,SACIrY,IAAjBvI,UAAU,GACRA,UAAU,GACVyiB,EAAEkB,SAAWlB,EAAEmB,eAoB3BnB,EAAEM,SAAW,gBAEUxa,IAAjBvI,UAAU,KAKVujB,EAAcvjB,UAAU,IAC1BoW,EAAS2M,SAAS1iB,KAChBoiB,OACsBla,IAAtBvI,UAAU,GAAG2gB,KACT3gB,UAAU,GAAG2gB,KACW,iBAAjB3gB,UAAU,GAAkBA,UAAU,GAAK,OACjCuI,IAArBvI,UAAU,GAAG4gB,IACT5gB,UAAU,GAAG4gB,SACIrY,IAAjBvI,UAAU,GAAmBA,UAAU,GAAK,GAOpDwjB,EAAanjB,KACXoiB,EACAvM,EAAEU,OACA5W,UAAU,GAAG2gB,MAAQ8B,EAAEgB,SAAWhB,EAAEiB,eACpC1jB,UAAU,GAAG4gB,KAAO6B,EAAEkB,SAAWlB,EAAEmB,gBAKzCvb,EAAQlI,UAAU2e,OAASzW,EAAQlI,UAAU2iB,SAAW,WAEtD,QAAqBva,IAAjBvI,UAAU,GAKd,IAAoC,IAAhCujB,EAAcvjB,UAAU,IAA5B,CAqBA,IAAI2gB,EAAO3gB,UAAU,GAAG2gB,KACpBC,EAAM5gB,UAAU,GAAG4gB,IAGvB4C,EAAanjB,KACXE,KACAA,UACgB,IAATogB,EAAuBpgB,KAAKkc,aAAekE,OACnC,IAARC,EAAsBrgB,KAAKmc,YAAckE,OA7BlD,CAEE,GAA4B,iBAAjB5gB,UAAU,SAAoCuI,IAAjBvI,UAAU,GAChD,MAAM,IAAI6jB,YAAY,gCAGxBzN,EAAS4M,cAAc3iB,KACrBE,UAEsBgI,IAAtBvI,UAAU,GAAG2gB,OACP3gB,UAAU,GAAG2gB,KACS,iBAAjB3gB,UAAU,KAAoBA,UAAU,GAAKO,KAAKkc,gBAExClU,IAArBvI,UAAU,GAAG4gB,MACP5gB,UAAU,GAAG4gB,SACErY,IAAjBvI,UAAU,KAAqBA,UAAU,GAAKO,KAAKmc,aAmB7DrU,EAAQlI,UAAU4iB,SAAW,gBAENxa,IAAjBvI,UAAU,MAKsB,IAAhCujB,EAAcvjB,UAAU,IAc5BO,KAAKue,OAAO,CACV6B,OAAQ3gB,UAAU,GAAG2gB,KAAOpgB,KAAKkc,WACjCmE,MAAO5gB,UAAU,GAAG4gB,IAAMrgB,KAAKmc,UAC/BoH,SAAU9jB,UAAU,GAAG8jB,WAhBvB1N,EAAS4M,cAAc3iB,KACrBE,UACsBgI,IAAtBvI,UAAU,GAAG2gB,OACP3gB,UAAU,GAAG2gB,KAAOpgB,KAAKkc,aACzBzc,UAAU,GAAKO,KAAKkc,gBACLlU,IAArBvI,UAAU,GAAG4gB,MACP5gB,UAAU,GAAG4gB,IAAMrgB,KAAKmc,YACxB1c,UAAU,GAAKO,KAAKmc,aAchCrU,EAAQlI,UAAU+iB,eAAiB,WAEjC,IAAoC,IAAhCK,EAAcvjB,UAAU,IAA5B,CAUA,IAAI+jB,EAzON,SAA8B7e,GAC5B,KAAOA,IAAOgR,EAAEU,OAA6B,IAArBoN,EAAa9e,IACnCA,EAAKA,EAAGyD,YAAczD,EAAG+e,KAG3B,OAAO/e,EAoOgBgf,CAAqB3jB,MACxC4jB,EAAcJ,EAAiB/b,wBAC/Boc,EAAc7jB,KAAKyH,wBAEnB+b,IAAqB7N,EAAEU,MAEzB4M,EAAanjB,KACXE,KACAwjB,EACAA,EAAiBtH,WAAa2H,EAAYzD,KAAOwD,EAAYxD,KAC7DoD,EAAiBrH,UAAY0H,EAAYxD,IAAMuD,EAAYvD,KAIP,UAAlD6B,EAAE4B,iBAAiBN,GAAkBtZ,UACvCgY,EAAEM,SAAS,CACTpC,KAAMwD,EAAYxD,KAClBC,IAAKuD,EAAYvD,IACjBkD,SAAU,YAKdrB,EAAEM,SAAS,CACTpC,KAAMyD,EAAYzD,KAClBC,IAAKwD,EAAYxD,IACjBkD,SAAU,gBAnCZ1N,EAAS8M,eAAe7iB,KACtBE,UACiBgI,IAAjBvI,UAAU,IAA0BA,UAAU,KAnUpD,SAASijB,EAAcvH,EAAGC,GACxBpb,KAAKkc,WAAaf,EAClBnb,KAAKmc,UAAYf,EAmBnB,SAAS4H,EAAce,GACrB,GACe,OAAbA,GACoB,iBAAbA,QACe/b,IAAtB+b,EAASR,UACa,SAAtBQ,EAASR,UACa,YAAtBQ,EAASR,SAIT,OAAO,EAGT,GAAwB,iBAAbQ,GAA+C,WAAtBA,EAASR,SAE3C,OAAO,EAIT,MAAM,IAAIS,UACR,oCACED,EAASR,SACT,yDAWN,SAASU,EAAmBtf,EAAIuf,GAC9B,MAAa,MAATA,EACKvf,EAAGyR,aAAe0M,EAAqBne,EAAGwf,aAGtC,MAATD,EACKvf,EAAG6R,YAAcsM,EAAqBne,EAAGyf,iBADlD,EAYF,SAASC,EAAY1f,EAAIuf,GACvB,IAAII,EAAgBpC,EAAE4B,iBAAiBnf,EAAI,MAAM,WAAauf,GAE9D,MAAyB,SAAlBI,GAA8C,WAAlBA,EAUrC,SAASb,EAAa9e,GACpB,IAAI4f,EAAgBN,EAAmBtf,EAAI,MAAQ0f,EAAY1f,EAAI,KAC/D6f,EAAgBP,EAAmBtf,EAAI,MAAQ0f,EAAY1f,EAAI,KAEnE,OAAO4f,GAAiBC,EAuB1B,SAASC,EAAKtP,GACZ,IACI5U,EACAmkB,EACAC,EAxGQC,EAyGRC,GAJO9P,IAIWI,EAAQ2P,WAAaxC,EAzG/BsC,EA4GZC,EAAUA,EAAU,EAAI,EAAIA,EAG5BtkB,EA9GO,IAAO,EAAIwkB,KAAKC,IAAID,KAAKE,GAAKL,IAgHrCF,EAAWvP,EAAQ+P,QAAU/P,EAAQgG,EAAIhG,EAAQ+P,QAAU3kB,EAC3DokB,EAAWxP,EAAQgQ,QAAUhQ,EAAQiG,EAAIjG,EAAQgQ,QAAU5kB,EAE3D4U,EAAQiQ,OAAOtlB,KAAKqV,EAAQkQ,WAAYX,EAAUC,GAG9CD,IAAavP,EAAQgG,GAAKwJ,IAAaxP,EAAQiG,GACjD8G,EAAEoD,sBAAsBb,EAAK5B,KAAKX,EAAG/M,IAYzC,SAAS8N,EAAate,EAAIwW,EAAGC,GAC3B,IAAIiK,EACAH,EACAC,EACAC,EACAN,EAAY/P,IAGZpQ,IAAOgR,EAAEU,MACXgP,EAAanD,EACbgD,EAAShD,EAAEgB,SAAWhB,EAAEiB,YACxBgC,EAASjD,EAAEkB,SAAWlB,EAAEmB,YACxB+B,EAASvP,EAAS0I,SAElB8G,EAAa1gB,EACbugB,EAASvgB,EAAGuX,WACZiJ,EAASxgB,EAAGwX,UACZiJ,EAAS1C,GAIX+B,EAAK,CACHY,WAAYA,EACZD,OAAQA,EACRN,UAAWA,EACXI,OAAQA,EACRC,OAAQA,EACRhK,EAAGA,EACHC,EAAGA,OAxOX,2DCQE,WAAYmK,EAAsBC,gBAAAA,MAN3BxlB,gBAAqB,EAO1BA,KAAKwlB,QAAUA,EACfxlB,KAAKulB,OAASA,EAiElB,OA3DSE,sBAAP,SAAiBC,GACf,IAAM5E,EAAQ9gB,KAAK2lB,gBAAgBD,GACnC1lB,KAAKwlB,QAAQ3D,OAAOf,EAAO,EAAG4E,IAMzBD,uBAAP,SAAkBD,UAChBpf,EAAApG,KAAKwlB,SAAQ3kB,sBAAQ2kB,KAGhBC,kBAAP,WACEzlB,KAAKwlB,QAAQI,KAAK,SAACC,EAAIC,GAAO,OAAAD,EAAGE,MAAQD,EAAGC,QAC5C/lB,KAAK6a,WAAa,EAClB,IAAImL,EAAgBpD,YAAY7N,MACxByQ,j//DAASD,cACXU,EAAOjmB,KAiBbA,KAAKkmB,IAAMZ,sBAhBX,SAASa,EAAMC,GAGb,IAFAH,EAAKpL,aAAeuL,EAAOJ,GAAiBT,EAAOc,MACnDL,EAAgBI,EACTZ,EAAQ9lB,QAAQ,CACrB,IAAMgmB,EAASF,EAAQ,GACvB,KAAIS,EAAKpL,YAAc6K,EAAOK,OAI5B,MAHAP,EAAQ7L,QACR+L,EAAOY,YAKPd,EAAQ9lB,OAAS,GAAKumB,EAAKV,OAAOgB,YACpCN,EAAKC,IAAMZ,sBAAsBa,OAMhCV,kBAAP,WACMzlB,KAAKkmB,KACPM,qBAAqBxmB,KAAKkmB,KAE5BlmB,KAAKwlB,QAAQ9lB,OAAS,GAGhB+lB,4BAAR,SAAwBC,GAGtB,IAFA,IAAIvb,EAAQ,EACRK,EAAMxK,KAAKwlB,QAAQ9lB,OAAS,EACzByK,GAASK,GAAK,CACnB,IAAIic,EAAM1B,KAAK2B,OAAOvc,EAAQK,GAAO,GACrC,GAAIxK,KAAKwlB,QAAQiB,GAAKV,MAAQL,EAAOK,MACnC5b,EAAQsc,EAAM,MACT,CAAA,KAAIzmB,KAAKwlB,QAAQiB,GAAKV,MAAQL,EAAOK,OAG1C,OAAOU,EAFPjc,EAAMic,EAAM,GAKhB,OAAOtc,QC1ELvI,MAA0C,SAACqD,GAAuB,MAAA,CACtE,YAAYA,0BACZ,2CC0BI0hB,oBAAsB,IACtBC,mBAAqB,IAIrBnF,OAAQoF,MAA6BC,UAErCC,sBAAwB,iCAwB5B,WAAYC,EAAyBzB,GACnC,GAjBMvlB,YAA0B,GAK1BA,aAAmByhB,SAEnBzhB,kBAAuB,EAKvBA,kBAAuB,EAEvBA,yBAAsC,GAGxCgnB,EAAOtnB,OAAS,EAClB,MAAM,IAAIoL,MAAM,oCAElB9K,KAAKgnB,OAASA,EACdhnB,KAAKinB,aAAejnB,KAAKinB,aAAapE,KAAK7iB,MAE3C,IAAMknB,EAA8B,CAClCb,MAAO,EACPc,KAAM1Z,SAAS4I,KACf+Q,YAAa,EACbC,cAAc,EACdC,aAAa,EACbC,WAAW,EACXtiB,WAAY,WACZshB,UAAU,EACViB,iBAAkB,IAEpBxnB,KAAKulB,OAASpmB,OAAOC,OAAO,GAAI8nB,EAAe3B,GAE/CvlB,KAAKynB,MAAQ,IAAIhC,MAAMzlB,KAAKulB,QAC5BmC,iBACA3Q,WACA/W,KAAK2nB,WACL3nB,KAAK4nB,QAAQrU,GAAG,SAAUvT,KAAKinB,cAwnBnC,OArnBSY,eAAP,SAAUjR,EAAeiF,GACvB7b,KAAK4nB,QAAQrU,GAAGqD,EAAOiF,IAGlBgM,sBAAP,SAAiBtC,GAAjB,WACEpmB,OAAOmP,KAAKiX,GAAQtf,QAAQ,SAACyP,GAC3BM,EAAKuP,OAAO7P,GAAO6P,EAAO7P,KAEvB1V,KAAKulB,OAAO8B,eACfrnB,KAAK8nB,aAAe,IAIjBD,wBAAP,WACE,IAAME,EAAa/nB,KAAKgnB,OAAO,GAE/B,MAAO,CACLgB,UAFgBhoB,KAAKgnB,OAAOhnB,KAAKgnB,OAAOtnB,OAAS,GAE5B2f,UAAY0I,EAAW1I,YAIzCwI,2BAAP,WACE,OAAO7nB,KAAKynB,MAAM5M,WAAa7a,KAAKioB,iBAG/BJ,0BAAP,WACE,OAAO7nB,KAAKkoB,aAAeloB,KAAKgnB,OAAO,GAAG3H,WAYrCwI,iBAAP,SAAYhN,+BAAAA,KACV7a,KAAKynB,MAAMU,QACXnoB,KAAKkoB,aAAeloB,KAAKgnB,OAAO,GAAG3H,UAAYxE,EAC/C,IAAM2K,EAAU,IAAI1jB,iBACT8U,GACT,IAAMwR,EAASxR,EAAMyI,UAAYgJ,EAAKH,aAChCI,EAASD,EAAKE,UAAU3R,EAAOwR,GACjCA,EACFE,IAEA9C,EAAQ3kB,KAAK,CACXylB,SAAU,WACRgC,IACAtS,EAAK4R,QAAQpI,KAAKrL,eAAeqU,UAAW5R,IAE9CmP,MAAOsC,EAAKI,SAAS7R,iBAX3B,IAAoB,IAAAtQ,EAAArG,SAAAD,KAAKgnB,oJAezBhnB,KAAKynB,MAAMiB,WAAWlD,GACtBxlB,KAAKynB,MAAMtd,QACXnK,KAAK4nB,QAAQpI,KAAKrL,eAAewU,QAG5Bd,kBAAP,WACE7nB,KAAKynB,MAAMU,QACXnoB,KAAK4nB,QAAQpI,KAAKrL,eAAeyJ,QAG5BiK,mBAAP,SAAchN,wBAAAA,KACZ7a,KAAKynB,MAAMU,QACXnoB,KAAKkoB,aAAeloB,KAAKgnB,OAAO,GAAG3H,UAAYxE,EAC/C,IAAM2K,EAAU,IAAI1jB,UACpB,IAAoB,IAAAwE,EAAArG,SAAAD,KAAKgnB,sCAAQ,CAA5B,IAAMpQ,UACT,KACEA,EAAMyI,WAAarf,KAAK4oB,gBAAgBvJ,WACxCzI,IAAU5W,KAAK4oB,iBAFjB,CAMA,IAAMN,EAAStoB,KAAKuoB,UAAU3R,GAC9B4O,EAAQ3kB,KAAK,CACXylB,SAAUgC,EACVvC,MAAO/lB,KAAKyoB,SAAS7R,wGAGzB5W,KAAKynB,MAAMiB,WAAWlD,GACtBxlB,KAAKynB,MAAMtd,QACXnK,KAAK4nB,QAAQpI,KAAKrL,eAAe0U,SAG5BhB,qBAAP,SAAgBjR,GACC5W,KAAKuoB,UAAU3R,GAAO,EACrC0R,IAGMT,qBAAR,WACE7nB,KAAK8oB,QAAUrb,SAAShJ,cAAc,OACtCzE,KAAK8oB,QAAQ/iB,UAAUyS,IAAI,oBAC3BxY,KAAKulB,OAAO4B,KAAKrU,YAAY9S,KAAK8oB,SAElC9oB,KAAK+oB,MAAQtb,SAAShJ,cAAc,OACpCzE,KAAK+oB,MAAMhjB,UAAUyS,IAAI,kBACzBxY,KAAK8oB,QAAQhW,YAAY9S,KAAK+oB,OAE9B/oB,KAAKgpB,OAASvb,SAAShJ,cAAc,UACrCzE,KAAKgpB,OAAOhW,aAAa,UAAW,qBACpChT,KAAKgpB,OAAOhW,aAAa,YAAa,MACtChT,KAAKgpB,OAAOhW,aAAa,QAAS,wBAClChT,KAAK8oB,QAAQhW,YAAY9S,KAAKgpB,SAGxBnB,yBAAR,SAAqBoB,GACnBjpB,KAAKgpB,OAAOthB,MAAWuhB,EAAUvhB,WACjC1H,KAAKgpB,OAAOrhB,OAAYshB,EAAUthB,aAI5BkgB,qBAAR,SAAiBjR,GAGf,GACEA,EAAMtR,OAASwO,UAAUwM,qBACzB1J,EAAMqJ,KAAKxV,SAAWsJ,kBAAkBgH,UACxC,CACA,IAAMmO,EAActS,EAAMqJ,KAAKxF,UAAU,GAAGI,WAEtCsO,EAAiBvS,EAAMyI,UAAY6J,EAEzC,OADAtS,EAAMmP,MAAQoD,EAAiBnpB,KAAKkoB,aAC7BiB,EAAiBnpB,KAAKkoB,aAG/B,OADAtR,EAAMmP,MAAQnP,EAAMyI,UAAYrf,KAAKkoB,aAC9BtR,EAAMyI,UAAYrf,KAAKkoB,cAGxBL,sBAAR,SAAkBjR,EAAsBwR,GAAxC,IACME,SACJ,oBAFsCF,MAE9BxR,EAAMtR,MACZ,KAAKwO,UAAU4M,iBACf,KAAK5M,UAAU0N,KACb,MACF,KAAK1N,UAAUkM,KACbsI,EAAS,WACP,OAAAtS,EAAK4R,QAAQpI,KAAKrL,eAAeiV,OAAQ,CACvC1hB,MAAOkP,EAAMqJ,KAAKvY,MAClBC,OAAQiP,EAAMqJ,KAAKtY,UAEvB,MACF,KAAKmM,UAAUoM,aACboI,EAAS,WACPtS,EAAKqT,oBAAoBzS,GACzBZ,EAAKgT,OAAOM,cAAe/G,SAAS3L,EAAMqJ,KAAKE,gBAEjD,MACF,KAAKrM,UAAUwM,oBACbgI,EAAS,mBAMP,GALAtS,EAAKuT,iBAAiB3S,EAAOwR,GACzBxR,IAAUZ,EAAKwT,2BACjBxT,EAAKwT,yBAA2B,KAChCxT,EAAKyT,gBAEHzT,EAAKuP,OAAO8B,eAAiBrR,EAAKwT,yBAA0B,KAC9D,IAAqB,IAAAljB,EAAArG,SAAA+V,EAAKgR,sCAAQ,CAA7B,IAAM0C,UACT,KAAIA,EAAOrK,WAAczI,EAAMyI,YAG3BrJ,EAAK2T,kBAAkBD,GAAS,CAEhCA,EAAO3D,MAASnP,EAAMmP,MACtBY,oBAAsB3Q,EAAKuP,OAAOc,QAElCrQ,EAAKwT,yBAA2BE,GAElC,yGAGJ,GAAI1T,EAAKwT,yBAA0B,CACjCxT,EAAK8R,YAAc9R,EAAKuP,OAAOc,MAC/B,IAAMuD,EACJ5T,EAAKwT,yBAAyBzD,MAASnP,EAAMmP,MACzCnM,EAAU,CACdyM,MAAOtB,KAAK8E,IAAI9E,KAAK+E,MAAMF,EAAWhD,oBAAqB,MAE7D5Q,EAAK+T,UAAUnQ,GACf5D,EAAK4R,QAAQpI,KAAKrL,eAAe6V,UAAWpQ,MAiBtD,OAVsB,WAChB0O,GACFA,IAEFtS,EAAK4S,gBAAkBhS,EACnBA,IAAUZ,EAAKgR,OAAOhR,EAAKgR,OAAOtnB,OAAS,KAC7CsW,EAAKyT,eACLzT,EAAK4R,QAAQpI,KAAKrL,eAAe8V,WAM/BpC,gCAAR,SACEjR,GAEIzX,OAAOmP,KAAKtO,KAAKkqB,qBAAqBxqB,QACxCqJ,QAAQC,KACN,oCACAhJ,KAAKkqB,qBAGTlqB,KAAKkqB,oBAAsB,GAC3B9V,OAAOlQ,IAAMoP,QAAQsD,EAAMqJ,KAAK5V,KAAMrK,KAAKgpB,OAAOmB,iBAAkB,GACpE,IAAMC,EAAU3c,SAAShJ,cAAc,SACjC2B,8BAAE+P,oBAAiBkU,SACzBlU,EAAiBmU,aAAaF,EAASC,GAIvC,IAHA,IAAME,EAAoBC,MACxBxqB,KAAKulB,OAAOtgB,YACZjE,OAAOhB,KAAKulB,OAAOiC,kBACZiD,EAAM,EAAGA,EAAMF,EAAkB7qB,OAAQ+qB,IAC/CL,EAAQxjB,MAAyBga,WAAW2J,EAAkBE,GAAMA,GAEvEzqB,KAAK4nB,QAAQpI,KAAKrL,eAAeuW,uBACjC1qB,KAAK2qB,yBAMC9C,kCAAR,WAAA,WACUwC,mCACR,GAAIA,EAAM,CACR,IACIO,EADEC,EAAqC,IAAI1S,IAE/CkS,EACGpN,iBAAiB,0BACjBhX,QAAQ,SAACwD,GACHA,EAAI7C,QACmB,IAAtBikB,EAAaC,OACf9U,EAAKxD,QACLwD,EAAK4R,QAAQpI,KAAKrL,eAAe4W,qBACjCH,EAAQvV,OAAOG,WAAW,WACxBQ,EAAKgV,OAAOhV,EAAKiV,kBAEjBL,GAAS,GACR5U,EAAKuP,OAAO6B,cAEjByD,EAAarS,IAAI/O,GACjBA,EAAImK,iBAAiB,OAAQ,WAC3BiX,EAAa1T,OAAO1N,GACM,IAAtBohB,EAAaC,OAAyB,IAAXF,IAC7B5U,EAAKgV,OAAOhV,EAAKiV,kBACjBjV,EAAK4R,QAAQpI,KAAKrL,eAAe+W,mBAC7BN,GACFvV,OAAOC,aAAasV,WAS5B/C,6BAAR,SACElnB,EACAynB,GAFF,WAIUzS,SACR,OAAQA,EAAElL,QACR,KAAKsJ,kBAAkBkN,SACrBtL,EAAE0B,QAAQpR,QAAQ,SAAAyS,GAChB,IAAMjF,EAASW,OAAOE,QAAQoE,EAAS7P,IACvC,IAAK4K,EACH,OAAOuC,EAAKmV,iBAAiBxV,EAAG+C,EAAS7P,IAE3C,IAAMsF,EAASiG,OAAOE,QAAQoE,EAASpB,UACvC,IAAKnJ,EACH,OAAO6H,EAAKmV,iBAAiBxV,EAAG+C,EAASpB,UAG3ClD,OAAOG,kBAAkBd,GACrBtF,GACFA,EAAO0E,YAAYY,KAIvB,IAAM2X,cAAsCprB,KAAKkqB,qBAC3CmB,EAA6B,GAE7BC,EAAa,SAAC5S,GAClB,IAAMvK,EAASiG,OAAOE,QAAQoE,EAASpB,UACvC,IAAKnJ,EACH,OAAOkd,EAAMxqB,KAAK6X,GAEpB,IAAMjF,EAASN,gBACbuF,EAASrO,KACT2L,EAAKgT,OAAOmB,gBACZ/V,OAAOlQ,KACP,GAEE2Q,EAAwB,KACxBvU,EAAoB,KACpBoY,EAASU,aACXvE,EAAWT,OAAOE,QAAQoE,EAASU,aAEjCV,EAASY,SACXhZ,EAAO8T,OAAOE,QAAQoE,EAASY,UAGJ,IAAzBZ,EAASU,aAA0C,IAArBV,EAASY,QASzCzE,GACAA,EAAS0E,aACT1E,EAAS0E,YAAYnR,WAErB+F,EAAOmc,aAAa7W,EAAQoB,EAAS0E,aAC5BjZ,GAAQA,EAAK8H,WACtB+F,EAAOmc,aAAa7W,EAAQnT,GAE5B6N,EAAO2E,YAAYW,IAGjBiF,EAASU,YAAcV,EAASY,SAClCtD,EAAKuV,mBAAmBH,EAAgBjd,EAAQsF,EAAQiF,IApBxD0S,EAAe1S,EAASrO,KAAKxB,IAAM,CACjCwB,KAAMoJ,EACNiF,aA0BN,IAJA/C,EAAEsC,KAAKhS,QAAQ,SAAAyS,GACb4S,EAAW5S,KAGN2S,EAAM3rB,QAAQ,CACnB,GAAI2rB,EAAM3R,MAAM,SAAAvZ,GAAK,OAAC0W,QAAQzC,OAAOE,QAAQnU,EAAEmX,aAC7C,OAAO+T,EAAMplB,QAAQ,SAAA9F,GAAK,OAAA6V,EAAKmV,iBAAiBxV,EAAGxV,EAAEkK,KAAKxB,MAE5D,IAAM6P,EAAW2S,EAAM1R,QACvB2R,EAAW5S,GAGTvZ,OAAOmP,KAAK8c,GAAgB1rB,QAC9BP,OAAOC,OAAOY,KAAKkqB,oBAAqBkB,GAG1CzV,EAAEqC,MAAM/R,QAAQ,SAAAyS,GACd,IAAMjF,EAASW,OAAOE,QAAQoE,EAAS7P,IACvC,IAAK4K,EACH,OAAOuC,EAAKmV,iBAAiBxV,EAAG+C,EAAS7P,IAE3C4K,EAAO3M,YAAc4R,EAASnY,QAEhCoV,EAAEtP,WAAWJ,QAAQ,SAAAyS,GACnB,IAAMjF,EAASW,OAAOE,QAAQoE,EAAS7P,IACvC,IAAK4K,EACH,OAAOuC,EAAKmV,iBAAiBxV,EAAG+C,EAAS7P,IAE3C,IAAK,IAAMiQ,KAAiBJ,EAASrS,WACnC,GAA6B,iBAAlByS,EAA4B,CACrC,IAAMvY,EAAQmY,EAASrS,WAAWyS,GACpB,OAAVvY,EACAkT,EAA4BT,aAC5B8F,EACAvY,GAGAkT,EAA4B+X,gBAAgB1S,MAKtD,MAEF,KAAK/E,kBAAkBgH,UACrB,GAAIqN,EAAQ,CACV,IAAMqD,EAAe9V,EAAE8E,UAAU9E,EAAE8E,UAAU/a,OAAS,GACtDM,KAAK0rB,aAAa/V,EAAG8V,EAAatQ,EAAGsQ,EAAarQ,EAAGqQ,EAAa5iB,SAElE8M,EAAE8E,UAAUxU,QAAQ,SAAAtG,GAClB,IAAM+lB,EAAS,CACbY,SAAU,WACRtQ,EAAK0V,aAAa/V,EAAGhW,EAAEwb,EAAGxb,EAAEyb,EAAGzb,EAAEkJ,KAEnCkd,MAAOpmB,EAAEkb,WAAala,EAAE0e,UAAYrJ,EAAKkS,cAE3ClS,EAAKyR,MAAMkE,UAAUjG,KAGzB,MACF,KAAK3R,kBAAkBmN,iBAIrB,IAAc,IAAVvL,EAAE9M,GACJ,MAEF,IAAM+N,EAAQ,IAAIgV,MAAM5X,kBAAkB2B,EAAErQ,MAAM9D,eAElD,KADMiS,EAASW,OAAOE,QAAQqB,EAAE9M,KAE9B,OAAO7I,KAAK6rB,kBAAkBlW,EAAGA,EAAE9M,IAMrC,OAJA7I,KAAK4nB,QAAQpI,KAAKrL,eAAe+M,iBAAkB,CACjD5b,KAAMqQ,EAAErQ,KACRmO,WAEMkC,EAAErQ,MACR,KAAK0O,kBAAkB8X,KACfrY,EAAgCsY,MAClCtY,EAAgCsY,OAEpC,MACF,KAAK/X,kBAAkBgY,MACfvY,EAAgCwY,OAClCxY,EAAgCwY,MAAM,CACtCC,eAAe,IAGnB,MACF,KAAKlY,kBAAkBmY,MACvB,KAAKnY,kBAAkBoY,WACvB,KAAKpY,kBAAkBqY,SAQhBjE,IACHpoB,KAAK0rB,aAAa/V,EAAGA,EAAEwF,EAAGxF,EAAEyF,EAAGzF,EAAE9M,IACjC7I,KAAK+oB,MAAMhjB,UAAUumB,OAAO,UAEvBtsB,KAAK+oB,MAAMwD,YAChBvsB,KAAK+oB,MAAMhjB,UAAUyS,IAAI,WAE3B,MACF,QACE/E,EAAO+Y,cAAc5V,GAEzB,MAEF,KAAK7C,kBAAkBoN,OAIrB,IAAc,IAAVxL,EAAE9M,GACJ,MAGF,KADM4K,EAASW,OAAOE,QAAQqB,EAAE9M,KAE9B,OAAO7I,KAAK6rB,kBAAkBlW,EAAGA,EAAE9M,IAErC,GAAK4K,IAAoBzT,KAAKgpB,OAAOmB,gBACnCnqB,KAAKgpB,OAAOM,cAAe/G,SAAS,CAClClC,IAAK1K,EAAEyF,EACPgF,KAAMzK,EAAEwF,EACRoI,SAAU6E,EAAS,OAAS,gBAG9B,IACI3U,EAA4B0I,UAAYxG,EAAEyF,EAC1C3H,EAA4ByI,WAAavG,EAAEwF,EAC7C,MAAOra,IAOX,MAEF,KAAKiT,kBAAkBqN,eACrBphB,KAAK4nB,QAAQpI,KAAKrL,eAAeiV,OAAQ,CACvC1hB,MAAOiO,EAAEjO,MACTC,OAAQgO,EAAEhO,SAEZ,MACF,KAAKoM,kBAAkBsN,MAOrB,IAAc,IAAV1L,EAAE9M,GACJ,MAGF,KADM4K,EAASW,OAAOE,QAAQqB,EAAE9M,KAE9B,OAAO7I,KAAK6rB,kBAAkBlW,EAAGA,EAAE9M,IAErC,IACI4K,EAAqCzM,QAAU2O,EAAEkH,UACjDpJ,EAAqClT,MAAQoV,EAAEkE,KACjD,MAAO/Y,IAGT,MAEF,KAAKiT,kBAAkBuN,iBACrB,IAAM7N,EACN,KADMA,EAASW,OAAOE,QAAQqB,EAAE9M,KAE9B,OAAO7I,KAAK6rB,kBAAkBlW,EAAGA,EAAE9M,IAErC,IAAM4jB,EAAWhZ,EACbkC,EAAErQ,OAAS2O,kBAAkB2J,OAC/B6O,EAAQja,QAENmD,EAAErQ,OAAS2O,kBAAkB0J,OAC3B8O,EAAQlL,YAAcmL,iBAAiBC,kBACzCF,EAAQla,OAERka,EAAQ7Y,iBAAiB,UAAW,WAClC6Y,EAAQla,UAId,MAEF,KAAKwB,kBAAkBgN,sBACb,IACF6L,mCAAiBC,qBAAqB,SACtCvqB,EAAasqB,EAAUA,EAAUltB,OAAS,GAAGkH,MAC/CtE,GACFA,EAAWse,WAAWjL,EAAEvT,KAAMuT,EAAEmL,SAQhC+G,+BAAR,SACE3jB,EACAiK,EACAsF,EACAqZ,GAEQ,IAAA1T,eAAYE,WACdyT,EAAgB3T,GAAclV,EAAIkV,GAClC4T,EAAY1T,GAAUpV,EAAIoV,GAChC,GAAIyT,EAAe,CACX,IAAA3mB,IAAEiE,SAAMqO,aACdvK,EAAOmc,aAAajgB,EAAMoJ,UACnBvP,EAAIwU,EAASrO,KAAKxB,WAClB7I,KAAKkqB,oBAAoBxR,EAASrO,KAAKxB,KAC1C6P,EAASU,YAAcV,EAASY,SAClCtZ,KAAKurB,mBAAmBrnB,EAAKiK,EAAQ9D,EAAcqO,GAGvD,GAAIsU,EAAW,CACP,IAAA1mB,IAAE+D,SAAMqO,aACdvK,EAAOmc,aAAajgB,EAAMoJ,EAAO8F,oBAC1BrV,EAAIwU,EAASrO,KAAKxB,WAClB7I,KAAKkqB,oBAAoBxR,EAASrO,KAAKxB,KAC1C6P,EAASU,YAAcV,EAASY,SAClCtZ,KAAKurB,mBAAmBrnB,EAAKiK,EAAQ9D,EAAcqO,KAKjDmP,yBAAR,SAAqBlS,EAAoBwF,EAAWC,EAAWvS,GAC7D7I,KAAK+oB,MAAM3b,MAAMgT,KAAUjF,OAC3Bnb,KAAK+oB,MAAM3b,MAAMiT,IAASjF,OAC1B,IAAM3H,EAASW,OAAOE,QAAQzL,GAC9B,IAAK4K,EACH,OAAOzT,KAAK6rB,kBAAkBlW,EAAG9M,GAEnC7I,KAAKitB,cAAexZ,IAGdoU,0BAAR,SAAsBljB,GACpB3E,KAAKgpB,OACFmB,gBAAiBlN,iBAAiB,aAClChX,QAAQ,SAAAinB,GACPA,EAAUnnB,UAAUumB,OAAO,YAG/B,IADA,IAAIa,EAA4BxoB,EACzBwoB,GACLA,EAAUpnB,UAAUyS,IAAI,UACxB2U,EAAYA,EAAUjmB,eAIlB2gB,8BAAR,SAA0BjR,GACxB,OAAIA,EAAMtR,OAASwO,UAAUwM,sBAI3B1J,EAAMqJ,KAAKxV,OAASsJ,kBAAkBkN,UACtCrK,EAAMqJ,KAAKxV,QAAUsJ,kBAAkBsN,QAInCwG,yBAAR,WACE,IAA0B,IAAtB7nB,KAAK8nB,YAAT,CAGA,IAAMlO,EAAU,CAAEyM,MAAOrmB,KAAK8nB,aAC9B9nB,KAAK+pB,UAAUnQ,GACf5Z,KAAK4nB,QAAQpI,KAAKrL,eAAeiZ,QAASxT,GAC1C5Z,KAAK8nB,aAAe,IAGdD,6BAAR,SAAyBlS,EAAoB9M,GACtC7I,KAAKulB,OAAO+B,aAGjBve,QAAQC,KAAK+d,sBAAuB,iBAAiBle,mBAAoB8M,IAGnEkS,8BAAR,SAA0BlS,EAAoB9M,GAOvC7I,KAAKulB,OAAOgC,WAIjBxe,QAAQskB,IAAItG,sBAAuB,iBAAiBle,mBAAoB8M,SC9rBpEmM"}